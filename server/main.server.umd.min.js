/**
 * @license rxcomp-server v1.0.0-beta.12
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("stream"),require("http"),require("url"),require("https"),require("zlib"),require("rxjs"),require("rxjs/operators"),require("htmlparser2"),require("rxcomp")):"function"==typeof define&&define.amd?define(["exports","stream","http","url","https","zlib","rxjs","rxjs/operators","htmlparser2","rxcomp"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).main=e.main||{},e.main.server=e.main.server||{},e.main.server.umd={}),e.Stream,e.http,e.Url,e.https,e.zlib,e.rxjs,e.rxjs.operators,e.htmlparser2,e.rxcomp)}(this,(function(e,t,r,n,o,i,s,u,a,c){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};const h=t.Readable,f=Symbol("buffer"),d=Symbol("type");class p{constructor(){this[d]="";const e=arguments[0],t=arguments[1],r=[];let n=0;if(e){const t=e,o=Number(t.length);for(let e=0;e<o;e++){const o=t[e];let i;i=o instanceof Buffer?o:ArrayBuffer.isView(o)?Buffer.from(o.buffer,o.byteOffset,o.byteLength):o instanceof ArrayBuffer?Buffer.from(o):o instanceof p?o[f]:Buffer.from("string"==typeof o?o:String(o)),n+=i.length,r.push(i)}}this[f]=Buffer.concat(r);let o=t&&void 0!==t.type&&String(t.type).toLowerCase();o&&!/[^\u0020-\u007E]/.test(o)&&(this[d]=o)}get size(){return this[f].length}get type(){return this[d]}text(){return Promise.resolve(this[f].toString())}arrayBuffer(){const e=this[f],t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(t)}stream(){const e=new h;return e._read=function(){},e.push(this[f]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,t=arguments[0],r=arguments[1];let n,o;n=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),o=void 0===r?e:r<0?Math.max(e+r,0):Math.min(r,e);const i=Math.max(o-n,0),s=this[f].slice(n,n+i),u=new p([],{type:arguments[2]});return u[f]=s,u}}function y(e,t,r){Error.call(this,e),this.message=e,this.type=t,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}let m;Object.defineProperties(p.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(p.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),y.prototype=Object.create(Error.prototype),y.prototype.constructor=y,y.prototype.name="FetchError";try{m=require("encoding").convert}catch(e){}const b=Symbol("Body internals"),g=t.PassThrough;function v(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.size;let i=void 0===o?0:o;var s=n.timeout;let u=void 0===s?0:s;null==e?e=null:E(e)?e=Buffer.from(e.toString()):T(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof t||(e=Buffer.from(String(e)))),this[b]={body:e,disturbed:!1,error:null},this.size=i,this.timeout=u,e instanceof t&&e.on("error",(function(e){const t="AbortError"===e.name?e:new y(`Invalid response body while trying to fetch ${r.url}: ${e.message}`,"system",e);r[b].error=t}))}function w(){var e=this;if(this[b].disturbed)return v.Promise.reject(new TypeError("body used already for: "+this.url));if(this[b].disturbed=!0,this[b].error)return v.Promise.reject(this[b].error);let r=this.body;if(null===r)return v.Promise.resolve(Buffer.alloc(0));if(T(r)&&(r=r.stream()),Buffer.isBuffer(r))return v.Promise.resolve(r);if(!(r instanceof t))return v.Promise.resolve(Buffer.alloc(0));let n=[],o=0,i=!1;return new v.Promise((function(t,s){let u;e.timeout&&(u=setTimeout((function(){i=!0,s(new y(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))}),e.timeout)),r.on("error",(function(t){"AbortError"===t.name?(i=!0,s(t)):s(new y(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))})),r.on("data",(function(t){if(!i&&null!==t){if(e.size&&o+t.length>e.size)return i=!0,void s(new y(`content size at ${e.url} over limit: ${e.size}`,"max-size"));o+=t.length,n.push(t)}})),r.on("end",(function(){if(!i){clearTimeout(u);try{t(Buffer.concat(n,o))}catch(t){s(new y(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}}))}))}function E(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function T(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function N(e){let r,n,o=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof t&&"function"!=typeof o.getBoundary&&(r=new g,n=new g,o.pipe(r),o.pipe(n),e[b].body=r,o=n),o}function O(e){return null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":E(e)?"application/x-www-form-urlencoded;charset=UTF-8":T(e)?e.type||null:Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)?null:"function"==typeof e.getBoundary?"multipart/form-data;boundary="+e.getBoundary():e instanceof t?null:"text/plain;charset=UTF-8"}function _(e){const t=e.body;return null===t?0:T(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}v.prototype={get body(){return this[b].body},get bodyUsed(){return this[b].disturbed},arrayBuffer(){return w.call(this).then((function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}))},blob(){let e=this.headers&&this.headers.get("content-type")||"";return w.call(this).then((function(t){return Object.assign(new p([],{type:e.toLowerCase()}),{[f]:t})}))},json(){var e=this;return w.call(this).then((function(t){try{return JSON.parse(t.toString())}catch(t){return v.Promise.reject(new y(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}}))},text(){return w.call(this).then((function(e){return e.toString()}))},buffer(){return w.call(this)},textConverted(){var e=this;return w.call(this).then((function(t){return function(e,t){if("function"!=typeof m)throw new Error("The package `encoding` must be installed to use the textConverted() function");const r=t.get("content-type");let n,o,i="utf-8";r&&(n=/charset=([^;]*)/i.exec(r));o=e.slice(0,1024).toString(),!n&&o&&(n=/<meta.+?charset=(['"])(.+?)\1/i.exec(o));!n&&o&&(n=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o),n&&(n=/charset=(.*)/i.exec(n.pop())));!n&&o&&(n=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o));n&&(i=n.pop(),"gb2312"!==i&&"gbk"!==i||(i="gb18030"));return m(e,"UTF-8",i).toString()}(t,e.headers)}))}},Object.defineProperties(v.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),v.mixIn=function(e){for(const t of Object.getOwnPropertyNames(v.prototype))if(!(t in e)){const r=Object.getOwnPropertyDescriptor(v.prototype,t);Object.defineProperty(e,t,r)}},v.Promise=global.Promise;const x=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,j=/[^\t\x20-\x7e\x80-\xff]/;function S(e){if(e=""+e,x.test(e)||""===e)throw new TypeError(e+" is not a legal HTTP header name")}function P(e){if(e=""+e,j.test(e))throw new TypeError(e+" is not a legal HTTP header value")}function C(e,t){t=t.toLowerCase();for(const r in e)if(r.toLowerCase()===t)return r}const A=Symbol("map");class R{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[A]=Object.create(null),e instanceof R){const t=e.raw(),r=Object.keys(t);for(const e of r)for(const r of t[e])this.append(e,r)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const r=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");r.push(Array.from(t))}for(const e of r){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const r=e[t];this.append(t,r)}}}}get(e){S(e=""+e);const t=C(this[A],e);return void 0===t?null:this[A][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=k(this),n=0;for(;n<r.length;){var o=r[n];const i=o[0],s=o[1];e.call(t,s,i,this),r=k(this),n++}}set(e,t){t=""+t,S(e=""+e),P(t);const r=C(this[A],e);this[A][void 0!==r?r:e]=[t]}append(e,t){t=""+t,S(e=""+e),P(t);const r=C(this[A],e);void 0!==r?this[A][r].push(t):this[A][e]=[t]}has(e){return S(e=""+e),void 0!==C(this[A],e)}delete(e){S(e=""+e);const t=C(this[A],e);void 0!==t&&delete this[A][t]}raw(){return this[A]}keys(){return M(this,"key")}values(){return M(this,"value")}[Symbol.iterator](){return M(this,"key+value")}}function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const r=Object.keys(e[A]).sort();return r.map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[A][t].join(", ")}:function(t){return[t.toLowerCase(),e[A][t].join(", ")]})}R.prototype.entries=R.prototype[Symbol.iterator],Object.defineProperty(R.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(R.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const D=Symbol("internal");function M(e,t){const r=Object.create(z);return r[D]={target:e,kind:t,index:0},r}const z=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==z)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[D];const t=e.target,r=e.kind,n=e.index,o=k(t,r);return n>=o.length?{value:void 0,done:!0}:(this[D].index=n+1,{value:o[n],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function q(e){const t=Object.assign({__proto__:null},e[A]),r=C(e[A],"Host");return void 0!==r&&(t[r]=t[r][0]),t}Object.defineProperty(z,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const B=Symbol("Response internals"),L=r.STATUS_CODES;class U{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v.call(this,e,t);const r=t.status||200,n=new R(t.headers);if(null!=e&&!n.has("Content-Type")){const t=O(e);t&&n.append("Content-Type",t)}this[B]={url:t.url,status:r,statusText:t.statusText||L[r],headers:n,counter:t.counter}}get url(){return this[B].url||""}get status(){return this[B].status}get ok(){return this[B].status>=200&&this[B].status<300}get redirected(){return this[B].counter>0}get statusText(){return this[B].statusText}get headers(){return this[B].headers}clone(){return new U(N(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}v.mixIn(U.prototype),Object.defineProperties(U.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(U.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const $=Symbol("Request internals"),I=n.parse,V=n.format,H="destroy"in t.Readable.prototype;function F(e){return"object"==typeof e&&"object"==typeof e[$]}class G{constructor(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};F(e)?t=I(e.url):(t=e&&e.href?I(e.href):I(""+e),e={});let n=r.method||e.method||"GET";if(n=n.toUpperCase(),(null!=r.body||F(e)&&null!==e.body)&&("GET"===n||"HEAD"===n))throw new TypeError("Request with GET/HEAD method cannot have body");let o=null!=r.body?r.body:F(e)&&null!==e.body?N(e):null;v.call(this,o,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});const i=new R(r.headers||e.headers||{});if(null!=o&&!i.has("Content-Type")){const e=O(o);e&&i.append("Content-Type",e)}let s=F(e)?e.signal:null;if("signal"in r&&(s=r.signal),null!=s&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(s))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[$]={method:n,redirect:r.redirect||e.redirect||"follow",headers:i,parsedURL:t,signal:s},this.follow=void 0!==r.follow?r.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==r.compress?r.compress:void 0===e.compress||e.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}get method(){return this[$].method}get url(){return V(this[$].parsedURL)}get headers(){return this[$].headers}get redirect(){return this[$].redirect}get signal(){return this[$].signal}clone(){return new G(this)}}function K(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}v.mixIn(G.prototype),Object.defineProperty(G.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(G.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),K.prototype=Object.create(Error.prototype),K.prototype.constructor=K,K.prototype.name="AbortError";const J=t.PassThrough,Y=n.resolve;function X(e,n){if(!X.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return v.Promise=X.Promise,new X.Promise((function(s,u){const a=new G(e,n),c=function(e){const r=e[$].parsedURL,n=new R(e[$].headers);if(n.has("Accept")||n.set("Accept","*/*"),!r.protocol||!r.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(r.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof t.Readable&&!H)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let o=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(o="0"),null!=e.body){const t=_(e);"number"==typeof t&&(o=String(t))}o&&n.set("Content-Length",o),n.has("User-Agent")||n.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip,deflate");let i=e.agent;return"function"==typeof i&&(i=i(r)),n.has("Connection")||i||n.set("Connection","close"),Object.assign({},r,{method:e.method,headers:q(n),agent:i})}(a),l=("https:"===c.protocol?o:r).request,h=a.signal;let f=null;const d=function(){let e=new K("The user aborted a request.");u(e),a.body&&a.body instanceof t.Readable&&a.body.destroy(e),f&&f.body&&f.body.emit("error",e)};if(h&&h.aborted)return void d();const p=function(){d(),g()},m=l(c);let b;function g(){m.abort(),h&&h.removeEventListener("abort",p),clearTimeout(b)}h&&h.addEventListener("abort",p),a.timeout&&m.once("socket",(function(e){b=setTimeout((function(){u(new y("network timeout at: "+a.url,"request-timeout")),g()}),a.timeout)})),m.on("error",(function(e){u(new y(`request to ${a.url} failed, reason: ${e.message}`,"system",e)),g()})),m.on("response",(function(e){clearTimeout(b);const t=function(e){const t=new R;for(const r of Object.keys(e))if(!x.test(r))if(Array.isArray(e[r]))for(const n of e[r])j.test(n)||(void 0===t[A][r]?t[A][r]=[n]:t[A][r].push(n));else j.test(e[r])||(t[A][r]=[e[r]]);return t}(e.headers);if(X.isRedirect(e.statusCode)){const r=t.get("Location"),n=null===r?null:Y(a.url,r);switch(a.redirect){case"error":return u(new y("redirect mode is set to error: "+a.url,"no-redirect")),void g();case"manual":if(null!==n)try{t.set("Location",n)}catch(e){u(e)}break;case"follow":if(null===n)break;if(a.counter>=a.follow)return u(new y("maximum redirect reached at: "+a.url,"max-redirect")),void g();const r={headers:new R(a.headers),follow:a.follow,counter:a.counter+1,agent:a.agent,compress:a.compress,method:a.method,body:a.body,signal:a.signal,timeout:a.timeout};return 303!==e.statusCode&&a.body&&null===_(a)?(u(new y("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void g()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==a.method)||(r.method="GET",r.body=void 0,r.headers.delete("content-length")),s(X(new G(n,r))),void g())}}e.once("end",(function(){h&&h.removeEventListener("abort",p)}));let r=e.pipe(new J);const n={url:a.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:a.size,timeout:a.timeout,counter:a.counter},o=t.get("Content-Encoding");if(!a.compress||"HEAD"===a.method||null===o||204===e.statusCode||304===e.statusCode)return f=new U(r,n),void s(f);const c={flush:i.Z_SYNC_FLUSH,finishFlush:i.Z_SYNC_FLUSH};if("gzip"==o||"x-gzip"==o)return r=r.pipe(i.createGunzip(c)),f=new U(r,n),void s(f);if("deflate"!=o&&"x-deflate"!=o){if("br"==o&&"function"==typeof i.createBrotliDecompress)return r=r.pipe(i.createBrotliDecompress()),f=new U(r,n),void s(f);f=new U(r,n),s(f)}else{e.pipe(new J).once("data",(function(e){r=8==(15&e[0])?r.pipe(i.createInflate()):r.pipe(i.createInflateRaw()),f=new U(r,n),s(f)}))}})),function(e,t){const r=t.body;null===r?e.end():T(r)?r.stream().pipe(e):Buffer.isBuffer(r)?(e.write(r),e.end()):r.pipe(e)}(m,a)}))}X.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},X.Promise=global.Promise;var W,Z,Q=(W=Object.freeze({__proto__:null,default:X,Headers:R,Request:G,Response:U,FetchError:y}))&&W.default||W,ee=function(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}((function(e,t){var r=Q.default||Q,n=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),r.call(this,e,t)};e.exports=t=n,t.fetch=n,t.Headers=Q.Headers,t.Request=Q.Request,t.Response=Q.Response,t.default=n})),te=ee.fetch.bind({});function re(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function ne(e,t,r){return t&&re(e.prototype,t),r&&re(e,r),e}function oe(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function ie(e){return(ie=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function se(e,t){return(se=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ue(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function ae(e,t,r){return(ae=ue()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&se(o,r.prototype),o}).apply(null,arguments)}function ce(e){var t="function"==typeof Map?new Map:void 0;return(ce=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return ae(e,arguments,ie(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),se(n,e)})(e)}function le(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function he(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function fe(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return he(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?he(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}te.polyfill=!0,l.fetch||(l.fetch=te,l.Response=ee.Response,l.Headers=ee.Headers,l.Request=ee.Request),function(e){e.Public="public",e.Private="private",e.NoCache="no-cache",e.NoStore="no-store"}(Z||(Z={}));var de,pe,ye=function(){function e(e){this.maxAge=0,this.cacheControl=Z.Public,e&&Object.assign(this,e)}return e.prototype.set=function(e){return e&&Object.assign(this,e),this.date=new Date,this},ne(e,[{key:"expired",get:function(){return this.cacheControl===Z.NoStore||0===this.maxAge||this.date.getTime()+1e3*this.maxAge<Date.now()}}]),e}(),me=function(){function e(){}return e.delete=function(e,t){void 0===e&&(e="cache");var r=e+"_"+t;this.cache_.has(r)&&this.cache_.delete(r)},e.has=function(e,t){void 0===e&&(e="cache");var r=e+"_"+t;return this.cache_.has(r)},e.get=function(e,t){void 0===e&&(e="cache");var r=null,n=e+"_"+t;if(this.cache_.has(n)){var o=this.cache_.get(n);o&&(o.expired?this.cache_.delete(n):r=JSON.parse(o.value))}return r},e.set=function(e,t,r,n){void 0===e&&(e="cache"),void 0===n&&(n=0);var o=e+"_"+t,i=(new ye).set({value:JSON.stringify(r,null,0),maxAge:n});return this.cache_.set(o,i),r},e}();function be(e){return e.nodeType===de.ELEMENT_NODE}function ge(e){return e.nodeType===de.TEXT_NODE}function ve(e){var t,r=new De,n=r,o=new a.Parser({onopentag:function(e,r){t=new Se(n,e,r),n.childNodes.push(t),n=t},onclosetag:function(e){n.parentNode&&(n=n.parentNode)},ontext:function(e){var t=new Pe(n,e);n.childNodes.push(t)},onprocessinginstruction:function(e,r){t="!doctype"===e?new Re(n,r):new Ae(n,r),n.childNodes.push(t)},oncomment:function(e){t=new Ce(n,e),n.childNodes.push(t)},oncommentend:function(){},oncdatastart:function(){console.log("oncdatastart")},oncdataend:function(){console.log("oncdataend")},onerror:function(e){console.log("error",e)}},{decodeEntities:!1,lowerCaseTags:!0});return o.write(e),o.end(),r}function we(e){var t=[];return e.trim().split(" ").forEach((function(e){e.trim().split(">").forEach((function(e,r){for(var n,o=[],i=fe(e.matchAll(/\:not\(\#([^\.[#:]+)\)|\:not\(\.([^\.[#:]+)\)|\:not\(\[([^\.\[#:]+)\]\)|\:not\(([^\.\[#:\]]+)\)|\#([^\.[#:]+)|\.([^\.[#:]+)|\[([^\.\[#:]+)\]|([^\.\[#:\]]+)/g));!(n=i()).done;){var s=n.value;s[1]?o.push({selector:s[1],type:pe.Id,negate:!0}):s[2]?o.push({selector:s[2],type:pe.Class,negate:!0}):s[3]?o.push({selector:s[3],type:pe.Attribute,negate:!0}):s[4]?o.push({selector:s[4],type:pe.TagName,negate:!0}):s[5]?o.push({selector:s[5],type:pe.Id,negate:!1}):s[6]?o.push({selector:s[6],type:pe.Class,negate:!1}):s[7]?o.push({selector:s[7],type:pe.Attribute,negate:!1}):s[8]&&o.push({selector:s[8],type:pe.TagName,negate:!1})}var u=r>0?{selector:e,selectors:o,inner:!0}:{selector:e,selectors:o,inner:!1};t.push.call(t,u)}))})),t}function Ee(e,t){return t.reduce((function(t,r){return t&&function(e,t){switch(t.type){case pe.Id:return(""!==t.selector&&e.attributes.id===t.selector)!==t.negate;case pe.Class:return-1!==e.classList.indexOf(t.selector)!==t.negate;case pe.Attribute:return-1!==Object.keys(e.attributes).indexOf(t.selector)!==t.negate;case pe.TagName:return e.nodeName===t.selector!==t.negate;default:return!1}}(e,r)}),!0)}function Te(e,t,r){void 0===r&&(r=null);var n=null;if(r||e.length){r=r||e.shift();for(var o,i=fe(t);!(o=i()).done;){var s=o.value;if(s instanceof Se){if(Ee(s,r.selectors))return e.length?Te(e,s.childNodes):s;r.inner||(n=Te(e,s.childNodes,r))}}}return n}function Ne(e,t,r){var n;if(void 0===t&&(t=!1),void 0===r&&(r=null),be(e)){var o=new Se(r,e.nodeName,Object.assign({},e.attributes));t&&(o.childNodes=e.childNodes.map((function(e){return Ne.apply(e,[e,t,o])}))),n=o}else if(e.nodeType===de.DOCUMENT_FRAGMENT_NODE){var i=new ke;t&&(i.childNodes=e.childNodes.map((function(e){return Ne.apply(e,[e,t,i])}))),n=i}else if(ge(e))n=new Pe(r,e.nodeValue);else if(function(e){return e.nodeType===de.COMMENT_NODE}(e))n=new Ce(r,e.nodeValue);else{if(!function(e){return e.nodeType===de.DOCUMENT_NODE}(e))throw new Error("Invalid node type");var s=new De;t&&(s.childNodes=e.childNodes.map((function(e){return Ne.apply(e,[e,t,s])}))),n=s}return n}me.cache_=new Map,function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",e[e.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE",e[e.DOCUMENT_NODE=9]="DOCUMENT_NODE",e[e.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",e[e.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE"}(de||(de={})),function(e){e[e.None=-1]="None",e[e.Id=0]="Id",e[e.Class=1]="Class",e[e.Attribute=2]="Attribute",e[e.TagName=3]="TagName"}(pe||(pe={}));var Oe,_e=function(){function e(e){void 0===e&&(e=null),this.nodeValue=null,this.parentNode=e,this.nodeType=-1}var t=e.prototype;return t.cloneNode=function(e){return void 0===e&&(e=!1),Ne.apply(this,[this,e])},t.serialize=function(){return""},e}(),xe=function(){var e=t.prototype;function t(e){Object.defineProperty(this,"node",{value:e,writable:!1,enumerable:!1}),this.init()}return e.item=function(e){var t=Object.keys(this);return t.length>e?t[e]:void 0},e.getPropertyPriority=function(e){var t=this[e];return t&&t.indexOf("!important")?"important":""},e.getPropertyValue=function(e){return this[e]},e.setProperty=function(e,t,r){this[e]=t+("important"===r?"!important":""),this.serialize_()},e.removeProperty=function(e){delete this[e],this.serialize_()},e.serialize_=function(){var e=this;this.node.attributes.style=Object.keys(this).map((function(t){return t+": "+e[t]+";"})).join(" ")},e.init=function(){var e,t=this;if(Object.keys(this).forEach((function(e){return delete t[e]})),null==(e=this.node.attributes)?void 0:e.style){[].concat(this.node.attributes.style.matchAll(/([^:]+):([^;]+);?\s*/gm)).forEach((function(e){var r=e[1],n=e[2];t[r]=n}))}},t}(),je=function(e){function t(t){var r;return(r=e.call(this)||this).node=t,r.init(),r}oe(t,e);var r=t.prototype;return r.item=function(e){return this[e]},r.contains=function(e){return-1!==this.indexOf(e)},r.add=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach((function(t){-1!==e.indexOf(t)&&e.push(t)})),this.serialize_()},r.remove=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach((function(t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)})),this.serialize_()},r.toggle=function(e,t){var r=this.indexOf(e);return!1===t?(this.splice(r,1),this.serialize_(),!1):!0===t?(this.push(e),this.serialize_(),!0):-1!==r?(this.splice(r,1),this.serialize_(),!1):(this.push(e),this.serialize_(),!0)},r.replace=function(e,t){var r=this.indexOf(e);-1!==r&&this.splice(r,1),this.push(t),this.serialize_()},r.serialize_=function(){this.node.attributes.class=this.join(" ")},r.init=function(){var e;this.length=0,(null==(e=this.node.attributes)?void 0:e.class)&&Array.prototype.push.apply(this,this.node.attributes.class.split(" ").map((function(e){return e.trim()})))},t}(ce(Array)),Se=function(e){function t(t,r,n){var o;return void 0===t&&(t=null),void 0===n&&(n=null),(o=e.call(this,t)||this).attributes={},o.nodeType=de.ELEMENT_NODE,o.nodeName=r,n&&"object"==typeof n&&(o.attributes=n),o.style=new xe(le(o)),o.classList=new je(le(o)),o.childNodes=[],o}oe(t,e);var r=t.prototype;return r.append=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r=r.map((function(t){var r;return"string"==typeof t?r=new Pe(e,t):(r=t).parentNode=e,r})),Array.prototype.push.apply(this.childNodes,r)},r.prepend=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r=r.map((function(t){var r;return"string"==typeof t?r=new Pe(e,t):(r=t).parentNode=e,r})),Array.prototype.unshift.apply(this.childNodes,r)},r.replaceChildren=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=r.map((function(t){var r;return"string"==typeof t?r=new Pe(e,t):(r=t).parentNode=e,r}));this.childNodes=o},r.querySelectorAll=function(e){var t=we(e),r=this.childNodes.filter((function(e){return!0}));return console.log(t),r.length?r:null},r.querySelector=function(e){return Te(we(e),this.childNodes)},r.hasAttribute=function(e){return-1!==Object.keys(this.attributes).indexOf(e.toLowerCase())},r.getAttribute=function(e){return this.attributes[e.toLowerCase()]||null},r.setAttribute=function(e,t){this.attributes[e.toLowerCase()]=t.toString(),"style"===e?this.style.init():"class"===e&&this.classList.init()},r.removeAttribute=function(e){delete this.attributes[e],"style"===e?this.style.init():"class"===e&&this.classList.init()},r.replaceChild=function(e,t){var r=this.childNodes.indexOf(t);return-1!==r&&(this.childNodes[r]=e,e.parentNode=this),t},r.removeChild=function(e){if(!(e instanceof _e))throw new Error("Uncaught TypeError: Failed to execute 'removeChild' on 'Node': parameter 1 is not of type 'Node'.");var t=this.childNodes.indexOf(e);if(-1===t)throw new Error("Uncaught NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.");return this.childNodes.splice(t,1),e},r.insertBefore=function(e,t){void 0===t&&(t=null);var r=t?this.childNodes.indexOf(t):this.childNodes.length;return-1!==r&&(this.childNodes.splice(r,0,e),e.parentNode=this),e},r.cloneNode=function(e){return void 0===e&&(e=!1),Ne.apply(this,[this,e])},r.addListener=function(e,t){},r.removeListener=function(e,t){},r.serialize=function(){return"<"+this.nodeName+this.serializeAttributes()+">"+this.childNodes.map((function(e){return e.serialize()})).join("")+"</"+this.nodeName+">"},r.serializeAttributes=function(){var e=this,t="",r=Object.keys(this.attributes);return r.length&&(t=" "+r.map((function(t){return t+'="'+e.attributes[t]+'"'})).join(" ")),t},ne(t,[{key:"children",get:function(){var e,t=[],r=0,n=this.childNodes;for(e=n[r++];e;)(e=n[r++]).nodeType===de.ELEMENT_NODE&&t.push(e);return t}},{key:"childElementCount",get:function(){var e,t=0,r=0,n=this.childNodes;for(e=n[t++];e;)e.nodeType===de.ELEMENT_NODE&&r++,e=n[t++];return r}},{key:"firstChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[0]),e}},{key:"firstElementChild",get:function(){for(var e,t=fe(this.childNodes);!(e=t()).done;){var r=e.value;if(be(r))return r}return null}},{key:"lastChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[this.childNodes.length-1]),e}},{key:"lastElementChild",get:function(){for(var e=this.childNodes,t=e.length-1;t>-1;t--){var r=e[t];if(be(r))return r}return null}},{key:"previousSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);t>0&&(e=this.parentNode.childNodes[t-1])}return e}},{key:"nextSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);-1!==t&&t<this.parentNode.childNodes.length-1&&(e=this.parentNode.childNodes[t])}return e}},{key:"wholeText",get:function(){if(this.nodeType===de.TEXT_NODE)return this.nodeValue}},{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"innerText",set:function(e){this.childNodes=[new Pe(this,e)]},get:function(){return this.childNodes.filter((function(e){return ge(e)||be(e)})).map((function(e){return e.innerText})).join("")}},{key:"textContent",set:function(e){this.innerText=String(e)},get:function(){return this.innerText}},{key:"innerHTML",get:function(){return this.childNodes.map((function(e){return e.serialize()})).join("")},set:function(e){var t=this,r=ve(e).childNodes.map((function(e){return e.parentNode=t,e}));this.childNodes=r}}]),t}(_e),Pe=function(e){function t(t,r){var n;return void 0===t&&(t=null),(n=e.call(this,t)||this).nodeType=de.TEXT_NODE,n.nodeValue=String(r),n}return oe(t,e),t.prototype.serialize=function(){return this.nodeValue},ne(t,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),t}(_e),Ce=function(e){function t(t,r){var n;return void 0===t&&(t=null),(n=e.call(this,t)||this).nodeType=de.COMMENT_NODE,n.nodeValue=String(r),n}return oe(t,e),t.prototype.serialize=function(){return"\x3c!--"+this.nodeValue+"--\x3e"},ne(t,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),t}(_e),Ae=function(e){function t(t,r){var n;return void 0===t&&(t=null),(n=e.call(this,t)||this).nodeType=de.PROCESSING_INSTRUCTION_NODE,n.nodeValue=String(r),n}return oe(t,e),t.prototype.serialize=function(){return"<"+this.nodeValue+">"},t}(_e),Re=function(e){function t(t,r){var n;return void 0===t&&(t=null),(n=e.call(this,t)||this).nodeType=de.DOCUMENT_TYPE_NODE,n.nodeValue=String(r),n}return oe(t,e),t.prototype.serialize=function(){return"<"+this.nodeValue+">"},t}(_e),ke=function(e){function t(){var t;return(t=e.call(this,null,"#document-fragment")||this).nodeType=de.DOCUMENT_FRAGMENT_NODE,t.childNodes=[],t}return oe(t,e),t}(Se),De=function(e){function t(){var t;return(t=e.call(this,null,"#document")||this).nodeType=de.DOCUMENT_NODE,t.childNodes=[],t}oe(t,e),ne(t,[{key:"hidden",get:function(){return!0}},{key:"visibilityState",get:function(){return"prerender"}},{key:"doctype",get:function(){return this.childNodes.find((function(e){return function(e){return e.nodeType===de.DOCUMENT_TYPE_NODE}(e)}))}},{key:"body",get:function(){return this.childNodes.find((function(e){return be(e)&&"body"===e.nodeName}))}},{key:"head",get:function(){return this.childNodes.find((function(e){return be(e)&&"head"===e.nodeName}))}},{key:"title",get:function(){var e=this.childNodes.find((function(e){return be(e)&&"title"===e.nodeName}));return e?e.innerText:null},set:function(e){var t=this.childNodes.find((function(e){return be(e)&&"title"===e.nodeName}));t&&(t.innerText=e)}},{key:"documentElement",get:function(){return this.firstElementChild}}]);var r=t.prototype;return r.createAttribute=function(){},r.createAttributeNS=function(){},r.createCDATASection=function(){},r.createComment=function(e){return new Ce(null,e)},r.createDocumentFragment=function(){return new ke},r.createElement=function(e){return new Se(null,e)},r.createElementNS=function(e){return new Se(null,e)},r.createEvent=function(){},r.createNodeIterator=function(){},r.createProcessingInstruction=function(e){return new Ae(null,e)},r.createRange=function(){},r.createTextNode=function(e){return new Pe(null,e)},r.createTouchList=function(){},r.createTreeWalker=function(){},r.serialize=function(){return""+this.childNodes.map((function(e){return e.serialize()})).join("")},t}(Se),Me={name:"rxcomp-server",static:!1,development:!1,production:!0,host:"",resource:"/",api:"/api"},ze=require("fs"),qe=function(e){e&&Object.assign(this,e)},Be=function(e){e&&Object.assign(this,e)},Le=function(e){function t(){return e.apply(this,arguments)||this}return oe(t,e),t.bootstrap=function(e,t){if(!c.isPlatformServer)throw new c.ModuleError("missing platform server, node process not found");if(!e)throw new c.ModuleError("missing moduleFactory");if(!e.meta)throw new c.ModuleError("missing moduleFactory meta");if(!e.meta.bootstrap)throw new c.ModuleError("missing bootstrap");if(!e.meta.bootstrap.meta)throw new c.ModuleError("missing bootstrap meta");if(!e.meta.bootstrap.meta.selector)throw new c.ModuleError("missing bootstrap meta selector");if(!t)throw new c.ModuleError("missing template");var r=this.resolveGlobals(t),n=this.resolveMeta(e);if(n.node instanceof Se){var o,i=n.node,s=n.nodeInnerHTML,u={selector:e.meta.bootstrap.meta.selector,innerHTML:s},a=new Se(null,"script"),l=new Pe(null,"var rxcomp_hydrate_ = "+JSON.stringify(u)+";");a.append(l),null==(o=i.parentNode)||o.insertBefore(a,i)}var h=new e;h.meta=n,n.imports.forEach((function(e){e.prototype.constructor.call(h)}));var f=h.compile(n.node,{document:r});return h.instances=f,f[0].pushChanges(),h},t.serialize=function(){if(console.log("Server.serialize"),this.document instanceof De)return this.document.serialize();throw new c.ModuleError("document is not an instance of RxDocument")},t.resolveGlobals=function(e){var t="string"==typeof e?ve(e):e;return this.document=t,global.document=this.document,this.document},t}(c.Platform);function Ue(e){return s.Observable.create((function(t){var r=me.get("template",e.template);console.log("template",!!r),r&&(t.next(r),t.complete()),ze.readFile(e.template,e.charset,(function(r,n){r?t.error(r):(me.set("template",e.template,n),t.next(n),t.complete())}))}))}Le.bootstrap$=function(e,t){t&&t.host&&(Me.host=t.host);return s.from(new Promise((function(r,n){if(!(null==t?void 0:t.template))return n(new Error("ServerError: missing template"));try{Le.bootstrap(e,t.template);r(new qe(Object.assign({serialize:function(){return Le.serialize()}},t)))}catch(e){n(new Be(Object.assign({error:e},t)))}})))},Le.render$=function(e,t){return s.Observable.create((function(r){var n=me.get("cached",e.url);if(console.log("cached",!!n),n)return r.next(n),r.complete();Ue(e).pipe(u.switchMap((function(r){return e.template=r,t(e)}))).subscribe((function(t){me.set("cached",e.url,t,3600),r.next(t),r.complete()}),(function(e){r.error(e)}))}))},Le.template$=Ue,function(e){e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e[e.ResponseError=6]="ResponseError"}(Oe||(Oe={}));var $e=function(){function e(t){var r=this;this.headers_=new Map;var n=this.headers_;t instanceof e?t.headers_.forEach((function(e,t){n.set(t,e)})):"function"==typeof(null==t?void 0:t.forEach)?t.forEach((function(e,t){n.set(t,e.split(", "))})):"object"==typeof t?Object.keys(t).forEach((function(e){var o=t[e];"string"==typeof o&&(o=[o]),n.has(e)?o.forEach((function(t){return r.append(e,t)})):n.set(e,o)})):"string"==typeof t&&t.split("\n").forEach((function(e){var t=e.indexOf(":");if(t>0){var o=e.slice(0,t),i=e.slice(t+1).trim();n.has(o)?r.append(o,i):n.set(o,[i])}})),n.has("Accept")||n.set("Accept",["application/json","text/plain","*/*"]),n.has("Content-Type")||n.set("Content-Type",["application/json"])}var t=e.prototype;return t.has=function(e){return this.headers_.has(e)},t.get=function(e){var t=this.headers_.get(e);return t?t.join(", "):null},t.set=function(e,t){var r=this.clone_();return r.headers_.set(e,t.split(", ")),r},t.append=function(e,t){var r=this.clone_(),n=r.headers_.has(e)&&r.headers_.get(e)||[];return n.push(t),r.headers_.set(e,n),r},t.delete=function(e){var t=this.clone_();return t.headers_.delete(e),t},t.forEach=function(e,t){var r=this;this.headers_.forEach((function(t,n){e(t.join(", "),n,r)}))},t.serialize=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),e},t.clone_=function(){var t=new e;return this.headers_.forEach((function(e,r){t.headers_.set(r,e)})),t},e}(),Ie=function(e){function t(t){var r;return(r=e.call(this,(null==t?void 0:t.message)||"Unknown Error")||this).status=0,r.statusText="Unknown Error",r.ok=!1,r.type=Oe.ResponseError,r.message="Unknown Error",r.name="HttpErrorResponse",t&&(r.headers=new $e(t.headers),r.status=t.status||r.status,r.statusText=t.statusText||r.statusText,r.url=t.url||r.url,r.error=t.error||r.error,r.name=t.name||r.name,r.request=t.request||null),r}return oe(t,e),t.prototype.clone=function(e){var r=new t(e=Object.assign({headers:this.headers,status:this.status,statusText:this.statusText,url:this.url,error:this.error,message:this.message,name:this.name,request:this.request},e||{}));return r},t}(ce(Error)),Ve=function(){function e(e){this.status=200,this.statusText="OK",this.type=Oe.Response,this.body=null,e&&(this.headers=new $e(e.headers),this.status=e.status||this.status,this.statusText=e.statusText||this.statusText,this.url=e.url||this.url,this.body=e.body||this.body),this.ok=this.status>=200&&this.status<300}return e.prototype.clone=function(t){var r=new e(t=Object.assign({headers:this.headers,status:this.status,statusText:this.statusText,url:this.url,ok:this.ok,type:this.type,body:this.body},t||{}));return r},e}(),He=function(){function e(){this.response_=null}var t=e.prototype;return t.handle=function(e){var t=this;if(!e.method)throw new Error("missing method");var r=e.urlWithParams,n=e.toInitRequest();return s.from(fetch(r,n).then((function(r){return t.getProgress(r,e)})).then((function(r){return t.getResponse(r,e)}))).pipe(u.catchError((function(r){var n={error:r};t.response_&&(n.headers=t.response_.headers,n.status=t.response_.status,n.statusText=t.response_.statusText,n.url=t.response_.url,n.request=e);var o=new Ie(n);return c.nextError$.next(o),s.of(t.response_)})),u.finalize((function(){t.response_=null})))},t.getProgress=function(e,t){var r=this,n=e.clone().body;if(c.isPlatformBrowser&&t.reportProgress&&n){var o=n.getReader(),i=e.headers&&e.headers.has("Content-Length")?+(e.headers.get("Content-Length")||0):0;return new Promise((function(n,s){var u={progress:0,percent:0,current:0,total:0};o.read().then((function(t){return function t(r,n){var s=u.current;return n?(u.total=i,u.current=i,u.progress=1,u.percent=100,o.closed.then((function(){return e.clone()}))):(r&&(s+=r.length||0,u.total=i,u.current=s,u.progress=s/i,u.percent=100*u.progress),o.read().then((function(e){var r=e.value,n=e.done;return t(r,n)})))}(t.value,t.done)})).then((function(e){return r.response_=new Ve(e),"function"==typeof e[t.responseType]?e[t.responseType]().then((function(t){return r.response_=new Ve(Object.assign(r.response_,{body:t})),e.ok?n(r.response_):s(r.response_)})):s(r.response_)})).catch((function(e){return console.log("upload error:",e)}))}))}return Promise.resolve(e)},t.getResponse=function(e,t){return this.response_=new Ve(e),c.isPlatformBrowser&&t.reportProgress&&e.body?Promise.resolve(this.response_):this.getResponseType(e,t)},t.getResponseType=function(e,t){var r=this;return new Promise((function(n,o){return r.response_=new Ve(e),"function"==typeof e[t.responseType]?e[t.responseType]().then((function(t){return r.response_=new Ve(Object.assign(r.response_,{body:t})),e.ok?n(r.response_):o(r.response_)})):o(r.response_)}))},t.getReadableStream=function(e,t){var r=e.body.getReader();return new ReadableStream({start:function(e){!function t(){r.read().then((function(r){var n=r.done,o=r.value;n?e.close():(e.enqueue(o),t())}))}()}})},e}(),Fe=function(){function e(e,t){this.next=e,this.interceptor=t}return e.prototype.handle=function(e){return this.interceptor.intercept(e,this.next)},e}(),Ge=[],Ke=new He,Je=function(){function e(){this.chain=null}return e.prototype.handle=function(e){if(null===this.chain){var t=Ge;this.chain=t.reduceRight((function(e,t){return new Fe(e,t)}),Ke)}return this.chain.handle(e)},e}(),Ye=function(){function e(){}var t=e.prototype;return t.encodeKey=function(e){return We(e)},t.encodeValue=function(e){return We(e)},t.decodeKey=function(e){return decodeURIComponent(e)},t.decodeValue=function(e){return decodeURIComponent(e)},e}(),Xe=function(){function e(t,r){void 0===r&&(r=new Ye),this.params_=new Map,this.encoder=r;var n=this.params_;t instanceof e?t.params_.forEach((function(e,t){n.set(t,e)})):"object"==typeof t?Object.keys(t).forEach((function(e){var r=t[e];n.set(e,Array.isArray(r)?r:[r])})):"string"==typeof t&&function(e,t,r){if(t.length>0){t.split("&").forEach((function(t){var n=t.indexOf("="),o=-1==n?[r.decodeKey(t),""]:[r.decodeKey(t.slice(0,n)),r.decodeValue(t.slice(n+1))],i=o[0],s=o[1],u=e.get(i)||[];u.push(s),e.set(i,u)}))}}(n,t,this.encoder)}var t=e.prototype;return t.keys=function(){return Array.from(this.params_.keys())},t.has=function(e){return this.params_.has(e)},t.get=function(e){var t=this.params_.get(e);return t?t[0]:null},t.getAll=function(e){return this.params_.get(e)||null},t.set=function(e,t){var r=this.clone_();return r.params_.set(e,[t]),r},t.append=function(e,t){var r=this.clone_();if(r.has(e)){var n=r.params_.get(e)||[];n.push(t),r.params_.set(e,n)}else r.params_.set(e,[t]);return r},t.delete=function(e){var t=this.clone_();return t.params_.delete(e),t},t.toString=function(){var e=this;return this.keys().map((function(t){var r=e.params_.get(t);return e.encoder.encodeKey(t)+(r?"="+r.map((function(t){return e.encoder.encodeValue(t)})).join("&"):"")})).filter((function(e){return""!==e})).join("&")},t.clone_=function(){var t=new e(void 0,this.encoder);return this.params_.forEach((function(e,r){t.params_.set(r,e)})),t},e}();function We(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}var Ze=function(){function e(e,t,r,n){this.url=t,this.reportProgress=!1,this.withCredentials=!1,this.observe="body",this.responseType="json";var o,i=/\.(json|xml|txt)(\?.*)?$/.test(t);this.method=i?"GET":e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||n?(this.body=void 0!==r?r:null,o=n):o=r,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,this.observe=o.observe||this.observe,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=new $e(o.headers)),o.params&&(this.params=new Xe(o.params))),this.headers||(this.headers=new $e),this.params||(this.params=new Xe);var s=this.params.toString(),u=t.indexOf("?"),a=-1===u?"?":u<t.length-1?"&":"";this.urlWithParams=t+(s.length?a+s:s)}var t=e.prototype;return t.serializeBody=function(){return null===this.body?null:Qe(this.body)||et(this.body)||tt(this.body)||"string"==typeof this.body?this.body:this.body instanceof Xe?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()},t.detectContentTypeHeader=function(){return null===this.body||tt(this.body)?null:et(this.body)?this.body.type||null:Qe(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Xe?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null},t.toInitRequest=function(){return{method:this.method,headers:this.headers.serialize(),body:this.serializeBody(),mode:"same-origin",credentials:"same-origin",cache:"default",redirect:"error"}},t.toFetchRequest__=function(){return new Request(this.urlWithParams,this.toInitRequest())},t.clone=function(t){t=Object.assign({headers:this.headers,reportProgress:this.reportProgress,params:this.params,responseType:this.responseType,withCredentials:this.withCredentials,observe:this.observe,body:this.body,url:this.url,method:this.method},t||{});var r=new e(this.method,this.url,this.body,t);return r},e}();function Qe(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function et(e){return"undefined"!=typeof Blob&&e instanceof Blob}function tt(e){return"undefined"!=typeof FormData&&e instanceof FormData}var rt=function(){function e(){}return e.incrementPendingRequest=function(){e.pendingRequests$.next(e.pendingRequests$.getValue()+1)},e.decrementPendingRequest=function(){e.pendingRequests$.next(e.pendingRequests$.getValue()-1)},e.request$=function(t,r,n){var o,i=this;if(void 0===n&&(n={}),t instanceof Ze)o=t;else{var a=void 0;a=n.headers instanceof $e?n.headers:new $e(n.headers);var c=void 0;n.params&&(c=new Xe(n.params)),o=new Ze(t,r,void 0!==n.body?n.body:null,{headers:a,params:c,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}e.incrementPendingRequest();var l,h=s.of(o).pipe(u.concatMap((function(e){return i.handler.handle(e)})),u.finalize((function(){return e.decrementPendingRequest()})));return t instanceof Ze||"events"===n.observe?h.pipe(u.catchError((function(e){return console.log("error",e),s.throwError(i.getError(e,null,o))}))):h.pipe(u.filter((function(e){return e instanceof Ve}))).pipe(u.map((function(e){switch(l=e,n.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body;case"blob":if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body;case"text":if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body;case"json":default:return e.body}case"response":return e;default:throw new Error("Unreachable: unhandled observe type "+n.observe+"}")}})),u.catchError((function(e){return console.log("error",e),s.throwError(i.getError(e,l,o))})))},e.delete$=function(e,t){return void 0===t&&(t={}),this.request$("DELETE",e,t)},e.get$=function(e,t){return void 0===t&&(t={}),this.request$("GET",e,t)},e.head$=function(e,t){return void 0===t&&(t={}),this.request$("HEAD",e,t)},e.jsonp$=function(e,t){return this.request$("JSONP",e,{params:(new Xe).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})},e.options$=function(e,t){return void 0===t&&(t={}),this.request$("OPTIONS",e,t)},e.patch$=function(e,t,r){return void 0===r&&(r={}),this.request$("PATCH",e,nt(r,t))},e.post$=function(e,t,r){return void 0===r&&(r={}),this.request$("POST",e,nt(r,t))},e.put$=function(e,t,r){return void 0===r&&(r={}),this.request$("PUT",e,nt(r,t))},e.getError=function(e,t,r){e.status||(e.statusCode=(null==t?void 0:t.status)||0),e.statusMessage||(e.statusMessage=(null==t?void 0:t.statusText)||"Unknown Error");var n={error:e,status:e.status,statusText:e.statusText,message:e.message,request:r};return t&&(n.headers=t.headers,n.status=n.status||t.status,n.statusText=n.statusText||t.statusText,n.url=t.url),new Ie(n)},e}();function nt(e,t){return Object.assign({},e,{body:t})}rt.pendingRequests$=new s.BehaviorSubject(0),rt.handler=new Je;var ot=new(function(){function e(){}return e.prototype.intercept=function(e,t){var r=e.clone({url:e.url});return t.handle(r)},e}());Ge.push(ot);var it=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).items=[],t.error=null,t}oe(t,e);var r=t.prototype;return r.onInit=function(){var e=this;rt.post$(""+Me.host+Me.api,{query:"{ getTodos { id, title, completed } }"}).pipe(u.first()).subscribe((function(t){e.items=t.data.getTodos,e.pushChanges()}),(function(e){return console.log})),c.errors$.pipe(u.takeUntil(this.unsubscribe$)).subscribe((function(t){e.error=t,e.pushChanges()}))},r.onClick=function(e){e.completed=!e.completed,this.pushChanges()},t}(c.Component);it.meta={selector:"[app-component]"};var st=function(e){function t(){return e.apply(this,arguments)||this}return oe(t,e),t}(c.Module);st.meta={imports:[c.CoreModule],declarations:[],bootstrap:it},e.renderRequest$=function(e){return Le.bootstrap$(st,e).pipe(u.switchMap((function(e){return rt.pendingRequests$.pipe(u.filter((function(e){return 0===e})),u.map((function(){return e.body=e.serialize(),e})),u.first())})))},e.renderServer=function(e,t){return t&&t.host&&(Me.host=t.host),s.from(new Promise((function(r,n){if(!(null==t?void 0:t.template))return n(new Error("ServerError: template not found!"));try{r(Le.bootstrap(st,e))}catch(e){n(e)}}))).pipe(u.switchMap((function(){return rt.pendingRequests$})),u.filter((function(e){return 0===e})),u.map((function(){return Le.serialize()})),u.first())},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=main.server.umd.min.js.map