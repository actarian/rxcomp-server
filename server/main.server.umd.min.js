/**
 * @license rxcomp-server v1.0.0-beta.12
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxjs/operators"),require("rxcomp"),require("htmlparser2"),require("stream"),require("http"),require("url"),require("https"),require("zlib"),require("rxjs")):"function"==typeof define&&define.amd?define(["exports","rxjs/operators","rxcomp","htmlparser2","stream","http","url","https","zlib","rxjs"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).main=e.main||{},e.main.server=e.main.server||{},e.main.server.umd={}),e.rxjs.operators,e.rxcomp,e.htmlparser2,e.Stream,e.http,e.Url,e.https,e.zlib,e.rxjs)}(this,(function(e,t,n,r,o,i,s,u,a,c){"use strict";function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function f(e,t,n){return t&&l(e.prototype,t),n&&l(e,n),e}function d(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function h(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function p(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return h(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?h(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}var y,m;function b(e){return e.nodeType===y.ELEMENT_NODE}function g(e){return e.nodeType===y.TEXT_NODE}function v(e){var t,n=new _,o=n,i=new r.Parser({onopentag:function(e,n){t=new O(o,e,n),o.childNodes.push(t),o=t},onclosetag:function(e){o.parentNode&&(o=o.parentNode)},ontext:function(e){var t=new S(o,e);o.childNodes.push(t)},onprocessinginstruction:function(e,n){t="!doctype"===e?new C(o,n):new j(o,n),o.childNodes.push(t)},oncomment:function(e){t=new x(o,e),o.childNodes.push(t)},oncommentend:function(){},oncdatastart:function(){console.log("oncdatastart")},oncdataend:function(){console.log("oncdataend")},onerror:function(e){console.log("error",e)}},{decodeEntities:!1,lowerCaseTags:!0});return i.write(e),i.end(),n}function N(e){var t=[];return e.trim().split(" ").forEach((function(e){e.trim().split(">").forEach((function(e,n){for(var r,o=[],i=p(e.matchAll(/\.([^\.[]+)|\[([^\.\[]+)\]|([^\.\[\]]+)/g));!(r=i()).done;){var s=r.value;s[1]?o.push({selector:s[1],type:m.Class}):s[2]?o.push({selector:s[2],type:m.Attribute}):s[3]&&o.push({selector:s[3],type:m.TagName})}var u=n>0?{selector:e,selectors:o,inner:!0}:{selector:e,selectors:o,inner:!1};t.push.call(t,u)}))})),t}function w(e,t,n){void 0===n&&(n=null);var r=null;if(n||e.length){n=n||e.shift();for(var o,i=function(){var t=o.value;if(t instanceof O){if(n.selectors.reduce((function(e,n,r){return e&&function(e,t){switch(t.type){case m.Class:return-1!==e.classList.indexOf(t.selector);case m.Attribute:return-1!==Object.keys(e.attributes).indexOf(t.selector);case m.TagName:return e.nodeName===t.selector;default:return!1}}(t,n)}),!0))return e.length?{v:w(e,t.childNodes)}:{v:t};n.inner||(r=w(e,t.childNodes,n))}},s=p(t);!(o=s()).done;){var u=i();if("object"==typeof u)return u.v}}return r}function T(e,t,n){var r;if(void 0===t&&(t=!1),void 0===n&&(n=null),b(e)){var o=new O(n,e.nodeName,Object.assign({},e.attributes));t&&(o.childNodes=e.childNodes.map((function(e){return T.apply(e,[e,t,o])}))),r=o}else if(e.nodeType===y.DOCUMENT_FRAGMENT_NODE){var i=new P;t&&(i.childNodes=e.childNodes.map((function(e){return T.apply(e,[e,t,i])}))),r=i}else if(g(e))r=new S(n,e.nodeValue);else if(function(e){return e.nodeType===y.COMMENT_NODE}(e))r=new x(n,e.nodeValue);else{if(!function(e){return e.nodeType===y.DOCUMENT_NODE}(e))throw"Invalid node type";var s=new _;t&&(s.childNodes=e.childNodes.map((function(e){return T.apply(e,[e,t,s])}))),r=s}return r}o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i,s=s&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s,u=u&&Object.prototype.hasOwnProperty.call(u,"default")?u.default:u,a=a&&Object.prototype.hasOwnProperty.call(a,"default")?a.default:a,function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",e[e.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE",e[e.DOCUMENT_NODE=9]="DOCUMENT_NODE",e[e.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",e[e.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE"}(y||(y={})),function(e){e[e.None=-1]="None",e[e.Id=0]="Id",e[e.Class=1]="Class",e[e.Attribute=2]="Attribute",e[e.TagName=3]="TagName"}(m||(m={}));var E=function(){function e(e){void 0===e&&(e=null),this.nodeValue=null,this.parentNode=e,this.nodeType=-1}var t=e.prototype;return t.cloneNode=function(e){return void 0===e&&(e=!1),T.apply(this,[this,e])},t.serialize=function(){return""},e}(),O=function(e){function t(t,n,r){var o;return void 0===t&&(t=null),void 0===r&&(r=null),(o=e.call(this,t)||this).nodeType=y.ELEMENT_NODE,o.nodeName=n,o.attributes=r||{},o.childNodes=[],o}d(t,e);var n=t.prototype;return n.append=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n=n.map((function(t){var n;return"string"==typeof t?n=new S(e,t):(n=t).parentNode=e,n})),Array.prototype.push.apply(this.childNodes,n)},n.prepend=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n=n.map((function(t){var n;return"string"==typeof t?n=new S(e,t):(n=t).parentNode=e,n})),Array.prototype.unshift.apply(this.childNodes,n)},n.replaceChildren=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n.map((function(t){var n;return"string"==typeof t?n=new S(e,t):(n=t).parentNode=e,n}));this.childNodes=o},n.querySelectorAll=function(e){var t=N(e),n=this.childNodes.filter((function(e){return!0}));return console.log(t),n.length?n:null},n.querySelector=function(e){return w(N(e),this.childNodes)},n.hasAttribute=function(e){return-1!==Object.keys(this.attributes).indexOf(e.toLowerCase())},n.getAttribute=function(e){return this.attributes[e.toLowerCase()]||null},n.setAttribute=function(e,t){this.attributes[e.toLowerCase()]=t.toString()},n.removeAttribute=function(e){delete this.attributes[e]},n.replaceChild=function(e,t){var n=this.childNodes.indexOf(t);return-1!==n&&(this.childNodes[n]=e,e.parentNode=this),t},n.removeChild=function(e){if(!(e instanceof E))throw"Uncaught TypeError: Failed to execute 'removeChild' on 'Node': parameter 1 is not of type 'Node'.";var t=this.childNodes.indexOf(e);if(-1===t)throw"Uncaught NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.";return this.childNodes.splice(t,1),e},n.insertBefore=function(e,t){void 0===t&&(t=null);var n=t?this.childNodes.indexOf(t):this.childNodes.length;return-1!==n&&(this.childNodes.splice(n,0,e),e.parentNode=this),e},n.cloneNode=function(e){return void 0===e&&(e=!1),T.apply(this,[this,e])},n.addListener=function(e,t){},n.removeListener=function(e,t){},n.serialize=function(){return"<"+this.nodeName+this.serializeAttributes()+">"+this.childNodes.map((function(e){return e.serialize()})).join("")+"</"+this.nodeName+">"},n.serializeAttributes=function(){var e=this,t="",n=Object.keys(this.attributes);return n.length&&(t=" "+n.map((function(t){return t+'="'+e.attributes[t]+'"'})).join(" ")),t},f(t,[{key:"children",get:function(){var e,t=[],n=0,r=this.childNodes;for(e=r[n++];e;)(e=r[n++]).nodeType===y.ELEMENT_NODE&&t.push(e);return t}},{key:"childElementCount",get:function(){var e,t=0,n=0,r=this.childNodes;for(e=r[t++];e;)e.nodeType===y.ELEMENT_NODE&&n++,e=r[t++];return n}},{key:"firstChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[0]),e}},{key:"firstElementChild",get:function(){for(var e,t=p(this.childNodes);!(e=t()).done;){var n=e.value;if(b(n))return n}return null}},{key:"lastElementChild",get:function(){for(var e=this.childNodes,t=e.length-1;t>-1;t--){var n=e[t];if(b(n))return n}return null}},{key:"previousSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);t>0&&(e=this.parentNode.childNodes[t-1])}return e}},{key:"nextSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);-1!==t&&t<this.parentNode.childNodes.length-1&&(e=this.parentNode.childNodes[t])}return e}},{key:"wholeText",get:function(){if(this.nodeType===y.TEXT_NODE)return this.nodeValue}},{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"classList",get:function(){return this.attributes.class?this.attributes.class.split(" ").map((function(e){return e.trim()})):[]}},{key:"innerText",set:function(e){this.childNodes=[new S(this,e)]},get:function(){return this.childNodes.filter((function(e){return g(e)||b(e)})).map((function(e){return e.innerText})).join("")}},{key:"textContent",set:function(e){this.innerText=String(e)},get:function(){return this.innerText}},{key:"innerHTML",set:function(e){var t=this,n=v(e).childNodes.map((function(e){return e.parentNode=t,e}));this.childNodes=n}}]),t}(E),S=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=y.TEXT_NODE,r.nodeValue=String(n),r}return d(t,e),t.prototype.serialize=function(){return this.nodeValue},f(t,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),t}(E),x=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=y.COMMENT_NODE,r.nodeValue=String(n),r}return d(t,e),t.prototype.serialize=function(){return"\x3c!--"+this.nodeValue+"--\x3e"},f(t,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),t}(E),j=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=y.PROCESSING_INSTRUCTION_NODE,r.nodeValue=String(n),r}return d(t,e),t.prototype.serialize=function(){return"<"+this.nodeValue+">"},t}(E),C=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=y.DOCUMENT_TYPE_NODE,r.nodeValue=String(n),r}return d(t,e),t.prototype.serialize=function(){return"<"+this.nodeValue+">"},t}(E),P=function(e){function t(){var t;return(t=e.call(this,null,"#document-fragment")||this).nodeType=y.DOCUMENT_FRAGMENT_NODE,t.childNodes=[],t}return d(t,e),t}(O),_=function(e){function t(){var t;return(t=e.call(this,null,"#document")||this).nodeType=y.DOCUMENT_NODE,t.childNodes=[],t}d(t,e),f(t,[{key:"hidden",get:function(){return!0}},{key:"visibilityState",get:function(){return"prerender"}},{key:"doctype",get:function(){return this.childNodes.find((function(e){return function(e){return e.nodeType===y.DOCUMENT_TYPE_NODE}(e)}))}},{key:"body",get:function(){return this.childNodes.find((function(e){return b(e)&&"body"===e.nodeName}))}},{key:"head",get:function(){return this.childNodes.find((function(e){return b(e)&&"head"===e.nodeName}))}},{key:"title",get:function(){var e=this.childNodes.find((function(e){return b(e)&&"title"===e.nodeName}));return e?e.innerText:null},set:function(e){var t=this.childNodes.find((function(e){return b(e)&&"title"===e.nodeName}));t&&(t.innerText=e)}},{key:"documentElement",get:function(){return this.firstElementChild}}]);var n=t.prototype;return n.createAttribute=function(){},n.createAttributeNS=function(){},n.createCDATASection=function(){},n.createComment=function(e){return new x(null,e)},n.createDocumentFragment=function(){return new P},n.createElement=function(e){return new O(null,e)},n.createElementNS=function(e){return new O(null,e)},n.createEvent=function(){},n.createNodeIterator=function(){},n.createProcessingInstruction=function(e){return new j(null,e)},n.createRange=function(){},n.createTextNode=function(e){return new S(null,e)},n.createTouchList=function(){},n.createTreeWalker=function(){},n.serialize=function(){return""+this.childNodes.map((function(e){return e.serialize()})).join("")},t}(O),A=function(){function e(){}return e.bootstrap=function(e){this.document="string"==typeof e?v(e):e,"undefined"!=typeof process&&(global.document=this.document)},e.querySelector=function(e){return this.document.querySelector(e)},e}(),k=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t.bootstrap=function(e,t){if(!t)throw"missing html template";if(A.bootstrap(t),!e)throw"missing moduleFactory";if(!e.meta)throw"missing moduleFactory meta";if(!e.meta.bootstrap)throw"missing bootstrap";if(!e.meta.bootstrap.meta)throw"missing bootstrap meta";if(!e.meta.bootstrap.meta.selector)throw"missing bootstrap meta selector";var n=this.resolveMeta(e),r=new e;r.meta=n;var o=r.compile(n.node,{});return r.instances=o,o[0].pushChanges(),r},t.querySelector=function(e){return A.document.querySelector(e)},t.serialize=function(){if(console.log("Server.serialize"),A.document instanceof _)return A.document.serialize();throw"Renderer.document is not an instance of RxDocument"},t}(n.Platform);const D=o.Readable,M=Symbol("buffer"),L=Symbol("type");class R{constructor(){this[L]="";const e=arguments[0],t=arguments[1],n=[];let r=0;if(e){const t=e,o=Number(t.length);for(let e=0;e<o;e++){const o=t[e];let i;i=o instanceof Buffer?o:ArrayBuffer.isView(o)?Buffer.from(o.buffer,o.byteOffset,o.byteLength):o instanceof ArrayBuffer?Buffer.from(o):o instanceof R?o[M]:Buffer.from("string"==typeof o?o:String(o)),r+=i.length,n.push(i)}}this[M]=Buffer.concat(n);let o=t&&void 0!==t.type&&String(t.type).toLowerCase();o&&!/[^\u0020-\u007E]/.test(o)&&(this[L]=o)}get size(){return this[M].length}get type(){return this[L]}text(){return Promise.resolve(this[M].toString())}arrayBuffer(){const e=this[M],t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(t)}stream(){const e=new D;return e._read=function(){},e.push(this[M]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,t=arguments[0],n=arguments[1];let r,o;r=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),o=void 0===n?e:n<0?Math.max(e+n,0):Math.min(n,e);const i=Math.max(o-r,0),s=this[M].slice(r,r+i),u=new R([],{type:arguments[2]});return u[M]=s,u}}function z(e,t,n){Error.call(this,e),this.message=e,this.type=t,n&&(this.code=this.errno=n.code),Error.captureStackTrace(this,this.constructor)}let B;Object.defineProperties(R.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(R.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),z.prototype=Object.create(Error.prototype),z.prototype.constructor=z,z.prototype.name="FetchError";try{B=require("encoding").convert}catch(e){}const U=Symbol("Body internals"),q=o.PassThrough;function $(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=n.size;let i=void 0===r?0:r;var s=n.timeout;let u=void 0===s?0:s;null==e?e=null:V(e)?e=Buffer.from(e.toString()):H(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof o||(e=Buffer.from(String(e)))),this[U]={body:e,disturbed:!1,error:null},this.size=i,this.timeout=u,e instanceof o&&e.on("error",(function(e){const n="AbortError"===e.name?e:new z(`Invalid response body while trying to fetch ${t.url}: ${e.message}`,"system",e);t[U].error=n}))}function I(){var e=this;if(this[U].disturbed)return $.Promise.reject(new TypeError("body used already for: "+this.url));if(this[U].disturbed=!0,this[U].error)return $.Promise.reject(this[U].error);let t=this.body;if(null===t)return $.Promise.resolve(Buffer.alloc(0));if(H(t)&&(t=t.stream()),Buffer.isBuffer(t))return $.Promise.resolve(t);if(!(t instanceof o))return $.Promise.resolve(Buffer.alloc(0));let n=[],r=0,i=!1;return new $.Promise((function(o,s){let u;e.timeout&&(u=setTimeout((function(){i=!0,s(new z(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))}),e.timeout)),t.on("error",(function(t){"AbortError"===t.name?(i=!0,s(t)):s(new z(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))})),t.on("data",(function(t){if(!i&&null!==t){if(e.size&&r+t.length>e.size)return i=!0,void s(new z(`content size at ${e.url} over limit: ${e.size}`,"max-size"));r+=t.length,n.push(t)}})),t.on("end",(function(){if(!i){clearTimeout(u);try{o(Buffer.concat(n,r))}catch(t){s(new z(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}}))}))}function V(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function H(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function F(e){let t,n,r=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return r instanceof o&&"function"!=typeof r.getBoundary&&(t=new q,n=new q,r.pipe(t),r.pipe(n),e[U].body=t,r=n),r}function G(e){return null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":V(e)?"application/x-www-form-urlencoded;charset=UTF-8":H(e)?e.type||null:Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)?null:"function"==typeof e.getBoundary?"multipart/form-data;boundary="+e.getBoundary():e instanceof o?null:"text/plain;charset=UTF-8"}function Y(e){const t=e.body;return null===t?0:H(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}$.prototype={get body(){return this[U].body},get bodyUsed(){return this[U].disturbed},arrayBuffer(){return I.call(this).then((function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}))},blob(){let e=this.headers&&this.headers.get("content-type")||"";return I.call(this).then((function(t){return Object.assign(new R([],{type:e.toLowerCase()}),{[M]:t})}))},json(){var e=this;return I.call(this).then((function(t){try{return JSON.parse(t.toString())}catch(t){return $.Promise.reject(new z(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}}))},text(){return I.call(this).then((function(e){return e.toString()}))},buffer(){return I.call(this)},textConverted(){var e=this;return I.call(this).then((function(t){return function(e,t){if("function"!=typeof B)throw new Error("The package `encoding` must be installed to use the textConverted() function");const n=t.get("content-type");let r,o,i="utf-8";n&&(r=/charset=([^;]*)/i.exec(n));o=e.slice(0,1024).toString(),!r&&o&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(o));!r&&o&&(r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o),r&&(r=/charset=(.*)/i.exec(r.pop())));!r&&o&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o));r&&(i=r.pop(),"gb2312"!==i&&"gbk"!==i||(i="gb18030"));return B(e,"UTF-8",i).toString()}(t,e.headers)}))}},Object.defineProperties($.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),$.mixIn=function(e){for(const t of Object.getOwnPropertyNames($.prototype))if(!(t in e)){const n=Object.getOwnPropertyDescriptor($.prototype,t);Object.defineProperty(e,t,n)}},$.Promise=global.Promise;const X=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,Z=/[^\t\x20-\x7e\x80-\xff]/;function J(e){if(e=""+e,X.test(e)||""===e)throw new TypeError(e+" is not a legal HTTP header name")}function K(e){if(e=""+e,Z.test(e))throw new TypeError(e+" is not a legal HTTP header value")}function W(e,t){t=t.toLowerCase();for(const n in e)if(n.toLowerCase()===t)return n}const Q=Symbol("map");class ee{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[Q]=Object.create(null),e instanceof ee){const t=e.raw(),n=Object.keys(t);for(const e of n)for(const n of t[e])this.append(e,n)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const n=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");n.push(Array.from(t))}for(const e of n){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const n=e[t];this.append(t,n)}}}}get(e){J(e=""+e);const t=W(this[Q],e);return void 0===t?null:this[Q][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=te(this),r=0;for(;r<n.length;){var o=n[r];const i=o[0],s=o[1];e.call(t,s,i,this),n=te(this),r++}}set(e,t){t=""+t,J(e=""+e),K(t);const n=W(this[Q],e);this[Q][void 0!==n?n:e]=[t]}append(e,t){t=""+t,J(e=""+e),K(t);const n=W(this[Q],e);void 0!==n?this[Q][n].push(t):this[Q][e]=[t]}has(e){return J(e=""+e),void 0!==W(this[Q],e)}delete(e){J(e=""+e);const t=W(this[Q],e);void 0!==t&&delete this[Q][t]}raw(){return this[Q]}keys(){return re(this,"key")}values(){return re(this,"value")}[Symbol.iterator](){return re(this,"key+value")}}function te(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const n=Object.keys(e[Q]).sort();return n.map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[Q][t].join(", ")}:function(t){return[t.toLowerCase(),e[Q][t].join(", ")]})}ee.prototype.entries=ee.prototype[Symbol.iterator],Object.defineProperty(ee.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(ee.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const ne=Symbol("internal");function re(e,t){const n=Object.create(oe);return n[ne]={target:e,kind:t,index:0},n}const oe=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==oe)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[ne];const t=e.target,n=e.kind,r=e.index,o=te(t,n);return r>=o.length?{value:void 0,done:!0}:(this[ne].index=r+1,{value:o[r],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function ie(e){const t=Object.assign({__proto__:null},e[Q]),n=W(e[Q],"Host");return void 0!==n&&(t[n]=t[n][0]),t}Object.defineProperty(oe,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const se=Symbol("Response internals"),ue=i.STATUS_CODES;class ae{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};$.call(this,e,t);const n=t.status||200,r=new ee(t.headers);if(null!=e&&!r.has("Content-Type")){const t=G(e);t&&r.append("Content-Type",t)}this[se]={url:t.url,status:n,statusText:t.statusText||ue[n],headers:r,counter:t.counter}}get url(){return this[se].url||""}get status(){return this[se].status}get ok(){return this[se].status>=200&&this[se].status<300}get redirected(){return this[se].counter>0}get statusText(){return this[se].statusText}get headers(){return this[se].headers}clone(){return new ae(F(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}$.mixIn(ae.prototype),Object.defineProperties(ae.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(ae.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const ce=Symbol("Request internals"),le=s.parse,fe=s.format,de="destroy"in o.Readable.prototype;function he(e){return"object"==typeof e&&"object"==typeof e[ce]}class pe{constructor(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};he(e)?t=le(e.url):(t=e&&e.href?le(e.href):le(""+e),e={});let r=n.method||e.method||"GET";if(r=r.toUpperCase(),(null!=n.body||he(e)&&null!==e.body)&&("GET"===r||"HEAD"===r))throw new TypeError("Request with GET/HEAD method cannot have body");let o=null!=n.body?n.body:he(e)&&null!==e.body?F(e):null;$.call(this,o,{timeout:n.timeout||e.timeout||0,size:n.size||e.size||0});const i=new ee(n.headers||e.headers||{});if(null!=o&&!i.has("Content-Type")){const e=G(o);e&&i.append("Content-Type",e)}let s=he(e)?e.signal:null;if("signal"in n&&(s=n.signal),null!=s&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(s))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[ce]={method:r,redirect:n.redirect||e.redirect||"follow",headers:i,parsedURL:t,signal:s},this.follow=void 0!==n.follow?n.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==n.compress?n.compress:void 0===e.compress||e.compress,this.counter=n.counter||e.counter||0,this.agent=n.agent||e.agent}get method(){return this[ce].method}get url(){return fe(this[ce].parsedURL)}get headers(){return this[ce].headers}get redirect(){return this[ce].redirect}get signal(){return this[ce].signal}clone(){return new pe(this)}}function ye(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}$.mixIn(pe.prototype),Object.defineProperty(pe.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(pe.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),ye.prototype=Object.create(Error.prototype),ye.prototype.constructor=ye,ye.prototype.name="AbortError";const me=o.PassThrough,be=s.resolve;function ge(e,t){if(!ge.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return $.Promise=ge.Promise,new ge.Promise((function(n,r){const s=new pe(e,t),c=function(e){const t=e[ce].parsedURL,n=new ee(e[ce].headers);if(n.has("Accept")||n.set("Accept","*/*"),!t.protocol||!t.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(t.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof o.Readable&&!de)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let r=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(r="0"),null!=e.body){const t=Y(e);"number"==typeof t&&(r=String(t))}r&&n.set("Content-Length",r),n.has("User-Agent")||n.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip,deflate");let i=e.agent;return"function"==typeof i&&(i=i(t)),n.has("Connection")||i||n.set("Connection","close"),Object.assign({},t,{method:e.method,headers:ie(n),agent:i})}(s),l=("https:"===c.protocol?u:i).request,f=s.signal;let d=null;const h=function(){let e=new ye("The user aborted a request.");r(e),s.body&&s.body instanceof o.Readable&&s.body.destroy(e),d&&d.body&&d.body.emit("error",e)};if(f&&f.aborted)return void h();const p=function(){h(),b()},y=l(c);let m;function b(){y.abort(),f&&f.removeEventListener("abort",p),clearTimeout(m)}f&&f.addEventListener("abort",p),s.timeout&&y.once("socket",(function(e){m=setTimeout((function(){r(new z("network timeout at: "+s.url,"request-timeout")),b()}),s.timeout)})),y.on("error",(function(e){r(new z(`request to ${s.url} failed, reason: ${e.message}`,"system",e)),b()})),y.on("response",(function(e){clearTimeout(m);const t=function(e){const t=new ee;for(const n of Object.keys(e))if(!X.test(n))if(Array.isArray(e[n]))for(const r of e[n])Z.test(r)||(void 0===t[Q][n]?t[Q][n]=[r]:t[Q][n].push(r));else Z.test(e[n])||(t[Q][n]=[e[n]]);return t}(e.headers);if(ge.isRedirect(e.statusCode)){const o=t.get("Location"),i=null===o?null:be(s.url,o);switch(s.redirect){case"error":return r(new z("redirect mode is set to error: "+s.url,"no-redirect")),void b();case"manual":if(null!==i)try{t.set("Location",i)}catch(e){r(e)}break;case"follow":if(null===i)break;if(s.counter>=s.follow)return r(new z("maximum redirect reached at: "+s.url,"max-redirect")),void b();const o={headers:new ee(s.headers),follow:s.follow,counter:s.counter+1,agent:s.agent,compress:s.compress,method:s.method,body:s.body,signal:s.signal,timeout:s.timeout};return 303!==e.statusCode&&s.body&&null===Y(s)?(r(new z("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void b()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==s.method)||(o.method="GET",o.body=void 0,o.headers.delete("content-length")),n(ge(new pe(i,o))),void b())}}e.once("end",(function(){f&&f.removeEventListener("abort",p)}));let o=e.pipe(new me);const i={url:s.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:s.size,timeout:s.timeout,counter:s.counter},u=t.get("Content-Encoding");if(!s.compress||"HEAD"===s.method||null===u||204===e.statusCode||304===e.statusCode)return d=new ae(o,i),void n(d);const c={flush:a.Z_SYNC_FLUSH,finishFlush:a.Z_SYNC_FLUSH};if("gzip"==u||"x-gzip"==u)return o=o.pipe(a.createGunzip(c)),d=new ae(o,i),void n(d);if("deflate"!=u&&"x-deflate"!=u){if("br"==u&&"function"==typeof a.createBrotliDecompress)return o=o.pipe(a.createBrotliDecompress()),d=new ae(o,i),void n(d);d=new ae(o,i),n(d)}else{e.pipe(new me).once("data",(function(e){o=8==(15&e[0])?o.pipe(a.createInflate()):o.pipe(a.createInflateRaw()),d=new ae(o,i),n(d)}))}})),function(e,t){const n=t.body;null===n?e.end():H(n)?n.stream().pipe(e):Buffer.isBuffer(n)?(e.write(n),e.end()):n.pipe(e)}(y,s)}))}ge.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},ge.Promise=global.Promise;var ve,Ne=(ve=Object.freeze({__proto__:null,default:ge,Headers:ee,Request:pe,Response:ae,FetchError:z}))&&ve.default||ve,we=function(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}((function(e,t){var n=Ne.default||Ne,r=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),n.call(this,e,t)};e.exports=t=r,t.fetch=r,t.Headers=Ne.Headers,t.Request=Ne.Request,t.Response=Ne.Response,t.default=r})),Te=function(){function e(e){this.url="",this.status=0,this.statusText="",this.ok=!1,this.redirected=!1,this.data=null,e&&(this.url=e.url,this.status=e.status,this.statusText=e.statusText,this.ok=e.ok,this.redirected=e.redirected)}return f(e,[{key:"static",get:function(){return this.url.indexOf(".json")===this.url.length-5}}]),e}(),Ee=function(){function e(){}return e.http$=function(e,n,r,o){var i=this;void 0===o&&(o="json"),e=-1!==n.indexOf(".json")?"GET":e;var s=null;return this.pendingRequests$.next(this.pendingRequests$.getValue()+1),c.from(we(n,{method:e,headers:{Accept:"application/json","Content-Type":"application/json"},body:-1!==["POST","PUT","PATCH"].indexOf(e)?JSON.stringify(r):void 0}).then((function(e){return s=new Te(e),"function"==typeof e[o]?e[o]().then((function(t){return s.data=t,e.ok?Promise.resolve(s):Promise.reject(s)})):Promise.reject(s)}))).pipe(t.catchError((function(e){return console.log("error",e),c.throwError(i.getError(e,s))})),t.finalize((function(){i.pendingRequests$.next(i.pendingRequests$.getValue()-1)})))},e.get$=function(e,t,n){var r=this.query(t);return this.http$("GET",""+e+r,void 0,n)},e.delete$=function(e){return this.http$("DELETE",e)},e.post$=function(e,t){return this.http$("POST",e,t)},e.put$=function(e,t){return this.http$("PUT",e,t)},e.patch$=function(e,t){return this.http$("PATCH",e,t)},e.query=function(e){return""},e.getError=function(e,t){var n="object"==typeof e?e:{};return n.statusCode||(n.statusCode=t?t.status:0),n.statusMessage||(n.statusMessage=t?t.statusText:e),n},e}();Ee.pendingRequests$=new c.BehaviorSubject(0);var Oe=function(e){function n(){return e.apply(this,arguments)||this}d(n,e);var r=n.prototype;return r.onInit=function(){var e=this;this.items=new Array(4).fill(0).map((function(e,t){return{title:"item "+(t+1),completed:Math.random()>.75}})),this.flag=!0,this.active=!1,Ee.get$("https://jsonplaceholder.typicode.com/users/1/todos").pipe(t.first()).subscribe((function(t){console.log("AppComponent.items",t),e.items=t.data,e.pushChanges()}))},r.onClick=function(e){console.log("onClick",e)},n}(n.Component);Oe.meta={selector:"[app-component]"};var Se=function(e){function t(){return e.apply(this,arguments)||this}return d(t,e),t}(n.Module);Se.meta={imports:[n.CoreModule],declarations:[],bootstrap:Oe},e.renderServer=function(e){return k.bootstrap(Se,e),Ee.pendingRequests$.pipe(t.filter((function(e){return 0===e})),t.map((function(e){return k.serialize()})),t.first())},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=main.server.umd.min.js.map