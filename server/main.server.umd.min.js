/**
 * @license rxcomp-server v1.0.0-beta.12
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("stream"),require("http"),require("url"),require("https"),require("zlib"),require("rxjs/operators"),require("htmlparser2"),require("rxcomp"),require("rxjs")):"function"==typeof define&&define.amd?define(["exports","stream","http","url","https","zlib","rxjs/operators","htmlparser2","rxcomp","rxjs"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).main=e.main||{},e.main.server=e.main.server||{},e.main.server.umd={}),e.Stream,e.http,e.Url,e.https,e.zlib,e.rxjs.operators,e.htmlparser2,e.rxcomp,e.rxjs)}(this,(function(e,t,n,r,o,i,s,u,a,l){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var c="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};const f=t.Readable,d=Symbol("buffer"),h=Symbol("type");class p{constructor(){this[h]="";const e=arguments[0],t=arguments[1],n=[];let r=0;if(e){const t=e,o=Number(t.length);for(let e=0;e<o;e++){const o=t[e];let i;i=o instanceof Buffer?o:ArrayBuffer.isView(o)?Buffer.from(o.buffer,o.byteOffset,o.byteLength):o instanceof ArrayBuffer?Buffer.from(o):o instanceof p?o[d]:Buffer.from("string"==typeof o?o:String(o)),r+=i.length,n.push(i)}}this[d]=Buffer.concat(n);let o=t&&void 0!==t.type&&String(t.type).toLowerCase();o&&!/[^\u0020-\u007E]/.test(o)&&(this[h]=o)}get size(){return this[d].length}get type(){return this[h]}text(){return Promise.resolve(this[d].toString())}arrayBuffer(){const e=this[d],t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(t)}stream(){const e=new f;return e._read=function(){},e.push(this[d]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,t=arguments[0],n=arguments[1];let r,o;r=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),o=void 0===n?e:n<0?Math.max(e+n,0):Math.min(n,e);const i=Math.max(o-r,0),s=this[d].slice(r,r+i),u=new p([],{type:arguments[2]});return u[d]=s,u}}function y(e,t,n){Error.call(this,e),this.message=e,this.type=t,n&&(this.code=this.errno=n.code),Error.captureStackTrace(this,this.constructor)}let m;Object.defineProperties(p.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(p.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),y.prototype=Object.create(Error.prototype),y.prototype.constructor=y,y.prototype.name="FetchError";try{m=require("encoding").convert}catch(e){}const b=Symbol("Body internals"),g=t.PassThrough;function v(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.size;let i=void 0===o?0:o;var s=r.timeout;let u=void 0===s?0:s;null==e?e=null:N(e)?e=Buffer.from(e.toString()):T(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof t||(e=Buffer.from(String(e)))),this[b]={body:e,disturbed:!1,error:null},this.size=i,this.timeout=u,e instanceof t&&e.on("error",(function(e){const t="AbortError"===e.name?e:new y(`Invalid response body while trying to fetch ${n.url}: ${e.message}`,"system",e);n[b].error=t}))}function w(){var e=this;if(this[b].disturbed)return v.Promise.reject(new TypeError("body used already for: "+this.url));if(this[b].disturbed=!0,this[b].error)return v.Promise.reject(this[b].error);let n=this.body;if(null===n)return v.Promise.resolve(Buffer.alloc(0));if(T(n)&&(n=n.stream()),Buffer.isBuffer(n))return v.Promise.resolve(n);if(!(n instanceof t))return v.Promise.resolve(Buffer.alloc(0));let r=[],o=0,i=!1;return new v.Promise((function(t,s){let u;e.timeout&&(u=setTimeout((function(){i=!0,s(new y(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))}),e.timeout)),n.on("error",(function(t){"AbortError"===t.name?(i=!0,s(t)):s(new y(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))})),n.on("data",(function(t){if(!i&&null!==t){if(e.size&&o+t.length>e.size)return i=!0,void s(new y(`content size at ${e.url} over limit: ${e.size}`,"max-size"));o+=t.length,r.push(t)}})),n.on("end",(function(){if(!i){clearTimeout(u);try{t(Buffer.concat(r,o))}catch(t){s(new y(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}}))}))}function N(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function T(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function O(e){let n,r,o=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof t&&"function"!=typeof o.getBoundary&&(n=new g,r=new g,o.pipe(n),o.pipe(r),e[b].body=n,o=r),o}function E(e){return null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":N(e)?"application/x-www-form-urlencoded;charset=UTF-8":T(e)?e.type||null:Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)?null:"function"==typeof e.getBoundary?"multipart/form-data;boundary="+e.getBoundary():e instanceof t?null:"text/plain;charset=UTF-8"}function x(e){const t=e.body;return null===t?0:T(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}v.prototype={get body(){return this[b].body},get bodyUsed(){return this[b].disturbed},arrayBuffer(){return w.call(this).then((function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}))},blob(){let e=this.headers&&this.headers.get("content-type")||"";return w.call(this).then((function(t){return Object.assign(new p([],{type:e.toLowerCase()}),{[d]:t})}))},json(){var e=this;return w.call(this).then((function(t){try{return JSON.parse(t.toString())}catch(t){return v.Promise.reject(new y(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}}))},text(){return w.call(this).then((function(e){return e.toString()}))},buffer(){return w.call(this)},textConverted(){var e=this;return w.call(this).then((function(t){return function(e,t){if("function"!=typeof m)throw new Error("The package `encoding` must be installed to use the textConverted() function");const n=t.get("content-type");let r,o,i="utf-8";n&&(r=/charset=([^;]*)/i.exec(n));o=e.slice(0,1024).toString(),!r&&o&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(o));!r&&o&&(r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o),r&&(r=/charset=(.*)/i.exec(r.pop())));!r&&o&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o));r&&(i=r.pop(),"gb2312"!==i&&"gbk"!==i||(i="gb18030"));return m(e,"UTF-8",i).toString()}(t,e.headers)}))}},Object.defineProperties(v.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),v.mixIn=function(e){for(const t of Object.getOwnPropertyNames(v.prototype))if(!(t in e)){const n=Object.getOwnPropertyDescriptor(v.prototype,t);Object.defineProperty(e,t,n)}},v.Promise=global.Promise;const j=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,S=/[^\t\x20-\x7e\x80-\xff]/;function C(e){if(e=""+e,j.test(e)||""===e)throw new TypeError(e+" is not a legal HTTP header name")}function _(e){if(e=""+e,S.test(e))throw new TypeError(e+" is not a legal HTTP header value")}function P(e,t){t=t.toLowerCase();for(const n in e)if(n.toLowerCase()===t)return n}const A=Symbol("map");class k{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[A]=Object.create(null),e instanceof k){const t=e.raw(),n=Object.keys(t);for(const e of n)for(const n of t[e])this.append(e,n)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const n=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");n.push(Array.from(t))}for(const e of n){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const n=e[t];this.append(t,n)}}}}get(e){C(e=""+e);const t=P(this[A],e);return void 0===t?null:this[A][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=D(this),r=0;for(;r<n.length;){var o=n[r];const i=o[0],s=o[1];e.call(t,s,i,this),n=D(this),r++}}set(e,t){t=""+t,C(e=""+e),_(t);const n=P(this[A],e);this[A][void 0!==n?n:e]=[t]}append(e,t){t=""+t,C(e=""+e),_(t);const n=P(this[A],e);void 0!==n?this[A][n].push(t):this[A][e]=[t]}has(e){return C(e=""+e),void 0!==P(this[A],e)}delete(e){C(e=""+e);const t=P(this[A],e);void 0!==t&&delete this[A][t]}raw(){return this[A]}keys(){return R(this,"key")}values(){return R(this,"value")}[Symbol.iterator](){return R(this,"key+value")}}function D(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const n=Object.keys(e[A]).sort();return n.map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[A][t].join(", ")}:function(t){return[t.toLowerCase(),e[A][t].join(", ")]})}k.prototype.entries=k.prototype[Symbol.iterator],Object.defineProperty(k.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(k.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const z=Symbol("internal");function R(e,t){const n=Object.create(L);return n[z]={target:e,kind:t,index:0},n}const L=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==L)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[z];const t=e.target,n=e.kind,r=e.index,o=D(t,n);return r>=o.length?{value:void 0,done:!0}:(this[z].index=r+1,{value:o[r],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function M(e){const t=Object.assign({__proto__:null},e[A]),n=P(e[A],"Host");return void 0!==n&&(t[n]=t[n][0]),t}Object.defineProperty(L,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const B=Symbol("Response internals"),U=n.STATUS_CODES;class ${constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v.call(this,e,t);const n=t.status||200,r=new k(t.headers);if(null!=e&&!r.has("Content-Type")){const t=E(e);t&&r.append("Content-Type",t)}this[B]={url:t.url,status:n,statusText:t.statusText||U[n],headers:r,counter:t.counter}}get url(){return this[B].url||""}get status(){return this[B].status}get ok(){return this[B].status>=200&&this[B].status<300}get redirected(){return this[B].counter>0}get statusText(){return this[B].statusText}get headers(){return this[B].headers}clone(){return new $(O(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}v.mixIn($.prototype),Object.defineProperties($.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty($.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const q=Symbol("Request internals"),I=r.parse,V=r.format,H="destroy"in t.Readable.prototype;function F(e){return"object"==typeof e&&"object"==typeof e[q]}class G{constructor(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};F(e)?t=I(e.url):(t=e&&e.href?I(e.href):I(""+e),e={});let r=n.method||e.method||"GET";if(r=r.toUpperCase(),(null!=n.body||F(e)&&null!==e.body)&&("GET"===r||"HEAD"===r))throw new TypeError("Request with GET/HEAD method cannot have body");let o=null!=n.body?n.body:F(e)&&null!==e.body?O(e):null;v.call(this,o,{timeout:n.timeout||e.timeout||0,size:n.size||e.size||0});const i=new k(n.headers||e.headers||{});if(null!=o&&!i.has("Content-Type")){const e=E(o);e&&i.append("Content-Type",e)}let s=F(e)?e.signal:null;if("signal"in n&&(s=n.signal),null!=s&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(s))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[q]={method:r,redirect:n.redirect||e.redirect||"follow",headers:i,parsedURL:t,signal:s},this.follow=void 0!==n.follow?n.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==n.compress?n.compress:void 0===e.compress||e.compress,this.counter=n.counter||e.counter||0,this.agent=n.agent||e.agent}get method(){return this[q].method}get url(){return V(this[q].parsedURL)}get headers(){return this[q].headers}get redirect(){return this[q].redirect}get signal(){return this[q].signal}clone(){return new G(this)}}function Y(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}v.mixIn(G.prototype),Object.defineProperty(G.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(G.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),Y.prototype=Object.create(Error.prototype),Y.prototype.constructor=Y,Y.prototype.name="AbortError";const X=t.PassThrough,J=r.resolve;function Z(e,r){if(!Z.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return v.Promise=Z.Promise,new Z.Promise((function(s,u){const a=new G(e,r),l=function(e){const n=e[q].parsedURL,r=new k(e[q].headers);if(r.has("Accept")||r.set("Accept","*/*"),!n.protocol||!n.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(n.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof t.Readable&&!H)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let o=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(o="0"),null!=e.body){const t=x(e);"number"==typeof t&&(o=String(t))}o&&r.set("Content-Length",o),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");let i=e.agent;return"function"==typeof i&&(i=i(n)),r.has("Connection")||i||r.set("Connection","close"),Object.assign({},n,{method:e.method,headers:M(r),agent:i})}(a),c=("https:"===l.protocol?o:n).request,f=a.signal;let d=null;const h=function(){let e=new Y("The user aborted a request.");u(e),a.body&&a.body instanceof t.Readable&&a.body.destroy(e),d&&d.body&&d.body.emit("error",e)};if(f&&f.aborted)return void h();const p=function(){h(),g()},m=c(l);let b;function g(){m.abort(),f&&f.removeEventListener("abort",p),clearTimeout(b)}f&&f.addEventListener("abort",p),a.timeout&&m.once("socket",(function(e){b=setTimeout((function(){u(new y("network timeout at: "+a.url,"request-timeout")),g()}),a.timeout)})),m.on("error",(function(e){u(new y(`request to ${a.url} failed, reason: ${e.message}`,"system",e)),g()})),m.on("response",(function(e){clearTimeout(b);const t=function(e){const t=new k;for(const n of Object.keys(e))if(!j.test(n))if(Array.isArray(e[n]))for(const r of e[n])S.test(r)||(void 0===t[A][n]?t[A][n]=[r]:t[A][n].push(r));else S.test(e[n])||(t[A][n]=[e[n]]);return t}(e.headers);if(Z.isRedirect(e.statusCode)){const n=t.get("Location"),r=null===n?null:J(a.url,n);switch(a.redirect){case"error":return u(new y("redirect mode is set to error: "+a.url,"no-redirect")),void g();case"manual":if(null!==r)try{t.set("Location",r)}catch(e){u(e)}break;case"follow":if(null===r)break;if(a.counter>=a.follow)return u(new y("maximum redirect reached at: "+a.url,"max-redirect")),void g();const n={headers:new k(a.headers),follow:a.follow,counter:a.counter+1,agent:a.agent,compress:a.compress,method:a.method,body:a.body,signal:a.signal,timeout:a.timeout};return 303!==e.statusCode&&a.body&&null===x(a)?(u(new y("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void g()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==a.method)||(n.method="GET",n.body=void 0,n.headers.delete("content-length")),s(Z(new G(r,n))),void g())}}e.once("end",(function(){f&&f.removeEventListener("abort",p)}));let n=e.pipe(new X);const r={url:a.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:a.size,timeout:a.timeout,counter:a.counter},o=t.get("Content-Encoding");if(!a.compress||"HEAD"===a.method||null===o||204===e.statusCode||304===e.statusCode)return d=new $(n,r),void s(d);const l={flush:i.Z_SYNC_FLUSH,finishFlush:i.Z_SYNC_FLUSH};if("gzip"==o||"x-gzip"==o)return n=n.pipe(i.createGunzip(l)),d=new $(n,r),void s(d);if("deflate"!=o&&"x-deflate"!=o){if("br"==o&&"function"==typeof i.createBrotliDecompress)return n=n.pipe(i.createBrotliDecompress()),d=new $(n,r),void s(d);d=new $(n,r),s(d)}else{e.pipe(new X).once("data",(function(e){n=8==(15&e[0])?n.pipe(i.createInflate()):n.pipe(i.createInflateRaw()),d=new $(n,r),s(d)}))}})),function(e,t){const n=t.body;null===n?e.end():T(n)?n.stream().pipe(e):Buffer.isBuffer(n)?(e.write(n),e.end()):n.pipe(e)}(m,a)}))}Z.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},Z.Promise=global.Promise;var K,W,Q,ee=(K=Object.freeze({__proto__:null,default:Z,Headers:k,Request:G,Response:$,FetchError:y}))&&K.default||K,te=function(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}((function(e,t){var n=ee.default||ee,r=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),n.call(this,e,t)};e.exports=t=r,t.fetch=r,t.Headers=ee.Headers,t.Request=ee.Request,t.Response=ee.Response,t.default=r})),ne=te.fetch.bind({});function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oe(e,t,n){return t&&re(e.prototype,t),n&&re(e,n),e}function ie(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function se(e){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ae(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function le(e,t,n){return(le=ae()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&ue(o,n.prototype),o}).apply(null,arguments)}function ce(e){var t="function"==typeof Map?new Map:void 0;return(ce=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return le(e,arguments,se(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ue(r,e)})(e)}function fe(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function de(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function he(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return de(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?de(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}function pe(e){return e.nodeType===W.ELEMENT_NODE}function ye(e){return e.nodeType===W.TEXT_NODE}function me(e){var t,n=new Pe,r=n,o=new u.Parser({onopentag:function(e,n){t=new Ee(r,e,n),r.childNodes.push(t),r=t},onclosetag:function(e){r.parentNode&&(r=r.parentNode)},ontext:function(e){var t=new xe(r,e);r.childNodes.push(t)},onprocessinginstruction:function(e,n){t="!doctype"===e?new Ce(r,n):new Se(r,n),r.childNodes.push(t)},oncomment:function(e){t=new je(r,e),r.childNodes.push(t)},oncommentend:function(){},oncdatastart:function(){console.log("oncdatastart")},oncdataend:function(){console.log("oncdataend")},onerror:function(e){console.log("error",e)}},{decodeEntities:!1,lowerCaseTags:!0});return o.write(e),o.end(),n}function be(e){var t=[];return e.trim().split(" ").forEach((function(e){e.trim().split(">").forEach((function(e,n){for(var r,o=[],i=he(e.matchAll(/\:not\(\#([^\.[#:]+)\)|\:not\(\.([^\.[#:]+)\)|\:not\(\[([^\.\[#:]+)\]\)|\:not\(([^\.\[#:\]]+)\)|\#([^\.[#:]+)|\.([^\.[#:]+)|\[([^\.\[#:]+)\]|([^\.\[#:\]]+)/g));!(r=i()).done;){var s=r.value;s[1]?o.push({selector:s[1],type:Q.Id,negate:!0}):s[2]?o.push({selector:s[2],type:Q.Class,negate:!0}):s[3]?o.push({selector:s[3],type:Q.Attribute,negate:!0}):s[4]?o.push({selector:s[4],type:Q.TagName,negate:!0}):s[5]?o.push({selector:s[5],type:Q.Id,negate:!1}):s[6]?o.push({selector:s[6],type:Q.Class,negate:!1}):s[7]?o.push({selector:s[7],type:Q.Attribute,negate:!1}):s[8]&&o.push({selector:s[8],type:Q.TagName,negate:!1})}var u=n>0?{selector:e,selectors:o,inner:!0}:{selector:e,selectors:o,inner:!1};t.push.call(t,u)}))})),t}function ge(e,t){return t.reduce((function(t,n){return t&&function(e,t){switch(t.type){case Q.Id:return(""!==t.selector&&e.attributes.id===t.selector)!==t.negate;case Q.Class:return-1!==e.classList.indexOf(t.selector)!==t.negate;case Q.Attribute:return-1!==Object.keys(e.attributes).indexOf(t.selector)!==t.negate;case Q.TagName:return e.nodeName===t.selector!==t.negate;default:return!1}}(e,n)}),!0)}function ve(e,t,n){void 0===n&&(n=null);var r=null;if(n||e.length){n=n||e.shift();for(var o,i=he(t);!(o=i()).done;){var s=o.value;if(s instanceof Ee){if(ge(s,n.selectors))return e.length?ve(e,s.childNodes):s;n.inner||(r=ve(e,s.childNodes,n))}}}return r}function we(e,t,n){var r;if(void 0===t&&(t=!1),void 0===n&&(n=null),pe(e)){var o=new Ee(n,e.nodeName,Object.assign({},e.attributes));t&&(o.childNodes=e.childNodes.map((function(e){return we.apply(e,[e,t,o])}))),r=o}else if(e.nodeType===W.DOCUMENT_FRAGMENT_NODE){var i=new _e;t&&(i.childNodes=e.childNodes.map((function(e){return we.apply(e,[e,t,i])}))),r=i}else if(ye(e))r=new xe(n,e.nodeValue);else if(function(e){return e.nodeType===W.COMMENT_NODE}(e))r=new je(n,e.nodeValue);else{if(!function(e){return e.nodeType===W.DOCUMENT_NODE}(e))throw"Invalid node type";var s=new Pe;t&&(s.childNodes=e.childNodes.map((function(e){return we.apply(e,[e,t,s])}))),r=s}return r}ne.polyfill=!0,c.fetch||(c.fetch=ne,c.Response=te.Response,c.Headers=te.Headers,c.Request=te.Request),function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",e[e.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE",e[e.DOCUMENT_NODE=9]="DOCUMENT_NODE",e[e.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",e[e.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE"}(W||(W={})),function(e){e[e.None=-1]="None",e[e.Id=0]="Id",e[e.Class=1]="Class",e[e.Attribute=2]="Attribute",e[e.TagName=3]="TagName"}(Q||(Q={}));var Ne=function(){function e(e){void 0===e&&(e=null),this.nodeValue=null,this.parentNode=e,this.nodeType=-1}var t=e.prototype;return t.cloneNode=function(e){return void 0===e&&(e=!1),we.apply(this,[this,e])},t.serialize=function(){return""},e}(),Te=function(){var e=t.prototype;function t(e){Object.defineProperty(this,"node",{value:e,writable:!1,enumerable:!1}),this.init()}return e.item=function(e){var t=Object.keys(this);return t.length>e?t[e]:void 0},e.getPropertyPriority=function(e){var t=this[e];return t&&t.indexOf("!important")?"important":""},e.getPropertyValue=function(e){return this[e]},e.setProperty=function(e,t,n){this[e]=t+("important"===n?"!important":""),this.serialize_()},e.removeProperty=function(e){delete this[e],this.serialize_()},e.serialize_=function(){var e=this;this.node.attributes.style=Object.keys(this).map((function(t){return t+": "+e[t]+";"})).join(" ")},e.init=function(){var e,t=this;if(Object.keys(this).forEach((function(e){return delete t[e]})),null==(e=this.node.attributes)?void 0:e.style){[].concat(this.node.attributes.style.matchAll(/([^:]+):([^;]+);?\s*/gm)).forEach((function(e){var n=e[1],r=e[2];t[n]=r}))}},t}(),Oe=function(e){function t(t){var n;return(n=e.call(this)||this).node=t,n.init(),n}ie(t,e);var n=t.prototype;return n.item=function(e){return this[e]},n.contains=function(e){return-1!==this.indexOf(e)},n.add=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){-1!==e.indexOf(t)&&e.push(t)})),this.serialize_()},n.remove=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)})),this.serialize_()},n.toggle=function(e,t){var n=this.indexOf(e);return!1===t?(this.splice(n,1),this.serialize_(),!1):!0===t?(this.push(e),this.serialize_(),!0):-1!==n?(this.splice(n,1),this.serialize_(),!1):(this.push(e),this.serialize_(),!0)},n.replace=function(e,t){var n=this.indexOf(e);-1!==n&&this.splice(n,1),this.push(t),this.serialize_()},n.serialize_=function(){this.node.attributes.class=this.join(" ")},n.init=function(){var e;this.length=0,(null==(e=this.node.attributes)?void 0:e.class)&&Array.prototype.push.apply(this,this.node.attributes.class.split(" ").map((function(e){return e.trim()})))},t}(ce(Array)),Ee=function(e){function t(t,n,r){var o;return void 0===t&&(t=null),void 0===r&&(r=null),(o=e.call(this,t)||this).attributes={},o.nodeType=W.ELEMENT_NODE,o.nodeName=n,r&&"object"==typeof r&&(o.attributes=r),o.style=new Te(fe(o)),o.classList=new Oe(fe(o)),o.childNodes=[],o}ie(t,e);var n=t.prototype;return n.append=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n=n.map((function(t){var n;return"string"==typeof t?n=new xe(e,t):(n=t).parentNode=e,n})),Array.prototype.push.apply(this.childNodes,n)},n.prepend=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n=n.map((function(t){var n;return"string"==typeof t?n=new xe(e,t):(n=t).parentNode=e,n})),Array.prototype.unshift.apply(this.childNodes,n)},n.replaceChildren=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n.map((function(t){var n;return"string"==typeof t?n=new xe(e,t):(n=t).parentNode=e,n}));this.childNodes=o},n.querySelectorAll=function(e){var t=be(e),n=this.childNodes.filter((function(e){return!0}));return console.log(t),n.length?n:null},n.querySelector=function(e){return ve(be(e),this.childNodes)},n.hasAttribute=function(e){return-1!==Object.keys(this.attributes).indexOf(e.toLowerCase())},n.getAttribute=function(e){return this.attributes[e.toLowerCase()]||null},n.setAttribute=function(e,t){this.attributes[e.toLowerCase()]=t.toString(),"style"===e?this.style.init():"class"===e&&this.classList.init()},n.removeAttribute=function(e){delete this.attributes[e],"style"===e?this.style.init():"class"===e&&this.classList.init()},n.replaceChild=function(e,t){var n=this.childNodes.indexOf(t);return-1!==n&&(this.childNodes[n]=e,e.parentNode=this),t},n.removeChild=function(e){if(!(e instanceof Ne))throw"Uncaught TypeError: Failed to execute 'removeChild' on 'Node': parameter 1 is not of type 'Node'.";var t=this.childNodes.indexOf(e);if(-1===t)throw"Uncaught NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.";return this.childNodes.splice(t,1),e},n.insertBefore=function(e,t){void 0===t&&(t=null);var n=t?this.childNodes.indexOf(t):this.childNodes.length;return-1!==n&&(this.childNodes.splice(n,0,e),e.parentNode=this),e},n.cloneNode=function(e){return void 0===e&&(e=!1),we.apply(this,[this,e])},n.addListener=function(e,t){},n.removeListener=function(e,t){},n.serialize=function(){return"<"+this.nodeName+this.serializeAttributes()+">"+this.childNodes.map((function(e){return e.serialize()})).join("")+"</"+this.nodeName+">"},n.serializeAttributes=function(){var e=this,t="",n=Object.keys(this.attributes);return n.length&&(t=" "+n.map((function(t){return t+'="'+e.attributes[t]+'"'})).join(" ")),t},oe(t,[{key:"children",get:function(){var e,t=[],n=0,r=this.childNodes;for(e=r[n++];e;)(e=r[n++]).nodeType===W.ELEMENT_NODE&&t.push(e);return t}},{key:"childElementCount",get:function(){var e,t=0,n=0,r=this.childNodes;for(e=r[t++];e;)e.nodeType===W.ELEMENT_NODE&&n++,e=r[t++];return n}},{key:"firstChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[0]),e}},{key:"firstElementChild",get:function(){for(var e,t=he(this.childNodes);!(e=t()).done;){var n=e.value;if(pe(n))return n}return null}},{key:"lastChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[this.childNodes.length-1]),e}},{key:"lastElementChild",get:function(){for(var e=this.childNodes,t=e.length-1;t>-1;t--){var n=e[t];if(pe(n))return n}return null}},{key:"previousSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);t>0&&(e=this.parentNode.childNodes[t-1])}return e}},{key:"nextSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);-1!==t&&t<this.parentNode.childNodes.length-1&&(e=this.parentNode.childNodes[t])}return e}},{key:"wholeText",get:function(){if(this.nodeType===W.TEXT_NODE)return this.nodeValue}},{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"innerText",set:function(e){this.childNodes=[new xe(this,e)]},get:function(){return this.childNodes.filter((function(e){return ye(e)||pe(e)})).map((function(e){return e.innerText})).join("")}},{key:"textContent",set:function(e){this.innerText=String(e)},get:function(){return this.innerText}},{key:"innerHTML",get:function(){return this.childNodes.map((function(e){return e.serialize()})).join("")},set:function(e){var t=this,n=me(e).childNodes.map((function(e){return e.parentNode=t,e}));this.childNodes=n}}]),t}(Ne),xe=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=W.TEXT_NODE,r.nodeValue=String(n),r}return ie(t,e),t.prototype.serialize=function(){return this.nodeValue},oe(t,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),t}(Ne),je=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=W.COMMENT_NODE,r.nodeValue=String(n),r}return ie(t,e),t.prototype.serialize=function(){return"\x3c!--"+this.nodeValue+"--\x3e"},oe(t,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),t}(Ne),Se=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=W.PROCESSING_INSTRUCTION_NODE,r.nodeValue=String(n),r}return ie(t,e),t.prototype.serialize=function(){return"<"+this.nodeValue+">"},t}(Ne),Ce=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=W.DOCUMENT_TYPE_NODE,r.nodeValue=String(n),r}return ie(t,e),t.prototype.serialize=function(){return"<"+this.nodeValue+">"},t}(Ne),_e=function(e){function t(){var t;return(t=e.call(this,null,"#document-fragment")||this).nodeType=W.DOCUMENT_FRAGMENT_NODE,t.childNodes=[],t}return ie(t,e),t}(Ee),Pe=function(e){function t(){var t;return(t=e.call(this,null,"#document")||this).nodeType=W.DOCUMENT_NODE,t.childNodes=[],t}ie(t,e),oe(t,[{key:"hidden",get:function(){return!0}},{key:"visibilityState",get:function(){return"prerender"}},{key:"doctype",get:function(){return this.childNodes.find((function(e){return function(e){return e.nodeType===W.DOCUMENT_TYPE_NODE}(e)}))}},{key:"body",get:function(){return this.childNodes.find((function(e){return pe(e)&&"body"===e.nodeName}))}},{key:"head",get:function(){return this.childNodes.find((function(e){return pe(e)&&"head"===e.nodeName}))}},{key:"title",get:function(){var e=this.childNodes.find((function(e){return pe(e)&&"title"===e.nodeName}));return e?e.innerText:null},set:function(e){var t=this.childNodes.find((function(e){return pe(e)&&"title"===e.nodeName}));t&&(t.innerText=e)}},{key:"documentElement",get:function(){return this.firstElementChild}}]);var n=t.prototype;return n.createAttribute=function(){},n.createAttributeNS=function(){},n.createCDATASection=function(){},n.createComment=function(e){return new je(null,e)},n.createDocumentFragment=function(){return new _e},n.createElement=function(e){return new Ee(null,e)},n.createElementNS=function(e){return new Ee(null,e)},n.createEvent=function(){},n.createNodeIterator=function(){},n.createProcessingInstruction=function(e){return new Se(null,e)},n.createRange=function(){},n.createTextNode=function(e){return new xe(null,e)},n.createTouchList=function(){},n.createTreeWalker=function(){},n.serialize=function(){return""+this.childNodes.map((function(e){return e.serialize()})).join("")},t}(Ee),Ae=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t.bootstrap=function(e,t){if(!a.isPlatformServer)throw"missing platform server, node process not found";if(!e)throw"missing moduleFactory";if(!e.meta)throw"missing moduleFactory meta";if(!e.meta.bootstrap)throw"missing bootstrap";if(!e.meta.bootstrap.meta)throw"missing bootstrap meta";if(!e.meta.bootstrap.meta.selector)throw"missing bootstrap meta selector";if(!t)throw"missing html template";var n=this.resolveGlobals(t),r=this.resolveMeta(e);if(r.node instanceof Ee){var o,i=r.node,s=r.nodeInnerHTML,u={selector:e.meta.bootstrap.meta.selector,innerHTML:s},l=new Ee(null,"script"),c=new xe(null,"var rxcomp_hydrate_ = "+JSON.stringify(u)+";");l.append(c),null==(o=i.parentNode)||o.insertBefore(l,i)}var f=new e;f.meta=r;var d=f.compile(r.node,{document:n});return f.instances=d,d[0].pushChanges(),f},t.serialize=function(){if(console.log("Server.serialize"),this.document instanceof Pe)return this.document.serialize();throw"document is not an instance of RxDocument"},t.resolveGlobals=function(e){var t="string"==typeof e?me(e):e;return this.document=t,global.document=this.document,this.document},t}(a.Platform),ke=function(){function e(e){this.url="",this.status=0,this.statusText="",this.ok=!1,this.redirected=!1,this.data=null,e&&(this.url=e.url,this.status=e.status,this.statusText=e.statusText,this.ok=e.ok,this.redirected=e.redirected)}return oe(e,[{key:"static",get:function(){return this.url.indexOf(".json")===this.url.length-5}}]),e}(),De=function(){function e(){}return e.http$=function(e,t,n,r){var o=this;void 0===r&&(r="json"),e=-1!==t.indexOf(".json")?"GET":e;var i=null;return this.pendingRequests$.next(this.pendingRequests$.getValue()+1),l.from(fetch(t,{method:e,headers:{Accept:"application/json","Content-Type":"application/json"},body:-1!==["POST","PUT","PATCH"].indexOf(e)?JSON.stringify(n):void 0}).then((function(e){return i=new ke(e),"function"==typeof e[r]?e[r]().then((function(t){return i.data=t,e.ok?Promise.resolve(i):Promise.reject(i)})):Promise.reject(i)}))).pipe(s.catchError((function(e){return console.log("error",e),l.throwError(o.getError(e,i))})),s.finalize((function(){o.pendingRequests$.next(o.pendingRequests$.getValue()-1)})))},e.get$=function(e,t,n){var r=this.query(t);return this.http$("GET",""+e+r,void 0,n)},e.delete$=function(e){return this.http$("DELETE",e)},e.post$=function(e,t){return this.http$("POST",e,t)},e.put$=function(e,t){return this.http$("PUT",e,t)},e.patch$=function(e,t){return this.http$("PATCH",e,t)},e.query=function(e){return""},e.getError=function(e,t){var n="object"==typeof e?e:{};return n.statusCode||(n.statusCode=t?t.status:0),n.statusMessage||(n.statusMessage=t?t.statusText:e),n},e}();De.pendingRequests$=new l.BehaviorSubject(0);var ze=function(e){function t(){return e.apply(this,arguments)||this}ie(t,e);var n=t.prototype;return n.onInit=function(){var e=this;this.items=[],De.get$("http://localhost:5000/data/todos.json").pipe(s.first()).subscribe((function(t){console.log("AppComponent.items",t),e.items=t.data,e.pushChanges()}))},n.onClick=function(e){e.completed=!e.completed,this.pushChanges()},t}(a.Component);ze.meta={selector:"[app-component]"};var Re=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t}(a.Module);Re.meta={imports:[a.CoreModule],declarations:[],bootstrap:ze},e.renderServer=function(e){var t=Ae.bootstrap(Re,e);return console.log(t),De.pendingRequests$.pipe(s.filter((function(e){return 0===e})),s.map((function(e){return Ae.serialize()})),s.first())},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=main.server.umd.min.js.map