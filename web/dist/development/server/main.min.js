/**
 * @license rxcomp-server v1.0.0-beta.18
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("stream"),require("http"),require("url"),require("https"),require("zlib"),require("rxcomp-http"),require("rxjs/operators"),require("rxcomp"),require("rxjs"),require("htmlparser2"),require("rxcomp-router")):"function"==typeof define&&define.amd?define(["exports","stream","http","url","https","zlib","rxcomp-http","rxjs/operators","rxcomp","rxjs","htmlparser2","rxcomp-router"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).main={},e.Stream,e.http,e.Url,e.https,e.zlib,e.rxcomp.http,e.rxjs.operators,e.rxcomp,e.rxjs,e.htmlparser2,e.rxcomp.router)}(this,(function(e,t,n,r,o,i,s,u,c,a,l,h){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var f="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};const d=t.Readable,p=Symbol("buffer"),m=Symbol("type");class y{constructor(){this[m]="";const e=arguments[0],t=arguments[1],n=[];let r=0;if(e){const t=e,o=Number(t.length);for(let e=0;e<o;e++){const o=t[e];let i;i=o instanceof Buffer?o:ArrayBuffer.isView(o)?Buffer.from(o.buffer,o.byteOffset,o.byteLength):o instanceof ArrayBuffer?Buffer.from(o):o instanceof y?o[p]:Buffer.from("string"==typeof o?o:String(o)),r+=i.length,n.push(i)}}this[p]=Buffer.concat(n);let o=t&&void 0!==t.type&&String(t.type).toLowerCase();o&&!/[^\u0020-\u007E]/.test(o)&&(this[m]=o)}get size(){return this[p].length}get type(){return this[m]}text(){return Promise.resolve(this[p].toString())}arrayBuffer(){const e=this[p],t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(t)}stream(){const e=new d;return e._read=function(){},e.push(this[p]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,t=arguments[0],n=arguments[1];let r,o;r=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),o=void 0===n?e:n<0?Math.max(e+n,0):Math.min(n,e);const i=Math.max(o-r,0),s=this[p].slice(r,r+i),u=new y([],{type:arguments[2]});return u[p]=s,u}}function g(e,t,n){Error.call(this,e),this.message=e,this.type=t,n&&(this.code=this.errno=n.code),Error.captureStackTrace(this,this.constructor)}let b;Object.defineProperties(y.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(y.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),g.prototype=Object.create(Error.prototype),g.prototype.constructor=g,g.prototype.name="FetchError";try{b=require("encoding").convert}catch(e){}const v=Symbol("Body internals"),w=t.PassThrough;function O(e){var n=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=r.size;let i=void 0===o?0:o;var s=r.timeout;let u=void 0===s?0:s;null==e?e=null:E(e)?e=Buffer.from(e.toString()):T(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof t||(e=Buffer.from(String(e)))),this[v]={body:e,disturbed:!1,error:null},this.size=i,this.timeout=u,e instanceof t&&e.on("error",(function(e){const t="AbortError"===e.name?e:new g(`Invalid response body while trying to fetch ${n.url}: ${e.message}`,"system",e);n[v].error=t}))}function N(){var e=this;if(this[v].disturbed)return O.Promise.reject(new TypeError("body used already for: "+this.url));if(this[v].disturbed=!0,this[v].error)return O.Promise.reject(this[v].error);let n=this.body;if(null===n)return O.Promise.resolve(Buffer.alloc(0));if(T(n)&&(n=n.stream()),Buffer.isBuffer(n))return O.Promise.resolve(n);if(!(n instanceof t))return O.Promise.resolve(Buffer.alloc(0));let r=[],o=0,i=!1;return new O.Promise((function(t,s){let u;e.timeout&&(u=setTimeout((function(){i=!0,s(new g(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))}),e.timeout)),n.on("error",(function(t){"AbortError"===t.name?(i=!0,s(t)):s(new g(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))})),n.on("data",(function(t){if(!i&&null!==t){if(e.size&&o+t.length>e.size)return i=!0,void s(new g(`content size at ${e.url} over limit: ${e.size}`,"max-size"));o+=t.length,r.push(t)}})),n.on("end",(function(){if(!i){clearTimeout(u);try{t(Buffer.concat(r,o))}catch(t){s(new g(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}}))}))}function E(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function T(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function _(e){let n,r,o=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof t&&"function"!=typeof o.getBoundary&&(n=new w,r=new w,o.pipe(n),o.pipe(r),e[v].body=n,o=r),o}function x(e){return null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":E(e)?"application/x-www-form-urlencoded;charset=UTF-8":T(e)?e.type||null:Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)?null:"function"==typeof e.getBoundary?"multipart/form-data;boundary="+e.getBoundary():e instanceof t?null:"text/plain;charset=UTF-8"}function S(e){const t=e.body;return null===t?0:T(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}O.prototype={get body(){return this[v].body},get bodyUsed(){return this[v].disturbed},arrayBuffer(){return N.call(this).then((function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}))},blob(){let e=this.headers&&this.headers.get("content-type")||"";return N.call(this).then((function(t){return Object.assign(new y([],{type:e.toLowerCase()}),{[p]:t})}))},json(){var e=this;return N.call(this).then((function(t){try{return JSON.parse(t.toString())}catch(t){return O.Promise.reject(new g(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}}))},text(){return N.call(this).then((function(e){return e.toString()}))},buffer(){return N.call(this)},textConverted(){var e=this;return N.call(this).then((function(t){return function(e,t){if("function"!=typeof b)throw new Error("The package `encoding` must be installed to use the textConverted() function");const n=t.get("content-type");let r,o,i="utf-8";n&&(r=/charset=([^;]*)/i.exec(n));o=e.slice(0,1024).toString(),!r&&o&&(r=/<meta.+?charset=(['"])(.+?)\1/i.exec(o));!r&&o&&(r=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o),r&&(r=/charset=(.*)/i.exec(r.pop())));!r&&o&&(r=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o));r&&(i=r.pop(),"gb2312"!==i&&"gbk"!==i||(i="gb18030"));return b(e,"UTF-8",i).toString()}(t,e.headers)}))}},Object.defineProperties(O.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),O.mixIn=function(e){for(const t of Object.getOwnPropertyNames(O.prototype))if(!(t in e)){const n=Object.getOwnPropertyDescriptor(O.prototype,t);Object.defineProperty(e,t,n)}},O.Promise=global.Promise;const C=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,k=/[^\t\x20-\x7e\x80-\xff]/;function j(e){if(e=""+e,C.test(e)||""===e)throw new TypeError(e+" is not a legal HTTP header name")}function P(e){if(e=""+e,k.test(e))throw new TypeError(e+" is not a legal HTTP header value")}function M(e,t){t=t.toLowerCase();for(const n in e)if(n.toLowerCase()===t)return n}const A=Symbol("map");class D{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[A]=Object.create(null),e instanceof D){const t=e.raw(),n=Object.keys(t);for(const e of n)for(const n of t[e])this.append(e,n)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const n=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");n.push(Array.from(t))}for(const e of n){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const n=e[t];this.append(t,n)}}}}get(e){j(e=""+e);const t=M(this[A],e);return void 0===t?null:this[A][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,n=F(this),r=0;for(;r<n.length;){var o=n[r];const i=o[0],s=o[1];e.call(t,s,i,this),n=F(this),r++}}set(e,t){t=""+t,j(e=""+e),P(t);const n=M(this[A],e);this[A][void 0!==n?n:e]=[t]}append(e,t){t=""+t,j(e=""+e),P(t);const n=M(this[A],e);void 0!==n?this[A][n].push(t):this[A][e]=[t]}has(e){return j(e=""+e),void 0!==M(this[A],e)}delete(e){j(e=""+e);const t=M(this[A],e);void 0!==t&&delete this[A][t]}raw(){return this[A]}keys(){return z(this,"key")}values(){return z(this,"value")}[Symbol.iterator](){return z(this,"key+value")}}function F(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const n=Object.keys(e[A]).sort();return n.map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[A][t].join(", ")}:function(t){return[t.toLowerCase(),e[A][t].join(", ")]})}D.prototype.entries=D.prototype[Symbol.iterator],Object.defineProperty(D.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(D.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const R=Symbol("internal");function z(e,t){const n=Object.create(L);return n[R]={target:e,kind:t,index:0},n}const L=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==L)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[R];const t=e.target,n=e.kind,r=e.index,o=F(t,n);return r>=o.length?{value:void 0,done:!0}:(this[R].index=r+1,{value:o[r],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function $(e){const t=Object.assign({__proto__:null},e[A]),n=M(e[A],"Host");return void 0!==n&&(t[n]=t[n][0]),t}Object.defineProperty(L,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const I=Symbol("Response internals"),B=n.STATUS_CODES;class U{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};O.call(this,e,t);const n=t.status||200,r=new D(t.headers);if(null!=e&&!r.has("Content-Type")){const t=x(e);t&&r.append("Content-Type",t)}this[I]={url:t.url,status:n,statusText:t.statusText||B[n],headers:r,counter:t.counter}}get url(){return this[I].url||""}get status(){return this[I].status}get ok(){return this[I].status>=200&&this[I].status<300}get redirected(){return this[I].counter>0}get statusText(){return this[I].statusText}get headers(){return this[I].headers}clone(){return new U(_(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}O.mixIn(U.prototype),Object.defineProperties(U.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty(U.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const q=Symbol("Request internals"),H=r.parse,V=r.format,G="destroy"in t.Readable.prototype;function Y(e){return"object"==typeof e&&"object"==typeof e[q]}class J{constructor(e){let t,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};Y(e)?t=H(e.url):(t=e&&e.href?H(e.href):H(""+e),e={});let r=n.method||e.method||"GET";if(r=r.toUpperCase(),(null!=n.body||Y(e)&&null!==e.body)&&("GET"===r||"HEAD"===r))throw new TypeError("Request with GET/HEAD method cannot have body");let o=null!=n.body?n.body:Y(e)&&null!==e.body?_(e):null;O.call(this,o,{timeout:n.timeout||e.timeout||0,size:n.size||e.size||0});const i=new D(n.headers||e.headers||{});if(null!=o&&!i.has("Content-Type")){const e=x(o);e&&i.append("Content-Type",e)}let s=Y(e)?e.signal:null;if("signal"in n&&(s=n.signal),null!=s&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(s))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[q]={method:r,redirect:n.redirect||e.redirect||"follow",headers:i,parsedURL:t,signal:s},this.follow=void 0!==n.follow?n.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==n.compress?n.compress:void 0===e.compress||e.compress,this.counter=n.counter||e.counter||0,this.agent=n.agent||e.agent}get method(){return this[q].method}get url(){return V(this[q].parsedURL)}get headers(){return this[q].headers}get redirect(){return this[q].redirect}get signal(){return this[q].signal}clone(){return new J(this)}}function K(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}O.mixIn(J.prototype),Object.defineProperty(J.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(J.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),K.prototype=Object.create(Error.prototype),K.prototype.constructor=K,K.prototype.name="AbortError";const X=t.PassThrough,W=r.resolve;function Z(e,r){if(!Z.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return O.Promise=Z.Promise,new Z.Promise((function(s,u){const c=new J(e,r),a=function(e){const n=e[q].parsedURL,r=new D(e[q].headers);if(r.has("Accept")||r.set("Accept","*/*"),!n.protocol||!n.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(n.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof t.Readable&&!G)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let o=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(o="0"),null!=e.body){const t=S(e);"number"==typeof t&&(o=String(t))}o&&r.set("Content-Length",o),r.has("User-Agent")||r.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!r.has("Accept-Encoding")&&r.set("Accept-Encoding","gzip,deflate");let i=e.agent;return"function"==typeof i&&(i=i(n)),r.has("Connection")||i||r.set("Connection","close"),Object.assign({},n,{method:e.method,headers:$(r),agent:i})}(c),l=("https:"===a.protocol?o:n).request,h=c.signal;let f=null;const d=function(){let e=new K("The user aborted a request.");u(e),c.body&&c.body instanceof t.Readable&&c.body.destroy(e),f&&f.body&&f.body.emit("error",e)};if(h&&h.aborted)return void d();const p=function(){d(),b()},m=l(a);let y;function b(){m.abort(),h&&h.removeEventListener("abort",p),clearTimeout(y)}h&&h.addEventListener("abort",p),c.timeout&&m.once("socket",(function(e){y=setTimeout((function(){u(new g("network timeout at: "+c.url,"request-timeout")),b()}),c.timeout)})),m.on("error",(function(e){u(new g(`request to ${c.url} failed, reason: ${e.message}`,"system",e)),b()})),m.on("response",(function(e){clearTimeout(y);const t=function(e){const t=new D;for(const n of Object.keys(e))if(!C.test(n))if(Array.isArray(e[n]))for(const r of e[n])k.test(r)||(void 0===t[A][n]?t[A][n]=[r]:t[A][n].push(r));else k.test(e[n])||(t[A][n]=[e[n]]);return t}(e.headers);if(Z.isRedirect(e.statusCode)){const n=t.get("Location"),r=null===n?null:W(c.url,n);switch(c.redirect){case"error":return u(new g("redirect mode is set to error: "+c.url,"no-redirect")),void b();case"manual":if(null!==r)try{t.set("Location",r)}catch(e){u(e)}break;case"follow":if(null===r)break;if(c.counter>=c.follow)return u(new g("maximum redirect reached at: "+c.url,"max-redirect")),void b();const n={headers:new D(c.headers),follow:c.follow,counter:c.counter+1,agent:c.agent,compress:c.compress,method:c.method,body:c.body,signal:c.signal,timeout:c.timeout};return 303!==e.statusCode&&c.body&&null===S(c)?(u(new g("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void b()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==c.method)||(n.method="GET",n.body=void 0,n.headers.delete("content-length")),s(Z(new J(r,n))),void b())}}e.once("end",(function(){h&&h.removeEventListener("abort",p)}));let n=e.pipe(new X);const r={url:c.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:c.size,timeout:c.timeout,counter:c.counter},o=t.get("Content-Encoding");if(!c.compress||"HEAD"===c.method||null===o||204===e.statusCode||304===e.statusCode)return f=new U(n,r),void s(f);const a={flush:i.Z_SYNC_FLUSH,finishFlush:i.Z_SYNC_FLUSH};if("gzip"==o||"x-gzip"==o)return n=n.pipe(i.createGunzip(a)),f=new U(n,r),void s(f);if("deflate"!=o&&"x-deflate"!=o){if("br"==o&&"function"==typeof i.createBrotliDecompress)return n=n.pipe(i.createBrotliDecompress()),f=new U(n,r),void s(f);f=new U(n,r),s(f)}else{e.pipe(new X).once("data",(function(e){n=8==(15&e[0])?n.pipe(i.createInflate()):n.pipe(i.createInflateRaw()),f=new U(n,r),s(f)}))}})),function(e,t){const n=t.body;null===n?e.end():T(n)?n.stream().pipe(e):Buffer.isBuffer(n)?(e.write(n),e.end()):n.pipe(e)}(m,c)}))}Z.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},Z.Promise=global.Promise;var Q,ee=(Q=Object.freeze({__proto__:null,default:Z,Headers:D,Request:J,Response:U,FetchError:g}))&&Q.default||Q,te=function(e,t,n){return e(n={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&n.path)}},n.exports),n.exports}((function(e,t){var n=ee.default||ee,r=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),n.call(this,e,t)};e.exports=t=r,t.fetch=r,t.Headers=ee.Headers,t.Request=ee.Request,t.Response=ee.Response,t.default=r})),ne=te.fetch.bind({});function re(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function oe(e,t,n){return t&&re(e.prototype,t),n&&re(e,n),e}function ie(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function se(e){return(se=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ue(e,t){return(ue=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function ce(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function ae(e,t,n){return(ae=ce()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var o=new(Function.bind.apply(e,r));return n&&ue(o,n.prototype),o}).apply(null,arguments)}function le(e){var t="function"==typeof Map?new Map:void 0;return(le=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return ae(e,arguments,se(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),ue(r,e)})(e)}function he(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function fe(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function de(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return fe(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?fe(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}ne.polyfill=!0,f.fetch||(f.fetch=ne,f.Response=te.Response,f.Headers=te.Headers,f.Request=te.Request);var pe,me,ye=require("path"),ge=require("fs"),be=function(){function e(){}return e.exists=function(e){return ge.existsSync(e)},e.exists$=function(e){return a.Observable.create((function(t){try{ge.access(e,ge.constants.F_OK,(function(e){var n=!e;t.next(n),t.complete()}))}catch(e){console.log("FileService.exists$.error",e),t.next(!1),t.complete()}}))},e.readFile=function(e){var t=ye.dirname(e);return ge.existsSync(t)?ge.readFileSync(e,"utf8"):null},e.readFile$=function(e){return a.Observable.create((function(t){try{ge.readFile(e,"utf8",(function(e,n){t.next(e?null:n),t.complete()}))}catch(e){console.log("FileService.readFile$.error",e),t.next(null),t.complete()}}))},e.writeFile=function(e,t){try{var n=ye.dirname(e);return ge.existsSync(n)||ge.mkdirSync(n),ge.writeFileSync(e,t,"utf8"),!0}catch(e){return console.log("FileService.writeFile.error",e),!1}},e.writeFile$=function(e,t){return a.Observable.create((function(n){try{var r=ye.dirname(e);ge.mkdir(r,{recursive:!0},(function(r){if(r)return n.next(!1),void n.complete();ge.writeFile(e,t,"utf8",(function(e){n.next(!e),n.complete()}))}))}catch(e){console.log("FileService.writeFile$.error",e),n.next(!1),n.complete()}}))},e.unlinkFile=function(e){try{return!!ge.existsSync(e)&&(ge.unlinkSync(e),!0)}catch(e){return console.log("FileService.unlinkFile.error",e),!1}},e.unlinkFile$=function(e){return a.Observable.create((function(t){try{ge.unlink(e,(function(e){t.next(!e),t.complete()}))}catch(e){console.log("FileService.unlinkFile$.error",e),t.next(!1)}}))},e}();!function(e){e.Memory="memory",e.File="file"}(pe||(pe={})),function(e){e.Public="public",e.Private="private",e.NoCache="no-cache",e.NoStore="no-store"}(me||(me={}));var ve=function(){function e(e){this.date=new Date,this.maxAge=0,this.cacheControl=me.Public,e&&(this.value=e.value,this.date=e.date?new Date(e.date):this.date,this.maxAge=e.maxAge||this.maxAge,this.cacheControl=e.cacheControl||this.cacheControl)}return e.toData=function(e){return c.Serializer.encode(e,[c.encodeJson])},e.fromData=function(t){return new e(c.Serializer.decode(t,[c.decodeJson]))},oe(e,[{key:"expired",get:function(){return this.cacheControl===me.NoStore||0===this.maxAge||this.date.getTime()+1e3*this.maxAge<Date.now()}}]),e}(),we=function(){function e(){}return e.has=function(e,t){void 0===e&&(e="cache");var n=!1;try{var r=this.getPath(e,t);switch(this.mode){case pe.File:n=be.exists(r);break;case pe.Memory:default:n=-1!==Object.keys(this.cache_).indexOf(r)}}catch(e){console.log("CacheService.has.error",e)}return n},e.get=function(e,t){void 0===e&&(e="cache");var n,r=null;try{var o=this.getPath(e,t);switch(this.mode){case pe.File:if(be.exists(o)){var i,s=be.readFile(o);if(s)if((n=ve.fromData(s)).expired)be.unlinkFile(o);else r=null==(i=n)?void 0:i.value}break;case pe.Memory:default:if(-1!==Object.keys(this.cache_).indexOf(o)){var u=this.cache_[o];u&&(n=ve.fromData(u))&&(n.expired?delete this.cache_[o]:r=n.value)}}}catch(e){console.log("CacheService.get.error",e)}return r},e.set=function(e,t,n,r,o){void 0===e&&(e="cache"),void 0===r&&(r=0),void 0===o&&(o=me.Public);try{var i,s=this.getPath(e,t),u=new ve({value:n,maxAge:r,cacheControl:o});switch(this.mode){case pe.File:(i=ve.toData(u))&&be.writeFile(s,i);break;case pe.Memory:default:(i=ve.toData(u))&&(this.cache_[s]=i)}}catch(e){console.log("CacheService.set.error",e)}return n},e.delete=function(e,t){void 0===e&&(e="cache");try{var n=this.getPath(e,t);switch(this.mode){case pe.File:be.unlinkFile(n);break;case pe.Memory:default:-1!==Object.keys(this.cache_).indexOf(n)&&delete this.cache_[n]}}catch(e){console.log("CacheService.delete.error",e)}},e.has$=function(e,t){var n=this;return void 0===e&&(e="cache"),a.Observable.create((function(r){var o=n.getPath(e,t);r.next(o),r.complete()})).pipe(u.switchMap((function(e){return n.mode===pe.File?be.exists$(e):a.of(-1!==Object.keys(n.cache_).indexOf(e))})))},e.get$=function(e,t){var n,r=this;return void 0===e&&(e="cache"),a.Observable.create((function(o){n=r.getPath(e,t),o.next(n),o.complete()})).pipe(u.switchMap((function(e){return r.mode===pe.File?be.readFile$(e):a.of(r.cache_[e])})),u.switchMap((function(e){var t=e?ve.fromData(e):null;return t&&t.expired?be.unlinkFile$(n).pipe(u.map((function(){return null}))):a.of(t?t.value:null)})))},e.set$=function(e,t,n,r,o){var i,s,c,l=this;return void 0===e&&(e="cache"),void 0===r&&(r=0),void 0===o&&(o=me.Public),a.Observable.create((function(u){i=l.getPath(e,t),s=new ve({value:n,maxAge:r,cacheControl:o}),c=ve.toData(s),u.next(c),u.complete()})).pipe(u.switchMap((function(e){return e?l.mode===pe.File?be.writeFile$(i,e):(l.cache_[i]=e,a.of(!0)):a.of(!1)})))},e.delete$=function(e,t){var n,r=this;return void 0===e&&(e="cache"),a.Observable.create((function(o){n=r.getPath(e,t),o.next(n),o.complete()})).pipe(u.switchMap((function(e){return r.mode===pe.File?be.unlinkFile$(e):-1!==Object.keys(r.cache_).indexOf(e)?(delete r.cache_[e],a.of(!0)):a.of(!1)})))},e.getPath=function(e,t){void 0===e&&(e="cache");var n=this.getKey(e,t);return""+this.folder+n},e.getKey=function(e,t){void 0===e&&(e="cache");var n=(e+"-"+t).toLowerCase();return n=n.replace(/(\s+)|(\W+)/g,(function(){return(arguments.length<=1?void 0:arguments[1])?"":"_"}))},e}();we.cache_={},we.mode=pe.Memory;var Oe,Ne,Ee=function(e){function t(){return e.apply(this,arguments)||this}ie(t,e);var n=t.prototype;return n.contains=function(e){return-1!==this.indexOf(e)},n.item=function(e){return e>0&&e<this.length?this[e]:null},t}(le(Array)),Te=function(){function e(){this.hash_="",this.host_="",this.hostname_="",this.pathname_="",this.port_="",this.protocol_="",this.search_="",this.href_="",this.ancestorOrigins_=new Ee}var t=e.prototype;return t.assign=function(e){this.href=e},t.reload=function(){},t.replace=function(e){this.href=e},t.toString=function(){return this.href},oe(e,[{key:"hash",get:function(){return this.hash_},set:function(e){this.hash_=e,this.href=this.href}},{key:"host",get:function(){return this.host_},set:function(e){this.host_=e,this.href=this.href}},{key:"hostname",get:function(){return this.hostname_},set:function(e){this.hostname_=e,this.href=this.href}},{key:"pathname",get:function(){return this.pathname_},set:function(e){this.pathname_=e,this.href=this.href}},{key:"port",get:function(){return this.port_},set:function(e){this.port_=e,this.href=this.href}},{key:"protocol",get:function(){return this.protocol_},set:function(e){this.protocol_=e,this.href=this.href}},{key:"search",get:function(){return this.search_},set:function(e){this.search_=e,this.href=this.href}},{key:"href",get:function(){var e=this.protocol+"//"+this.host+(this.port.length?":"+this.port:"")+this.pathname+this.search+this.hash;return this.href_=e,e},set:function(e){if(this.href_!==e){this.href_=e;var t=c.getLocationComponents(e);this.protocol_=t.protocol,this.host_=t.host,this.hostname_=t.hostname,this.port_=t.port,this.pathname_=t.pathname,this.search_=t.search,this.hash_=t.hash}}},{key:"origin",get:function(){return this.protocol+"//"+this.host+(this.port.length?":"+this.port:"")}},{key:"ancestorOrigins",get:function(){return this.ancestorOrigins_}}],[{key:"location",get:function(){return this.location_?this.location_:this.location_=new e}}]),e}(),_e=function(){function e(){this.currentIndex_=0,this.history_=[],this.scrollRestoration="auto"}var t=e.prototype;return t.back=function(){if(this.currentIndex_>0){this.currentIndex_--;var e=this.history_[this.currentIndex_];e.url&&(Te.location.href=e.url)}},t.forward=function(){if(this.currentIndex_<this.history_.length-1){this.currentIndex_++;var e=this.history_[this.currentIndex_];e.url&&(Te.location.href=e.url)}},t.go=function(e){if("number"==typeof e){var t=this.currentIndex_+e;if(t>0&&t<this.history_.length){var n=this.history_[t];n.url&&(Te.location.href=n.url)}}},t.pushState=function(e,t,n){this.history_.push({data:e,title:t,url:n}),this.currentIndex_=this.history_.length-1},t.replaceState=function(e,t,n){this.history_.length?this.history_.splice(this.history_.length-1,1,{data:e,title:t,url:n}):this.history_.push({data:e,title:t,url:n}),this.currentIndex_=this.history_.length-1},oe(e,[{key:"length",get:function(){return this.history_.length}}],[{key:"history",get:function(){return this.history_?this.history_:this.history_=new e}}]),e}();!function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",e[e.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE",e[e.DOCUMENT_NODE=9]="DOCUMENT_NODE",e[e.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",e[e.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE"}(Oe||(Oe={})),function(e){e[e.None=-1]="None",e[e.Id=0]="Id",e[e.Class=1]="Class",e[e.Attribute=2]="Attribute",e[e.TagName=3]="TagName"}(Ne||(Ne={}));var xe=function(){function e(e){void 0===e&&(e=null),this.nodeValue=null,this.parentNode=e,this.nodeType=-1}var t=e.prototype;return t.cloneNode=function(e){return void 0===e&&(e=!1),Ve.apply(this,[this,e])},t.serialize=function(){return""},e}(),Se=function(){function e(e){Object.defineProperty(this,"node",{value:e,writable:!1,enumerable:!1}),this.init()}var t=e.prototype;return t.init=function(){var e,t=this;if(Object.keys(this).forEach((function(e){return delete t[e]})),null==(e=this.node.attributes)?void 0:e.style){[].concat(this.node.attributes.style.matchAll(/([^:]+):([^;]+);?\s*/gm)).forEach((function(e){var n=e[1],r=e[2];t[n]=r}))}},t.item=function(e){var t=Object.keys(this);return t.length>e?t[e]:void 0},t.getPropertyPriority=function(e){var t=this[e];return t&&t.indexOf("!important")?"important":""},t.getPropertyValue=function(e){return this[e]},t.setProperty=function(e,t,n){this[e]=t+("important"===n?"!important":""),this.serialize_()},t.removeProperty=function(e){delete this[e],this.serialize_()},t.serialize_=function(){var e=this;this.node.attributes.style=Object.keys(this).map((function(t){return t+": "+e[t]+";"})).join(" ")},e}(),Ce=function(e){function t(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.call.apply(e,[this].concat(n))||this}ie(t,e);var n=t.prototype;return n.init=function(){this.length=0,this.node.hasAttribute("class")&&Array.prototype.push.apply(this,this.node.getAttribute("class").split(" ").map((function(e){return e.trim()})))},n.slice=function(e,n){var r=this.length;e=(e=e||0)>=0?e:Math.max(0,r+e);var o,i=(n=(n=void 0!==n?n:r)>=0?Math.min(n,r):r+n)-e,s=i>0?new t(i):new t;for(o=0;o<i;o++)s[o]=this[e+o];return s.node=this.node,s},n.item=function(e){return this[e]},n.contains=function(e){return-1!==this.indexOf(e)},n.add=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){-1===e.indexOf(t)&&e.push(t)})),this.serialize_()},n.remove=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)})),this.serialize_()},n.toggle=function(e,t){var n=this.indexOf(e);return!1===t?(this.splice(n,1),this.serialize_(),!1):!0===t?(this.push(e),this.serialize_(),!0):-1!==n?(this.splice(n,1),this.serialize_(),!1):(this.push(e),this.serialize_(),!0)},n.replace=function(e,t){var n=this.indexOf(e);-1!==n&&this.splice(n,1),this.push(t),this.serialize_()},n.serialize_=function(){this.node.setAttribute("class",this.join(" "))},oe(t,[{key:"node",get:function(){return this.node_},set:function(e){this.node_!==e&&(this.node_=e,this.init())}}]),t}(le(Array)),ke=function(e){function t(t,n,r){var o;void 0===t&&(t=null),void 0===r&&(r=null),(o=e.call(this,t)||this).attributes={},o.nodeType=Oe.ELEMENT_NODE,o.nodeName=n,r&&"object"==typeof r&&(o.attributes=r),o.style=new Se(he(o));var i=new Ce;return i.node=he(o),o.classList=i,o.childNodes=[],o}ie(t,e);var n=t.prototype;return n.append=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n=n.map((function(t){var n;return"string"==typeof t?n=new je(e,t):(n=t).parentNode=e,n})),Array.prototype.push.apply(this.childNodes,n)},n.appendChild=function(e){return e.parentNode&&e.parentNode.removeChild(e),$e(e)?this.append.apply(this,e.childNodes):this.append(e),e},n.prepend=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n=n.map((function(t){var n;return"string"==typeof t?n=new je(e,t):(n=t).parentNode=e,n})),Array.prototype.unshift.apply(this.childNodes,n)},n.replaceChildren=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n.map((function(t){var n;return"string"==typeof t?n=new je(e,t):(n=t).parentNode=e,n}));this.childNodes=o},n.querySelectorAll=function(e){var t=qe(Be(e),this.childNodes);return t&&t.length?t:null},n.querySelector=function(e){return He(Be(e),this.childNodes)},n.hasAttribute=function(e){return-1!==Object.keys(this.attributes).indexOf(e.toLowerCase())},n.getAttribute=function(e){return this.attributes[e.toLowerCase()]||null},n.setAttribute=function(e,t){this.attributes[e.toLowerCase()]=t.toString(),"style"===e?this.style.init():"class"===e&&this.classList.init()},n.removeAttribute=function(e){delete this.attributes[e],"style"===e?this.style.init():"class"===e&&this.classList.init()},n.replaceChild=function(e,t){var n=this.childNodes.indexOf(t);return-1!==n&&(this.childNodes[n]=e,e.parentNode=this),t},n.removeChild=function(e){if(!(e instanceof xe))throw new Error("Uncaught TypeError: Failed to execute 'removeChild' on 'Node': parameter 1 is not of type 'Node'.");var t=this.childNodes.indexOf(e);if(-1===t)throw new Error("Uncaught NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.");return this.childNodes.splice(t,1),e},n.insertBefore=function(e,t){void 0===t&&(t=null);var n=t?this.childNodes.indexOf(t):this.childNodes.length;return-1!==n&&(this.childNodes.splice(n,0,e),e.parentNode=this),e},n.cloneNode=function(e){return void 0===e&&(e=!1),Ve.apply(this,[this,e])},n.addListener=function(e,t){},n.removeListener=function(e,t){},n.serialize=function(){return"<"+this.nodeName+this.serializeAttributes()+">"+this.childNodes.map((function(e){return e.serialize()})).join("")+"</"+this.nodeName+">"},n.serializeAttributes=function(){var e=this,t="",n=Object.keys(this.attributes);return n.length&&(t=" "+n.map((function(t){return t+'="'+e.attributes[t]+'"'})).join(" ")),t},oe(t,[{key:"children",get:function(){var e,t=[],n=0,r=this.childNodes;for(e=r[n++];e;)e.nodeType===Oe.ELEMENT_NODE&&t.push(e),e=r[n++];return t}},{key:"childElementCount",get:function(){var e,t=0,n=0,r=this.childNodes;for(e=r[t++];e;)e.nodeType===Oe.ELEMENT_NODE&&n++,e=r[t++];return n}},{key:"firstChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[0]),e}},{key:"firstElementChild",get:function(){for(var e,t=de(this.childNodes);!(e=t()).done;){var n=e.value;if(ze(n))return n}return null}},{key:"lastChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[this.childNodes.length-1]),e}},{key:"lastElementChild",get:function(){for(var e=this.childNodes,t=e.length-1;t>-1;t--){var n=e[t];if(ze(n))return n}return null}},{key:"previousSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);t>0&&(e=this.parentNode.childNodes[t-1])}return e}},{key:"nextSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);-1!==t&&t<this.parentNode.childNodes.length-1&&(e=this.parentNode.childNodes[t])}return e}},{key:"wholeText",get:function(){if(this.nodeType===Oe.TEXT_NODE)return this.nodeValue}},{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"innerText",set:function(e){this.childNodes=[new je(this,e)]},get:function(){return this.childNodes.filter((function(e){return Le(e)||ze(e)})).map((function(e){return e.innerText})).join("")}},{key:"textContent",set:function(e){this.innerText=String(e)},get:function(){return this.innerText}},{key:"innerHTML",get:function(){return this.childNodes.map((function(e){return e.serialize()})).join("")},set:function(e){var t=this,n=Ie(e).childNodes.map((function(e){return e.parentNode=t,e}));this.childNodes=n}}]),t}(xe),je=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=Oe.TEXT_NODE,r.nodeValue=String(n),r}return ie(t,e),t.prototype.serialize=function(){return this.nodeValue},oe(t,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),t}(xe),Pe=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=Oe.COMMENT_NODE,r.nodeValue=String(n),r}return ie(t,e),t.prototype.serialize=function(){return"\x3c!--"+this.nodeValue+"--\x3e"},oe(t,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),t}(xe),Me=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=Oe.PROCESSING_INSTRUCTION_NODE,r.nodeValue=String(n),r}return ie(t,e),t.prototype.serialize=function(){return"<"+this.nodeValue+">"},t}(xe),Ae=function(e){function t(t,n){var r;return void 0===t&&(t=null),(r=e.call(this,t)||this).nodeType=Oe.DOCUMENT_TYPE_NODE,r.nodeValue=String(n),r}return ie(t,e),t.prototype.serialize=function(){return"<"+this.nodeValue+">"},t}(xe),De=function(e){function t(){var t;return(t=e.call(this,null,"#document-fragment")||this).nodeType=Oe.DOCUMENT_FRAGMENT_NODE,t.childNodes=[],t}return ie(t,e),t}(ke),Fe=function(e){function t(){var t;return(t=e.call(this,null,"#document")||this).location_=Te.location,t.nodeType=Oe.DOCUMENT_NODE,t.childNodes=[],t}ie(t,e);var n=t.prototype;return n.createAttribute=function(){},n.createAttributeNS=function(){},n.createCDATASection=function(){},n.createComment=function(e){return new Pe(null,e)},n.createDocumentFragment=function(){return new De},n.createElement=function(e){return new ke(null,e)},n.createElementNS=function(e){return new ke(null,e)},n.createEvent=function(){},n.createNodeIterator=function(){},n.createProcessingInstruction=function(e){return new Me(null,e)},n.createRange=function(){},n.createTextNode=function(e){return new je(null,e)},n.createTouchList=function(){},n.createTreeWalker=function(){},n.serialize=function(){return""+this.childNodes.map((function(e){return e.serialize()})).join("")},oe(t,[{key:"location",get:function(){return this.location_}},{key:"URL",get:function(){return this.location_.href}},{key:"hidden",get:function(){return!0}},{key:"visibilityState",get:function(){return"prerender"}},{key:"doctype",get:function(){return this.childNodes.find((function(e){return function(e){return e.nodeType===Oe.DOCUMENT_TYPE_NODE}(e)}))}},{key:"head",get:function(){var e=this.documentElement.childNodes.find((function(e){return ze(e)&&"head"===e.nodeName}));return e||(e=new ke(this.documentElement,"head"),this.documentElement.append(e)),e}},{key:"body",get:function(){var e=this.childNodes.find((function(e){return ze(e)&&"body"===e.nodeName}));return e||(e=new ke(this.documentElement,"body"),this.documentElement.append(e)),e}},{key:"title",get:function(){var e=this.head.childNodes.find((function(e){return ze(e)&&"title"===e.nodeName}));return e?e.innerText:null},set:function(e){var t=this.head.childNodes.find((function(e){return ze(e)&&"title"===e.nodeName}));t||(t=new ke(this.head,"title")),t.innerText=String(e)}},{key:"documentElement",get:function(){var e=this.firstElementChild;return e||(e=new ke(this,"html")),e}}]),t}(ke),Re=function(){function e(e){e&&Object.assign(this,e)}var t=e.prototype;return t.alert=function(e){},t.blur=function(){},t.close=function(){},t.confirm=function(e){return!1},t.departFocus=function(e,t){},t.focus=function(){},t.getComputedStyle=function(e,t){},t.getMatchedCSSRules=function(e,t){},t.getSelection=function(){return null},t.matchMedia=function(e){},t.moveBy=function(e,t){},t.moveTo=function(e,t){},t.msWriteProfilerMark=function(e){},t.open=function(e,t,n,r){return null},t.postMessage=function(e,t,n){},t.print=function(){},t.prompt=function(e,t){return null},t.resizeBy=function(e,t){},t.resizeTo=function(e,t){},t.scroll=function(){},t.scrollBy=function(){},t.scrollTo=function(){},t.stop=function(){},t.webkitCancelAnimationFrame=function(e){},t.webkitConvertPointFromNodeToPage=function(e,t){},t.webkitConvertPointFromPageToNode=function(e,t){},t.webkitRequestAnimationFrame=function(e){return 0},t.addEventListener=function(e,t,n){},t.removeEventListener=function(e,t,n){},t.oncompassneedscalibration=function(e){return null},t.ondevicelight=function(e){return null},t.ondevicemotion=function(e){},t.ondeviceorientation=function(e){},t.ondeviceorientationabsolute=function(e){},t.onmousewheel=function(e){},t.onmsgesturechange=function(e){},t.onmsgesturedoubletap=function(e){},t.onmsgestureend=function(e){},t.onmsgesturehold=function(e){},t.onmsgesturestart=function(e){},t.onmsgesturetap=function(e){},t.onmsinertiastart=function(e){},t.onmspointercancel=function(e){},t.onmspointerdown=function(e){},t.onmspointerenter=function(e){},t.onmspointerleave=function(e){},t.onmspointermove=function(e){},t.onmspointerout=function(e){},t.onmspointerover=function(e){},t.onmspointerup=function(e){},t.onreadystatechange=function(e){},t.onvrdisplayactivate=function(e){},t.onvrdisplayblur=function(e){},t.onvrdisplayconnect=function(e){},t.onvrdisplaydeactivate=function(e){},t.onvrdisplaydisconnect=function(e){},t.onvrdisplayfocus=function(e){},t.onvrdisplaypointerrestricted=function(e){},t.onvrdisplaypointerunrestricted=function(e){},t.onvrdisplaypresentchange=function(e){},e}();function ze(e){return e.nodeType===Oe.ELEMENT_NODE}function Le(e){return e.nodeType===Oe.TEXT_NODE}function $e(e){return e.nodeType===Oe.DOCUMENT_FRAGMENT_NODE}function Ie(e){var t,n=new Fe,r=n,o=new l.Parser({onopentag:function(e,n){t=new ke(r,e,n),r.childNodes.push(t),r=t},onclosetag:function(e){r.parentNode&&(r=r.parentNode)},ontext:function(e){var t=new je(r,e);r.childNodes.push(t)},onprocessinginstruction:function(e,n){t="!doctype"===e?new Ae(r,n):new Me(r,n),r.childNodes.push(t)},oncomment:function(e){t=new Pe(r,e),r.childNodes.push(t)},oncommentend:function(){}},{decodeEntities:!1,lowerCaseTags:!0});return o.write(e),o.end(),n}function Be(e){var t=[];return e.trim().split(" ").forEach((function(e){e.trim().split(">").forEach((function(e,n){for(var r,o=[],i=de(e.matchAll(/\:not\(\#([^\.[#:]+)\)|\:not\(\.([^\.[#:]+)\)|\:not\(\[([^\.\[#:]+)\]\)|\:not\(([^\.\[#:\]]+)\)|\#([^\.[#:]+)|\.([^\.[#:]+)|\[([^\.\[#:]+)\]|([^\.\[#:\]]+)/g));!(r=i()).done;){var s=r.value;s[1]?o.push({selector:s[1],type:Ne.Id,negate:!0}):s[2]?o.push({selector:s[2],type:Ne.Class,negate:!0}):s[3]?o.push({selector:s[3],type:Ne.Attribute,negate:!0}):s[4]?o.push({selector:s[4],type:Ne.TagName,negate:!0}):s[5]?o.push({selector:s[5],type:Ne.Id,negate:!1}):s[6]?o.push({selector:s[6],type:Ne.Class,negate:!1}):s[7]?o.push({selector:s[7],type:Ne.Attribute,negate:!1}):s[8]&&o.push({selector:s[8],type:Ne.TagName,negate:!1})}var u=n>0?{selector:e,selectors:o,inner:!0}:{selector:e,selectors:o,inner:!1};t.push.call(t,u)}))})),t}function Ue(e,t){return t.reduce((function(t,n){return t&&function(e,t){switch(t.type){case Ne.Id:return(""!==t.selector&&e.attributes.id===t.selector)!==t.negate;case Ne.Class:return-1!==e.classList.indexOf(t.selector)!==t.negate;case Ne.Attribute:return-1!==Object.keys(e.attributes).indexOf(t.selector)!==t.negate;case Ne.TagName:return e.nodeName===t.selector!==t.negate;default:return!1}}(e,n)}),!0)}function qe(e,t,n,r){if(void 0===n&&(n=null),void 0===r&&(r=[]),n||e.length){n=n||e.shift();for(var o,i=de(t);!(o=i()).done;){var s=o.value;if(s instanceof ke)if(Ue(s,n.selectors))if(e.length){var u=qe(e,s.childNodes);u&&Array.prototype.push.apply(r,u)}else r.push(s);else if(!n.inner){var c=qe(e,s.childNodes,n);c&&Array.prototype.push.apply(r,c)}}}return r.length?r:null}function He(e,t,n){void 0===n&&(n=null);var r=null;if(n||e.length){n=n||e.shift();for(var o,i=de(t);!(o=i()).done;){var s=o.value;if(s instanceof ke){if(Ue(s,n.selectors))return e.length?He(e,s.childNodes):s;n.inner||(r=He(e,s.childNodes,n))}}}return r}function Ve(e,t,n){var r;if(void 0===t&&(t=!1),void 0===n&&(n=null),ze(e)){var o=new ke(n,e.nodeName,Object.assign({},e.attributes));t&&(o.childNodes=e.childNodes.map((function(e){return Ve.apply(e,[e,t,o])}))),r=o}else if($e(e)){var i=new De;t&&(i.childNodes=e.childNodes.map((function(e){return Ve.apply(e,[e,t,i])}))),r=i}else if(Le(e))r=new je(n,e.nodeValue);else if(e.nodeType===Oe.COMMENT_NODE)r=new Pe(n,e.nodeValue);else{if(!function(e){return e.nodeType===Oe.DOCUMENT_NODE}(e))throw new Error("Invalid node type");var s=new Fe;t&&(s.childNodes=e.childNodes.map((function(e){return Ve.apply(e,[e,t,s])}))),r=s}return r}var Ge=function(e){e&&Object.assign(this,e),this.vars=Object.assign({host:"http://localhost:5000",port:5e3,charset:"utf8",template:"./index.html",cacheMode:pe.Memory,cache:"./cache/",root:"./dist/browser/"},this.vars||{})},Ye=function(e){this.maxAge=3600,this.cacheControl=me.Public,e&&Object.assign(this,e)},Je=function(e){e&&Object.assign(this,e)},Ke=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t.bootstrap=function(e,t){if(!c.isPlatformServer)throw new c.ModuleError("missing platform server, node process not found");if(!e)throw new c.ModuleError("missing moduleFactory");if(!e.meta)throw new c.ModuleError("missing moduleFactory meta");if(!e.meta.bootstrap)throw new c.ModuleError("missing bootstrap");if(!e.meta.bootstrap.meta)throw new c.ModuleError("missing bootstrap meta");if(!e.meta.bootstrap.meta.selector)throw new c.ModuleError("missing bootstrap meta selector");if(!(null==t?void 0:t.template))throw new c.ModuleError("missing template");var n=this.resolveGlobals(t),r=this.resolveMeta(e);if(r.node instanceof ke){var o,i=r.node,s=r.nodeInnerHTML,u={selector:e.meta.bootstrap.meta.selector,innerHTML:s},a=new ke(null,"script"),l=new je(null,"var rxcomp_hydrate_ = "+JSON.stringify(u)+";");a.append(l),null==(o=i.parentNode)||o.insertBefore(a,i)}var h=new e;h.meta=r,r.imports.forEach((function(e){e.prototype.constructor.call(h)}));var f=h.compile(r.node,{document:n});return h.instances=f,f[0].pushChanges(),h},t.serialize=function(){if(this.document instanceof Fe)return this.document.serialize();throw new c.ModuleError("document is not an instance of RxDocument")},t.resolveGlobals=function(e){var t=e.url,n=Te.location;n.assign(t),global.location=n;var r=_e.history;r.replaceState(null,"",n.origin),global.history=r;var o=e.template,i="string"==typeof o?Ie(o):o;return this.document=i,global.document=this.document,r.replaceState(null,i.title||"",n.origin),global.window=global.self=new Re({document:i,history:r,location:n,devicePixelRatio:1}),this.document},t}(c.Platform);function Xe(e){return a.Observable.create((function(t){var n=e.vars.template;n?(t.next(n),t.complete()):t.error(new Error("ServerError: you must provide a template path"))})).pipe(u.switchMap((function(e){return be.readFile$(e)})),u.switchMap((function(t){return t?a.of(t):a.throwError(new Error("ServerError: missing template at path "+e.vars.template))})))}Ke.render$=function(e,t){var n;return a.Observable.create((function(t){n=new Ge(e),t.next(n),t.complete()})).pipe(u.switchMap((function(e){return function(e){e.vars.cacheMode&&(we.mode=e.vars.cacheMode);e.vars.cache&&(we.folder=e.vars.cache);return we.get$("render",e.url)}(e)})),u.switchMap((function(e){return console.log("NodeJs.Server.render$.fromCache","route",n.url,!!e),e?a.of(e):function(e,t){return Xe(e).pipe(u.switchMap((function(n){return e.template=n,t(e)})),u.switchMap((function(t){return we.set$("render",e.url,t,t.maxAge,t.cacheControl).pipe(u.switchMap((function(){return a.of(t)})))})))}(n,t)})))},Ke.template$=Xe,Ke.bootstrap$=function(e,t){return a.Observable.create((function(n){if(!t.template)return n.error(new Error("ServerError: missing template"));try{Ke.bootstrap(e,t);n.next(new Ye(Object.assign({serialize:function(){return Ke.serialize()}},t))),n.complete()}catch(e){n.error(new Je(Object.assign({error:e},t)))}}))};var We=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t.prototype.onInit=function(){c.getContext(this).node.classList.add("init")},t}(c.Component);We.meta={selector:"[app-component]"};var Ze=function(){function e(){}return e.prototype.intercept=function(e,t){return t.handle(e)},e}(),Qe=function(){function e(){}return e.prototype.intercept=function(e,t){return t.handle(e).pipe(u.tap((function(t){t instanceof s.HttpResponse&&(console.log("CustomResponseInterceptor.status",t.status),console.log("CustomResponseInterceptor.filter",e.params.get("filter")))})))},e}(),et=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t.prototype.onInit=function(){},t}(c.Component);et.meta={selector:"[not-found-component]",template:'\n        <div class="page-not-found">\n            <div class="title">Not Found</div>\n        </div>\n        '};var tt=function(e){function t(){return e.apply(this,arguments)||this}ie(t,e);var n=t.prototype;return n.onInit=function(){var e=this;a.combineLatest(this.route.data$,this.route.params$).pipe(u.takeUntil(this.unsubscribe$)).subscribe((function(t){e.title=t[0].title,e.itemId=t[1].itemId}))},n.onEnter=function(e){return h.transition$((function(t){gsap.set(e,{opacity:0}),gsap.to(e,{opacity:1,duration:.6,ease:Power3.easeOut,onComplete:function(){t(!0)}})}))},n.onExit=function(e){return h.transition$((function(t){gsap.set(e,{opacity:1}),gsap.to(e,{opacity:0,duration:.6,ease:Power3.easeOut,onComplete:function(){t(!0)}})}))},t}(h.View);tt.meta={selector:"[detail-component]",template:'\n        <div class="page-detail">\n            <div class="title">Todolist Item {{itemId}}</div>\n        </div>\n        '};var nt={name:"rxcomp-server",host:"",resource:"/",api:"/api",static:!1,development:!1,production:!0},rt=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).items=[],t.error=null,t}ie(t,e);var n=t.prototype;return n.onInit=function(){var e=this,t=""+nt.host+nt.api;s.HttpService.post$(t,{query:"{ getTodos { id, title, completed } }"},{params:{query:"{ getTodos { id, title, completed } }"},reportProgress:!1}).pipe(u.first()).subscribe((function(t){e.items=t.data.getTodos,e.pushChanges()}),console.warn);var n=this.host.route;n&&n.data$.pipe(u.takeUntil(this.unsubscribe$)).subscribe((function(t){e.title=t.title})),c.errors$.pipe(u.takeUntil(this.unsubscribe$)).subscribe((function(t){e.error=t,e.pushChanges()}))},n.onClick=function(e){e.completed=!e.completed,this.pushChanges()},t}(c.Component);rt.meta={selector:"[todolist-component]",hosts:{host:h.RouterOutletStructure},template:'\n        <div class="page-todolist">\n\t\t\t<div class="title">{{title}}</div>\n\t\t\t\x3c!-- {{items | json}} --\x3e\n\t\t\t<ul class="list">\n\t\t\t\t<li class="list__item" *for="let item of items" [class]="{ completed: item.completed }" [style]="{ \'border-color\': item.completed ? \'red\' : \'black\' }">\n\t\t\t\t\t<div class="title" [routerLink]="[\'/todolist\', item.id]" [innerHTML]="item.title"></div>\n\t\t\t\t\t<div class="completed" (click)="onClick(item)" [innerHTML]="item.completed"></div>\n\t\t\t\t\t\x3c!-- !!! debug --\x3e\n\t\t\t\t\t\x3c!-- <div class="completed" (click)="onClick(item)">{{item.completed}}</div> --\x3e\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t\t<div *if="error">\n\t\t\t\t<span>error => {{error | json}}</span>\n\t\t\t</div>\n        </div>\n        '};var ot=function(e){function t(){return e.apply(this,arguments)||this}return ie(t,e),t}(c.Module);ot.meta={imports:[c.CoreModule,s.HttpModule.useInterceptors([Ze,Qe]),h.RouterModule.forRoot([{path:"",redirectTo:"/todolist",pathMatch:"full"},{path:"todolist",component:rt,data:{title:"Todolist"}},{path:"todolist/:itemId",component:tt,data:{title:"Todolist Item"}},{path:"**",component:et}])],declarations:[rt,tt,et],bootstrap:We},e.renderRequest$=function(e){return nt.host=e.vars.host,Ke.bootstrap$(ot,e).pipe(u.switchMap((function(e){return s.HttpService.pendingRequests$.pipe(u.filter((function(e){return 0===e})),u.map((function(){return e.body=e.serialize(),e})),u.first())})))},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=main.min.js.map