{"version":3,"file":"test/js/main.browser.ts","sources":["../../test/js/http/http.service.ts","../../test/js/app.component.ts","../../test/js/app.module.ts","../../test/js/main.browser.ts"],"sourcesContent":["import fetch from 'cross-fetch';\r\nimport { BehaviorSubject, from, Observable, throwError } from 'rxjs';\r\nimport { catchError, finalize } from 'rxjs/operators';\r\n\r\nexport class HttpResponse {\r\n\r\n\tdata?: any;\r\n\turl: string = '';\r\n\tstatus: number = 0;\r\n\tstatusText: string = '';\r\n\tok: boolean = false;\r\n\tredirected: boolean = false;\r\n\r\n\tget static() {\r\n\t\treturn this.url!.indexOf('.json') === this.url!.length - 5;\r\n\t}\r\n\r\n\tconstructor(response: Response) {\r\n\t\tthis.data = null;\r\n\t\tif (response) {\r\n\t\t\tthis.url = response.url;\r\n\t\t\tthis.status = response.status;\r\n\t\t\tthis.statusText = response.statusText;\r\n\t\t\tthis.ok = response.ok;\r\n\t\t\tthis.redirected = response.redirected;\r\n\t\t}\r\n\t}\r\n}\r\n\r\nexport default class HttpService {\r\n\r\n\tstatic pendingRequests$: BehaviorSubject<number> = new BehaviorSubject<number>(0);\r\n\r\n\tstatic http$(method: string, url: string, data?: any, format: string = 'json'): Observable<any> {\r\n\t\tmethod = url.indexOf('.json') !== -1 ? 'GET' : method;\r\n\t\tconst methods = ['POST', 'PUT', 'PATCH'];\r\n\t\tlet response_: HttpResponse | null = null;\r\n\t\tthis.pendingRequests$.next(this.pendingRequests$.getValue() + 1);\r\n\t\treturn from(fetch(url, {\r\n\t\t\tmethod: method,\r\n\t\t\theaders: {\r\n\t\t\t\t'Accept': 'application/json',\r\n\t\t\t\t'Content-Type': 'application/json',\r\n\t\t\t},\r\n\t\t\tbody: methods.indexOf(method) !== -1 ? JSON.stringify(data) : undefined\r\n\t\t}).then((response: Response) => {\r\n\t\t\tresponse_ = new HttpResponse(response);\r\n\t\t\tif (typeof (response as any)[format] === 'function') {\r\n\t\t\t\treturn (response as any)[format]().then((json: any) => {\r\n\t\t\t\t\tresponse_!.data = json;\r\n\t\t\t\t\tif (response.ok) {\r\n\t\t\t\t\t\treturn Promise.resolve(response_);\r\n\t\t\t\t\t} else {\r\n\t\t\t\t\t\treturn Promise.reject(response_);\r\n\t\t\t\t\t}\r\n\t\t\t\t});\r\n\t\t\t} else {\r\n\t\t\t\treturn Promise.reject(response_);\r\n\t\t\t}\r\n\t\t})).pipe(\r\n\t\t\tcatchError(error => {\r\n\t\t\t\tconsole.log('error', error);\r\n\t\t\t\treturn throwError(this.getError(error, response_));\r\n\t\t\t}),\r\n\t\t\tfinalize(() => {\r\n\t\t\t\tthis.pendingRequests$.next(this.pendingRequests$.getValue() - 1);\r\n\t\t\t})\r\n\t\t);\r\n\t}\r\n\r\n\tstatic get$(url: string, data?: any, format?: string): Observable<any> {\r\n\t\tconst query = this.query(data);\r\n\t\treturn this.http$('GET', `${url}${query}`, undefined, format);\r\n\t}\r\n\r\n\tstatic delete$(url: string): Observable<any> {\r\n\t\treturn this.http$('DELETE', url);\r\n\t}\r\n\r\n\tstatic post$(url: string, data?: any): Observable<any> {\r\n\t\treturn this.http$('POST', url, data);\r\n\t}\r\n\r\n\tstatic put$(url: string, data?: any): Observable<any> {\r\n\t\treturn this.http$('PUT', url, data);\r\n\t}\r\n\r\n\tstatic patch$(url: string, data?: any): Observable<any> {\r\n\t\treturn this.http$('PATCH', url, data);\r\n\t}\r\n\r\n\tstatic query(data: any): string {\r\n\t\treturn ''; // todo\r\n\t}\r\n\r\n\tstatic getError(object: any, response: HttpResponse | null): any {\r\n\t\tlet error = typeof object === 'object' ? object : {};\r\n\t\tif (!error.statusCode) {\r\n\t\t\terror.statusCode = response ? response.status : 0;\r\n\t\t}\r\n\t\tif (!error.statusMessage) {\r\n\t\t\terror.statusMessage = response ? response.statusText : object;\r\n\t\t}\r\n\t\t// console.log('HttpService.getError', error, object);\r\n\t\treturn error;\r\n\t}\r\n\r\n}\r\n","import { Component, IFactoryMeta } from 'rxcomp';\r\nimport { first } from 'rxjs/operators';\r\nimport HttpService from './http/http.service';\r\n\r\nexport default class AppComponent extends Component {\r\n\r\n\tonInit() {\r\n\t\tthis.items = new Array(4).fill(0).map((x, i) => {\r\n\t\t\treturn { title: `item ${i + 1}`, completed: Math.random() > 0.75 };\r\n\t\t});\r\n\t\tthis.flag = true;\r\n\t\tthis.active = false;\r\n\t\t// console.log('AppComponent.onInit', this);\r\n\t\tHttpService.get$('https://jsonplaceholder.typicode.com/users/1/todos').pipe(\r\n\t\t\tfirst(),\r\n\t\t).subscribe(response => {\r\n\t\t\tconsole.log('AppComponent.items', response);\r\n\t\t\tthis.items = response.data;\r\n\t\t\tthis.pushChanges();\r\n\t\t});\r\n\t}\r\n\r\n\tonClick(item: { title: string, completed: boolean }) {\r\n\t\tconsole.log('onClick', item);\r\n\t}\r\n\r\n\tstatic meta: IFactoryMeta = {\r\n\t\tselector: '[app-component]',\r\n\t};\r\n\r\n}\r\n","import { CoreModule, IModuleMeta, Module } from 'rxcomp';\r\nimport AppComponent from './app.component';\r\n\r\nexport default class AppModule extends Module {\r\n\r\n\tstatic meta: IModuleMeta = {\r\n\t\timports: [\r\n\t\t\tCoreModule,\r\n\t\t],\r\n\t\tdeclarations: [\r\n\t\t],\r\n\t\tbootstrap: AppComponent,\r\n\t};\r\n\r\n}\r\n","import { Browser } from 'rxcomp';\r\nimport AppModule from './app.module';\r\n\r\nconsole.log('browser!');\r\n\r\nif (false) {\r\n\tBrowser.bootstrap(AppModule);\r\n}\r\n"],"names":["HttpResponse","response","data","url","status","statusText","ok","redirected","indexOf","length","HttpService","http$","method","format","methods","response_","pendingRequests$","next","getValue","from","fetch","headers","body","JSON","stringify","undefined","then","json","Promise","resolve","reject","pipe","catchError","error","console","log","throwError","getError","finalize","get$","query","delete$","post$","put$","patch$","object","statusCode","statusMessage","BehaviorSubject","AppComponent","onInit","items","Array","fill","map","x","i","title","completed","Math","random","flag","active","first","subscribe","pushChanges","onClick","item","Component","selector","AppModule","Module","imports","CoreModule","declarations","bootstrap"],"mappings":"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"}