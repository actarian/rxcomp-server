/**
 * @license rxcomp-server v1.0.0-beta.12
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(t,e,n,r){"use strict";function i(t,e){for(var n=0;n<e.length;n++){var r=e[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(t,r.key,r)}}function o(t,e,n){return e&&i(t.prototype,e),n&&i(t,n),t}function s(t,e){t.prototype=Object.create(e.prototype),t.prototype.constructor=t,t.__proto__=e}var a=function(){function t(){}return t.encode=function(t){var e=null;try{var n=new Map,r=JSON.stringify(t,(function(t,e){if("object"==typeof e&&null!=e){if(n.has(e))return;n.set(e,!0)}return e}));e=btoa(encodeURIComponent(r))}catch(e){console.warn("StorageService.encode.error",t,e)}return e},t.decode=function(t){var e;if(t)try{e=JSON.parse(decodeURIComponent(atob(t)))}catch(n){e=t}return e},t.isSupported=function(t){var e,n=!1;try{e=window[t];var r="__storage_test__";e.setItem(r,r),e.removeItem(r),n=!0}catch(t){n=t instanceof DOMException&&(22===t.code||1014===t.code||"QuotaExceededError"===t.name||"NS_ERROR_DOM_QUOTA_REACHED"===t.name)&&Boolean(e&&0!==e.length)}return n},t}();a.supported=!1;var c=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){var t=this;this.toRawArray().forEach((function(e){t.setter(e.name,"",-1)}))},e.delete=function(t){this.setter(t,"",-1)},e.exist=function(t){return-1!==document.cookie.indexOf(";"+t+"=")||0===document.cookie.indexOf(t+"=")},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e,n){this.setter(t,this.encode(e),n)},e.getRaw=function(t){var e=null,n=this.toRawArray().find((function(e){return e.name===t}));return n&&(e=n.value),e},e.setRaw=function(t,e,n){this.setter(t,e,n)},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){return document.cookie.split(";").map((function(t){var e=t.split("=");return{name:e[0].trim(),value:e[1]?e[1].trim():null}})).filter((function(t){return""!==t.name}))},e.setter=function(t,e,n){var r;if(n){var i=new Date;i.setTime(i.getTime()+24*n*60*60*1e3),r="; expires="+i.toUTCString()}else r="";document.cookie=t+"="+e+r+"; path=/",this.items$.next(this.toArray())},e.isSupported=function(){return"undefined"!=typeof window&&void 0!==window.document},e}(a);c.items$=new n.ReplaySubject(1);var u=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(n,t);var r=n.prototype;return r.onInit=function(){var t=this;this.items=c.toArray(),c.items$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},r.onToggle=function(){this.active=!this.active,this.pushChanges()},r.onClear=function(){c.clear()},r.onRemove=function(t){c.delete(t.name)},n}(t.Component);u.meta={selector:"cookie-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ cookie</span>\n\t\t\t\t\t<span *if="active">- cookie</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var l=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){this.isSupported()&&(localStorage.clear(),this.items$.next(this.toArray()))},e.delete=function(t){this.isSupported()&&(localStorage.removeItem(t),this.items$.next(this.toArray()))},e.exist=function(t){return!!this.isSupported()&&void 0!==localStorage.getItem(t)},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e){this.setRaw(t,this.encode(e))},e.getRaw=function(t){var e=null;return this.isSupported()&&(e=localStorage.getItem(t)),e},e.setRaw=function(t,e){e&&this.isSupported()&&(localStorage.setItem(t,e),this.items$.next(this.toArray()))},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){var t=this;return this.isSupported()?Object.keys(localStorage).map((function(e){return{name:e,value:t.getRaw(e)}})):[]},e.isSupported=function(){return!!this.supported||a.isSupported("localStorage")},e}(a);l.items$=new n.ReplaySubject(1);var p=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(n,t);var r=n.prototype;return r.onInit=function(){var t=this;this.items=l.toArray(),l.items$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},r.onToggle=function(){this.active=!this.active,this.pushChanges()},r.onClear=function(){l.clear()},r.onRemove=function(t){l.delete(t.name)},n}(t.Component);p.meta={selector:"local-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ localStorage</span>\n\t\t\t\t\t<span *if="active">- localStorage</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var f=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e.clear=function(){this.isSupported()&&(sessionStorage.clear(),this.items$.next(this.toArray()))},e.delete=function(t){this.isSupported()&&(sessionStorage.removeItem(t),this.items$.next(this.toArray()))},e.exist=function(t){return!!this.isSupported()&&void 0!==sessionStorage.getItem(t)},e.get=function(t){return this.decode(this.getRaw(t))},e.set=function(t,e){this.setRaw(t,this.encode(e))},e.getRaw=function(t){var e=null;return this.isSupported()&&(e=sessionStorage.getItem(t)),e},e.setRaw=function(t,e){e&&this.isSupported()&&(sessionStorage.setItem(t,e),this.items$.next(this.toArray()))},e.toArray=function(){var t=this;return this.toRawArray().map((function(e){return e.value=t.decode(e.value),e}))},e.toRawArray=function(){var t=this;return this.isSupported()?Object.keys(sessionStorage).map((function(e){return{name:e,value:t.getRaw(e)}})):[]},e.isSupported=function(){return!!this.supported||a.isSupported("sessionStorage")},e}(a);f.items$=new n.ReplaySubject(1);var d=function(t){function n(){var e;return(e=t.apply(this,arguments)||this).active=!1,e.items=[],e}s(n,t);var r=n.prototype;return r.onInit=function(){var t=this;this.items=f.toArray(),f.items$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(e){t.items=e,t.pushChanges()}))},r.onToggle=function(){this.active=!this.active,this.pushChanges()},r.onClear=function(){f.clear()},r.onRemove=function(t){f.delete(t.name)},n}(t.Component);d.meta={selector:"session-storage-component",template:'\n\t\t<div class="rxc-block">\n\t\t\t<div class="rxc-head">\n\t\t\t\t<span class="rxc-head__title" (click)="onToggle()">\n\t\t\t\t\t<span *if="!active">+ sessionStorage</span>\n\t\t\t\t\t<span *if="active">- sessionStorage</span>\n\t\t\t\t\t<span [innerHTML]="\' {\' + items.length + \')\'"></span>\n\t\t\t\t</span>\n\t\t\t\t<span class="rxc-head__remove" (click)="onClear()">x</span>\n\t\t\t</div>\n\t\t\t<ul class="rxc-list" *if="active">\n\t\t\t\t<li class="rxc-list__item" *for="let item of items">\n\t\t\t\t\t<span class="rxc-list__name" [innerHTML]="item.name"></span>\n\t\t\t\t\t<span class="rxc-list__value" [innerHTML]="item.value | json"></span>\n\t\t\t\t\t<span class="rxc-list__remove" (click)="onRemove(item)">x</span>\n\t\t\t\t</li>\n\t\t\t</ul>\n\t\t</div>'};var h,m=[u,p,d],v=[],g=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(t.Module);g.meta={declarations:[].concat(m,v),exports:[].concat(m,v)},function(t){t[t.Memory=1]="Memory",t[t.Session=2]="Session",t[t.Local=3]="Local",t[t.Cookie=4]="Cookie"}(h||(h={}));var y=function(){function t(t,e,i){void 0===t&&(t={}),void 0===e&&(e=h.Memory),void 0===i&&(i="store"),this.type=e,this.key="rxcomp_"+i,t.busy=!1,t.error=null;var o=new n.BehaviorSubject(t);this.next=function(t){return function(e){t.next(r.produce(t.getValue(),(function(t){return"function"==typeof e&&e(t),t})))}}(o),this.nextError=function(t){return function(e){return t.next(r.produce(t.getValue(),(function(t){return t.error=e,t.busy=!1,t}))),n.of(e)}}(o),this.select=function(t){return function(e){return e(t.getValue())}}(o),this.state$=o.asObservable()}var i=t.prototype;return i.busy$=function(){var t=this;return n.of(null).pipe(e.filter((function(){return!t.select((function(t){return t.busy}))&&(t.state=function(t){t.busy=!0,t.error=null},!0)})))},i.cached$=function(t){var r=this;return n.of(null).pipe(e.map((function(){var e=null;return r.type===h.Local?e=l.get(r.key):r.type===h.Session?e=f.get(r.key):r.type===h.Cookie&&(e=c.get(r.key)),e&&"function"==typeof t&&(e=t(e)),e})),e.filter((function(t){return null!=t})))},i.select$=function(t){return this.state$.pipe(e.map(t),e.distinctUntilChanged())},i.select=function(t){},i.next=function(t){},i.nextError=function(t){return n.of()},i.reducer=function(t){var r=this;return function(i){return n.defer((function(){return i.pipe(e.map((function(e){return"function"==typeof t&&(r.state=function(n){n.error=null,t(e,n),n.busy=!1,r.type===h.Local&&l.set(r.key,n),r.type===h.Session&&f.set(r.key,n),r.type===h.Cookie&&c.set(r.key,n,365)}),e})))}))}},i.catchState=function(t){var r=this;return function(i){return n.defer((function(){return i.pipe(e.catchError((function(e){return r.state=function(t){t.error=e,t.busy=!1},(e="function"==typeof t?t(e):null)?n.of(e):n.of()})))}))}},o(t,[{key:"state",get:function(){return this.select((function(t){return t}))},set:function(t){this.next(t)}}]),t}();var b,x,S,$=0,_=function(){function t(){}return t.load$=function(t){return n.of(new Array(1).fill(0).map((function(t,e){var n=(new Date).valueOf()+e;return{id:n,name:$+++" item "+n}}))).pipe(e.delay(300*Math.random()))},t.addItem$=function(t,r){var i=(new Date).valueOf();return Math.random()<.3?n.of(1).pipe(e.delay(300*Math.random()),e.switchMap((function(){return n.throwError("simulated error "+i)}))):n.of({id:i,name:$+++" item "+i}).pipe(e.delay(300*Math.random()))},t.clearItems$=function(t){return n.of([]).pipe(e.delay(300*Math.random()))},t.remove$=function(t,r){return n.of(r).pipe(e.delay(300*Math.random()))},t.patch$=function(t,r){return n.of(r).pipe(e.delay(300*Math.random()))},t}(),w=(b={todolist:[]},x=h.Session,{state$:(S=new y(b,x,"todolist")).state$,busy$:S.busy$.bind(S),cached$:S.cached$.bind(S),select$:S.select$.bind(S),select:S.select.bind(S),next:S.next.bind(S),nextError:S.nextError.bind(S),reducer:S.reducer.bind(S),catchState:S.catchState.bind(S)}),k=w.state$,R=w.busy$,C=w.cached$,M=w.reducer,I=w.catchState,A=function(){function t(){}return t.loadWithCache$=function(){return R().pipe(e.switchMap((function(){return n.merge(C((function(t){return t.todolist})),_.load$("url")).pipe(M((function(t,e){return e.todolist=t})),I(console.log))})))},t.load$=function(){return R().pipe(e.switchMap((function(){return _.load$("url").pipe(M((function(t,e){return e.todolist=t})),I(console.log))})))},t.addItem$=function(){return R().pipe(e.switchMap((function(){return _.addItem$("url").pipe(M((function(t,e){e.todolist.push(t)})),I(console.log))})))},t.clearItems$=function(){return R().pipe(e.switchMap((function(){return _.clearItems$("url").pipe(M((function(t,e){return e.todolist=t})),I(console.log))})))},t.removeItem$=function(t){return R().pipe(e.switchMap((function(){return _.remove$("url",t).pipe(M((function(t,e){var n=e.todolist.reduce((function(e,n,r){return n.id===t?r:e}),-1);-1!==n&&e.todolist.splice(n,1)})),I(console.log))})))},t.toggleCompleted$=function(t){return R().pipe(e.switchMap((function(){return _.patch$("url",t).pipe(M((function(t,e){var n=e.todolist.find((function(e){return e.id===t.id}));n&&(n.completed=!n.completed)})),I(console.log))})))},o(t,null,[{key:"state$",get:function(){return k}}]),t}(),T=0,L=function(n){function r(){return n.apply(this,arguments)||this}s(r,n);var i=r.prototype;return i.onInit=function(){var n=this;t.getContext(this).node.classList.add("init"),A.state$.pipe(e.takeUntil(this.unsubscribe$)).subscribe((function(t){n.state=t,n.pushChanges(),console.log("call",T++)})),A.loadWithCache$().pipe(e.first()).subscribe(console.log)},i.onToggle=function(t){A.toggleCompleted$(t).subscribe(console.log)},i.onAddItem=function(){A.addItem$().subscribe(console.log)},i.onClearItems=function(){A.clearItems$().subscribe(console.log)},i.removeItem=function(t){A.removeItem$(t).subscribe(console.log)},i.clearCookie=function(){c.clear()},i.clearLocalStorage=function(){l.clear()},i.clearSessionStorage=function(){f.clear()},r}(t.Component);L.meta={selector:"[app-component]"};var O=function(t){function e(){return t.apply(this,arguments)||this}return s(e,t),e}(t.Module);O.meta={imports:[t.CoreModule,g],declarations:[],bootstrap:L},t.Browser.bootstrap(O)}(rxcomp,rxjs.operators,rxjs,immer);
//# sourceMappingURL=main.min.js.map
