/**
 * @license rxcomp-server v1.0.0-beta.12
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("stream"),require("http"),require("url"),require("https"),require("zlib"),require("rxjs/operators"),require("rxjs"),require("htmlparser2"),require("rxcomp")):"function"==typeof define&&define.amd?define(["exports","stream","http","url","https","zlib","rxjs/operators","rxjs","htmlparser2","rxcomp"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).main={},e.Stream,e.http,e.Url,e.https,e.zlib,e.rxjs.operators,e.rxjs,e.htmlparser2,e.rxcomp)}(this,(function(e,t,r,n,o,i,s,a,u,c){"use strict";t=t&&Object.prototype.hasOwnProperty.call(t,"default")?t.default:t,r=r&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r,n=n&&Object.prototype.hasOwnProperty.call(n,"default")?n.default:n,o=o&&Object.prototype.hasOwnProperty.call(o,"default")?o.default:o,i=i&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i;var l="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{};const h=t.Readable,f=Symbol("buffer"),d=Symbol("type");class p{constructor(){this[d]="";const e=arguments[0],t=arguments[1],r=[];let n=0;if(e){const t=e,o=Number(t.length);for(let e=0;e<o;e++){const o=t[e];let i;i=o instanceof Buffer?o:ArrayBuffer.isView(o)?Buffer.from(o.buffer,o.byteOffset,o.byteLength):o instanceof ArrayBuffer?Buffer.from(o):o instanceof p?o[f]:Buffer.from("string"==typeof o?o:String(o)),n+=i.length,r.push(i)}}this[f]=Buffer.concat(r);let o=t&&void 0!==t.type&&String(t.type).toLowerCase();o&&!/[^\u0020-\u007E]/.test(o)&&(this[d]=o)}get size(){return this[f].length}get type(){return this[d]}text(){return Promise.resolve(this[f].toString())}arrayBuffer(){const e=this[f],t=e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength);return Promise.resolve(t)}stream(){const e=new h;return e._read=function(){},e.push(this[f]),e.push(null),e}toString(){return"[object Blob]"}slice(){const e=this.size,t=arguments[0],r=arguments[1];let n,o;n=void 0===t?0:t<0?Math.max(e+t,0):Math.min(t,e),o=void 0===r?e:r<0?Math.max(e+r,0):Math.min(r,e);const i=Math.max(o-n,0),s=this[f].slice(n,n+i),a=new p([],{type:arguments[2]});return a[f]=s,a}}function y(e,t,r){Error.call(this,e),this.message=e,this.type=t,r&&(this.code=this.errno=r.code),Error.captureStackTrace(this,this.constructor)}let m;Object.defineProperties(p.prototype,{size:{enumerable:!0},type:{enumerable:!0},slice:{enumerable:!0}}),Object.defineProperty(p.prototype,Symbol.toStringTag,{value:"Blob",writable:!1,enumerable:!1,configurable:!0}),y.prototype=Object.create(Error.prototype),y.prototype.constructor=y,y.prototype.name="FetchError";try{m=require("encoding").convert}catch(e){}const b=Symbol("Body internals"),g=t.PassThrough;function v(e){var r=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},o=n.size;let i=void 0===o?0:o;var s=n.timeout;let a=void 0===s?0:s;null==e?e=null:E(e)?e=Buffer.from(e.toString()):T(e)||Buffer.isBuffer(e)||("[object ArrayBuffer]"===Object.prototype.toString.call(e)?e=Buffer.from(e):ArrayBuffer.isView(e)?e=Buffer.from(e.buffer,e.byteOffset,e.byteLength):e instanceof t||(e=Buffer.from(String(e)))),this[b]={body:e,disturbed:!1,error:null},this.size=i,this.timeout=a,e instanceof t&&e.on("error",(function(e){const t="AbortError"===e.name?e:new y(`Invalid response body while trying to fetch ${r.url}: ${e.message}`,"system",e);r[b].error=t}))}function w(){var e=this;if(this[b].disturbed)return v.Promise.reject(new TypeError("body used already for: "+this.url));if(this[b].disturbed=!0,this[b].error)return v.Promise.reject(this[b].error);let r=this.body;if(null===r)return v.Promise.resolve(Buffer.alloc(0));if(T(r)&&(r=r.stream()),Buffer.isBuffer(r))return v.Promise.resolve(r);if(!(r instanceof t))return v.Promise.resolve(Buffer.alloc(0));let n=[],o=0,i=!1;return new v.Promise((function(t,s){let a;e.timeout&&(a=setTimeout((function(){i=!0,s(new y(`Response timeout while trying to fetch ${e.url} (over ${e.timeout}ms)`,"body-timeout"))}),e.timeout)),r.on("error",(function(t){"AbortError"===t.name?(i=!0,s(t)):s(new y(`Invalid response body while trying to fetch ${e.url}: ${t.message}`,"system",t))})),r.on("data",(function(t){if(!i&&null!==t){if(e.size&&o+t.length>e.size)return i=!0,void s(new y(`content size at ${e.url} over limit: ${e.size}`,"max-size"));o+=t.length,n.push(t)}})),r.on("end",(function(){if(!i){clearTimeout(a);try{t(Buffer.concat(n,o))}catch(t){s(new y(`Could not create Buffer from response body for ${e.url}: ${t.message}`,"system",t))}}}))}))}function E(e){return"object"==typeof e&&"function"==typeof e.append&&"function"==typeof e.delete&&"function"==typeof e.get&&"function"==typeof e.getAll&&"function"==typeof e.has&&"function"==typeof e.set&&("URLSearchParams"===e.constructor.name||"[object URLSearchParams]"===Object.prototype.toString.call(e)||"function"==typeof e.sort)}function T(e){return"object"==typeof e&&"function"==typeof e.arrayBuffer&&"string"==typeof e.type&&"function"==typeof e.stream&&"function"==typeof e.constructor&&"string"==typeof e.constructor.name&&/^(Blob|File)$/.test(e.constructor.name)&&/^(Blob|File)$/.test(e[Symbol.toStringTag])}function O(e){let r,n,o=e.body;if(e.bodyUsed)throw new Error("cannot clone body after it is used");return o instanceof t&&"function"!=typeof o.getBoundary&&(r=new g,n=new g,o.pipe(r),o.pipe(n),e[b].body=r,o=n),o}function N(e){return null===e?null:"string"==typeof e?"text/plain;charset=UTF-8":E(e)?"application/x-www-form-urlencoded;charset=UTF-8":T(e)?e.type||null:Buffer.isBuffer(e)||"[object ArrayBuffer]"===Object.prototype.toString.call(e)||ArrayBuffer.isView(e)?null:"function"==typeof e.getBoundary?"multipart/form-data;boundary="+e.getBoundary():e instanceof t?null:"text/plain;charset=UTF-8"}function _(e){const t=e.body;return null===t?0:T(t)?t.size:Buffer.isBuffer(t)?t.length:t&&"function"==typeof t.getLengthSync&&(t._lengthRetrievers&&0==t._lengthRetrievers.length||t.hasKnownLength&&t.hasKnownLength())?t.getLengthSync():null}v.prototype={get body(){return this[b].body},get bodyUsed(){return this[b].disturbed},arrayBuffer(){return w.call(this).then((function(e){return e.buffer.slice(e.byteOffset,e.byteOffset+e.byteLength)}))},blob(){let e=this.headers&&this.headers.get("content-type")||"";return w.call(this).then((function(t){return Object.assign(new p([],{type:e.toLowerCase()}),{[f]:t})}))},json(){var e=this;return w.call(this).then((function(t){try{return JSON.parse(t.toString())}catch(t){return v.Promise.reject(new y(`invalid json response body at ${e.url} reason: ${t.message}`,"invalid-json"))}}))},text(){return w.call(this).then((function(e){return e.toString()}))},buffer(){return w.call(this)},textConverted(){var e=this;return w.call(this).then((function(t){return function(e,t){if("function"!=typeof m)throw new Error("The package `encoding` must be installed to use the textConverted() function");const r=t.get("content-type");let n,o,i="utf-8";r&&(n=/charset=([^;]*)/i.exec(r));o=e.slice(0,1024).toString(),!n&&o&&(n=/<meta.+?charset=(['"])(.+?)\1/i.exec(o));!n&&o&&(n=/<meta[\s]+?http-equiv=(['"])content-type\1[\s]+?content=(['"])(.+?)\2/i.exec(o),n&&(n=/charset=(.*)/i.exec(n.pop())));!n&&o&&(n=/<\?xml.+?encoding=(['"])(.+?)\1/i.exec(o));n&&(i=n.pop(),"gb2312"!==i&&"gbk"!==i||(i="gb18030"));return m(e,"UTF-8",i).toString()}(t,e.headers)}))}},Object.defineProperties(v.prototype,{body:{enumerable:!0},bodyUsed:{enumerable:!0},arrayBuffer:{enumerable:!0},blob:{enumerable:!0},json:{enumerable:!0},text:{enumerable:!0}}),v.mixIn=function(e){for(const t of Object.getOwnPropertyNames(v.prototype))if(!(t in e)){const r=Object.getOwnPropertyDescriptor(v.prototype,t);Object.defineProperty(e,t,r)}},v.Promise=global.Promise;const x=/[^\^_`a-zA-Z\-0-9!#$%&'*+.|~]/,S=/[^\t\x20-\x7e\x80-\xff]/;function j(e){if(e=""+e,x.test(e)||""===e)throw new TypeError(e+" is not a legal HTTP header name")}function P(e){if(e=""+e,S.test(e))throw new TypeError(e+" is not a legal HTTP header value")}function C(e,t){t=t.toLowerCase();for(const r in e)if(r.toLowerCase()===t)return r}const A=Symbol("map");class R{constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:void 0;if(this[A]=Object.create(null),e instanceof R){const t=e.raw(),r=Object.keys(t);for(const e of r)for(const r of t[e])this.append(e,r)}else if(null==e);else{if("object"!=typeof e)throw new TypeError("Provided initializer must be an object");{const t=e[Symbol.iterator];if(null!=t){if("function"!=typeof t)throw new TypeError("Header pairs must be iterable");const r=[];for(const t of e){if("object"!=typeof t||"function"!=typeof t[Symbol.iterator])throw new TypeError("Each header pair must be iterable");r.push(Array.from(t))}for(const e of r){if(2!==e.length)throw new TypeError("Each header pair must be a name/value tuple");this.append(e[0],e[1])}}else for(const t of Object.keys(e)){const r=e[t];this.append(t,r)}}}}get(e){j(e=""+e);const t=C(this[A],e);return void 0===t?null:this[A][t].join(", ")}forEach(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:void 0,r=k(this),n=0;for(;n<r.length;){var o=r[n];const i=o[0],s=o[1];e.call(t,s,i,this),r=k(this),n++}}set(e,t){t=""+t,j(e=""+e),P(t);const r=C(this[A],e);this[A][void 0!==r?r:e]=[t]}append(e,t){t=""+t,j(e=""+e),P(t);const r=C(this[A],e);void 0!==r?this[A][r].push(t):this[A][e]=[t]}has(e){return j(e=""+e),void 0!==C(this[A],e)}delete(e){j(e=""+e);const t=C(this[A],e);void 0!==t&&delete this[A][t]}raw(){return this[A]}keys(){return D(this,"key")}values(){return D(this,"value")}[Symbol.iterator](){return D(this,"key+value")}}function k(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"key+value";const r=Object.keys(e[A]).sort();return r.map("key"===t?function(e){return e.toLowerCase()}:"value"===t?function(t){return e[A][t].join(", ")}:function(t){return[t.toLowerCase(),e[A][t].join(", ")]})}R.prototype.entries=R.prototype[Symbol.iterator],Object.defineProperty(R.prototype,Symbol.toStringTag,{value:"Headers",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(R.prototype,{get:{enumerable:!0},forEach:{enumerable:!0},set:{enumerable:!0},append:{enumerable:!0},has:{enumerable:!0},delete:{enumerable:!0},keys:{enumerable:!0},values:{enumerable:!0},entries:{enumerable:!0}});const M=Symbol("internal");function D(e,t){const r=Object.create(z);return r[M]={target:e,kind:t,index:0},r}const z=Object.setPrototypeOf({next(){if(!this||Object.getPrototypeOf(this)!==z)throw new TypeError("Value of `this` is not a HeadersIterator");var e=this[M];const t=e.target,r=e.kind,n=e.index,o=k(t,r);return n>=o.length?{value:void 0,done:!0}:(this[M].index=n+1,{value:o[n],done:!1})}},Object.getPrototypeOf(Object.getPrototypeOf([][Symbol.iterator]())));function q(e){const t=Object.assign({__proto__:null},e[A]),r=C(e[A],"Host");return void 0!==r&&(t[r]=t[r][0]),t}Object.defineProperty(z,Symbol.toStringTag,{value:"HeadersIterator",writable:!1,enumerable:!1,configurable:!0});const B=Symbol("Response internals"),U=r.STATUS_CODES;class ${constructor(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:null,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};v.call(this,e,t);const r=t.status||200,n=new R(t.headers);if(null!=e&&!n.has("Content-Type")){const t=N(e);t&&n.append("Content-Type",t)}this[B]={url:t.url,status:r,statusText:t.statusText||U[r],headers:n,counter:t.counter}}get url(){return this[B].url||""}get status(){return this[B].status}get ok(){return this[B].status>=200&&this[B].status<300}get redirected(){return this[B].counter>0}get statusText(){return this[B].statusText}get headers(){return this[B].headers}clone(){return new $(O(this),{url:this.url,status:this.status,statusText:this.statusText,headers:this.headers,ok:this.ok,redirected:this.redirected})}}v.mixIn($.prototype),Object.defineProperties($.prototype,{url:{enumerable:!0},status:{enumerable:!0},ok:{enumerable:!0},redirected:{enumerable:!0},statusText:{enumerable:!0},headers:{enumerable:!0},clone:{enumerable:!0}}),Object.defineProperty($.prototype,Symbol.toStringTag,{value:"Response",writable:!1,enumerable:!1,configurable:!0});const L=Symbol("Request internals"),F=n.parse,I=n.format,V="destroy"in t.Readable.prototype;function H(e){return"object"==typeof e&&"object"==typeof e[L]}class G{constructor(e){let t,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};H(e)?t=F(e.url):(t=e&&e.href?F(e.href):F(""+e),e={});let n=r.method||e.method||"GET";if(n=n.toUpperCase(),(null!=r.body||H(e)&&null!==e.body)&&("GET"===n||"HEAD"===n))throw new TypeError("Request with GET/HEAD method cannot have body");let o=null!=r.body?r.body:H(e)&&null!==e.body?O(e):null;v.call(this,o,{timeout:r.timeout||e.timeout||0,size:r.size||e.size||0});const i=new R(r.headers||e.headers||{});if(null!=o&&!i.has("Content-Type")){const e=N(o);e&&i.append("Content-Type",e)}let s=H(e)?e.signal:null;if("signal"in r&&(s=r.signal),null!=s&&!function(e){const t=e&&"object"==typeof e&&Object.getPrototypeOf(e);return!(!t||"AbortSignal"!==t.constructor.name)}(s))throw new TypeError("Expected signal to be an instanceof AbortSignal");this[L]={method:n,redirect:r.redirect||e.redirect||"follow",headers:i,parsedURL:t,signal:s},this.follow=void 0!==r.follow?r.follow:void 0!==e.follow?e.follow:20,this.compress=void 0!==r.compress?r.compress:void 0===e.compress||e.compress,this.counter=r.counter||e.counter||0,this.agent=r.agent||e.agent}get method(){return this[L].method}get url(){return I(this[L].parsedURL)}get headers(){return this[L].headers}get redirect(){return this[L].redirect}get signal(){return this[L].signal}clone(){return new G(this)}}function J(e){Error.call(this,e),this.type="aborted",this.message=e,Error.captureStackTrace(this,this.constructor)}v.mixIn(G.prototype),Object.defineProperty(G.prototype,Symbol.toStringTag,{value:"Request",writable:!1,enumerable:!1,configurable:!0}),Object.defineProperties(G.prototype,{method:{enumerable:!0},url:{enumerable:!0},headers:{enumerable:!0},redirect:{enumerable:!0},clone:{enumerable:!0},signal:{enumerable:!0}}),J.prototype=Object.create(Error.prototype),J.prototype.constructor=J,J.prototype.name="AbortError";const K=t.PassThrough,Y=n.resolve;function X(e,n){if(!X.Promise)throw new Error("native promise missing, set fetch.Promise to your favorite alternative");return v.Promise=X.Promise,new X.Promise((function(s,a){const u=new G(e,n),c=function(e){const r=e[L].parsedURL,n=new R(e[L].headers);if(n.has("Accept")||n.set("Accept","*/*"),!r.protocol||!r.hostname)throw new TypeError("Only absolute URLs are supported");if(!/^https?:$/.test(r.protocol))throw new TypeError("Only HTTP(S) protocols are supported");if(e.signal&&e.body instanceof t.Readable&&!V)throw new Error("Cancellation of streamed requests with AbortSignal is not supported in node < 8");let o=null;if(null==e.body&&/^(POST|PUT)$/i.test(e.method)&&(o="0"),null!=e.body){const t=_(e);"number"==typeof t&&(o=String(t))}o&&n.set("Content-Length",o),n.has("User-Agent")||n.set("User-Agent","node-fetch/1.0 (+https://github.com/bitinn/node-fetch)"),e.compress&&!n.has("Accept-Encoding")&&n.set("Accept-Encoding","gzip,deflate");let i=e.agent;return"function"==typeof i&&(i=i(r)),n.has("Connection")||i||n.set("Connection","close"),Object.assign({},r,{method:e.method,headers:q(n),agent:i})}(u),l=("https:"===c.protocol?o:r).request,h=u.signal;let f=null;const d=function(){let e=new J("The user aborted a request.");a(e),u.body&&u.body instanceof t.Readable&&u.body.destroy(e),f&&f.body&&f.body.emit("error",e)};if(h&&h.aborted)return void d();const p=function(){d(),g()},m=l(c);let b;function g(){m.abort(),h&&h.removeEventListener("abort",p),clearTimeout(b)}h&&h.addEventListener("abort",p),u.timeout&&m.once("socket",(function(e){b=setTimeout((function(){a(new y("network timeout at: "+u.url,"request-timeout")),g()}),u.timeout)})),m.on("error",(function(e){a(new y(`request to ${u.url} failed, reason: ${e.message}`,"system",e)),g()})),m.on("response",(function(e){clearTimeout(b);const t=function(e){const t=new R;for(const r of Object.keys(e))if(!x.test(r))if(Array.isArray(e[r]))for(const n of e[r])S.test(n)||(void 0===t[A][r]?t[A][r]=[n]:t[A][r].push(n));else S.test(e[r])||(t[A][r]=[e[r]]);return t}(e.headers);if(X.isRedirect(e.statusCode)){const r=t.get("Location"),n=null===r?null:Y(u.url,r);switch(u.redirect){case"error":return a(new y("redirect mode is set to error: "+u.url,"no-redirect")),void g();case"manual":if(null!==n)try{t.set("Location",n)}catch(e){a(e)}break;case"follow":if(null===n)break;if(u.counter>=u.follow)return a(new y("maximum redirect reached at: "+u.url,"max-redirect")),void g();const r={headers:new R(u.headers),follow:u.follow,counter:u.counter+1,agent:u.agent,compress:u.compress,method:u.method,body:u.body,signal:u.signal,timeout:u.timeout};return 303!==e.statusCode&&u.body&&null===_(u)?(a(new y("Cannot follow redirect with body being a readable stream","unsupported-redirect")),void g()):(303!==e.statusCode&&(301!==e.statusCode&&302!==e.statusCode||"POST"!==u.method)||(r.method="GET",r.body=void 0,r.headers.delete("content-length")),s(X(new G(n,r))),void g())}}e.once("end",(function(){h&&h.removeEventListener("abort",p)}));let r=e.pipe(new K);const n={url:u.url,status:e.statusCode,statusText:e.statusMessage,headers:t,size:u.size,timeout:u.timeout,counter:u.counter},o=t.get("Content-Encoding");if(!u.compress||"HEAD"===u.method||null===o||204===e.statusCode||304===e.statusCode)return f=new $(r,n),void s(f);const c={flush:i.Z_SYNC_FLUSH,finishFlush:i.Z_SYNC_FLUSH};if("gzip"==o||"x-gzip"==o)return r=r.pipe(i.createGunzip(c)),f=new $(r,n),void s(f);if("deflate"!=o&&"x-deflate"!=o){if("br"==o&&"function"==typeof i.createBrotliDecompress)return r=r.pipe(i.createBrotliDecompress()),f=new $(r,n),void s(f);f=new $(r,n),s(f)}else{e.pipe(new K).once("data",(function(e){r=8==(15&e[0])?r.pipe(i.createInflate()):r.pipe(i.createInflateRaw()),f=new $(r,n),s(f)}))}})),function(e,t){const r=t.body;null===r?e.end():T(r)?r.stream().pipe(e):Buffer.isBuffer(r)?(e.write(r),e.end()):r.pipe(e)}(m,u)}))}X.isRedirect=function(e){return 301===e||302===e||303===e||307===e||308===e},X.Promise=global.Promise;var W,Z=(W=Object.freeze({__proto__:null,default:X,Headers:R,Request:G,Response:$,FetchError:y}))&&W.default||W,Q=function(e,t,r){return e(r={path:t,exports:{},require:function(e,t){return function(){throw new Error("Dynamic requires are not currently supported by @rollup/plugin-commonjs")}(null==t&&r.path)}},r.exports),r.exports}((function(e,t){var r=Z.default||Z,n=function(e,t){return/^\/\//.test(e)&&(e="https:"+e),r.call(this,e,t)};e.exports=t=n,t.fetch=n,t.Headers=Z.Headers,t.Request=Z.Request,t.Response=Z.Response,t.default=n})),ee=Q.fetch.bind({});function te(e,t){for(var r=0;r<t.length;r++){var n=t[r];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}function re(e,t,r){return t&&te(e.prototype,t),r&&te(e,r),e}function ne(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function oe(e){return(oe=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function ie(e,t){return(ie=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function se(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function ae(e,t,r){return(ae=se()?Reflect.construct:function(e,t,r){var n=[null];n.push.apply(n,t);var o=new(Function.bind.apply(e,n));return r&&ie(o,r.prototype),o}).apply(null,arguments)}function ue(e){var t="function"==typeof Map?new Map:void 0;return(ue=function(e){if(null===e||(r=e,-1===Function.toString.call(r).indexOf("[native code]")))return e;var r;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,n)}function n(){return ae(e,arguments,oe(this).constructor)}return n.prototype=Object.create(e.prototype,{constructor:{value:n,enumerable:!1,writable:!0,configurable:!0}}),ie(n,e)})(e)}function ce(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var r=0,n=new Array(t);r<t;r++)n[r]=e[r];return n}function he(e,t){var r;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(r=function(e,t){if(e){if("string"==typeof e)return le(e,t);var r=Object.prototype.toString.call(e).slice(8,-1);return"Object"===r&&e.constructor&&(r=e.constructor.name),"Map"===r||"Set"===r?Array.from(e):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?le(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){r&&(e=r);var n=0;return function(){return n>=e.length?{done:!0}:{done:!1,value:e[n++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(r=e[Symbol.iterator]()).next.bind(r)}ee.polyfill=!0,l.fetch||(l.fetch=ee,l.Response=Q.Response,l.Headers=Q.Headers,l.Request=Q.Request);var fe,de,pe=require("fs");!function(e){e.Memory="memory",e.File="file"}(fe||(fe={})),function(e){e.Public="public",e.Private="private",e.NoCache="no-cache",e.NoStore="no-store"}(de||(de={}));var ye,me,be=function(){function e(e){this.date=new Date,this.maxAge=0,this.cacheControl=de.Public,e&&(this.value=e.value,this.date=e.date?new Date(e.date):this.date,this.maxAge=e.maxAge||this.maxAge,this.cacheControl=e.cacheControl||this.cacheControl)}return re(e,[{key:"expired",get:function(){return this.cacheControl===de.NoStore||0===this.maxAge||this.date.getTime()+1e3*this.maxAge<Date.now()}}]),e}(),ge=function(){function e(){}return e.has=function(e,t){void 0===e&&(e="cache");var r=!1;switch(this.mode){case fe.File:r=this.hasFile(e,t);break;case fe.Memory:default:var n=e+"_"+t;r=this.cache_.has(n)}return r},e.get=function(e,t){void 0===e&&(e="cache");var r,n=null,o=e+"_"+t;switch(this.mode){case fe.File:var i;if(this.hasFile(e,t))if(r=this.readFile(e,t))if(r.expired)this.unlinkFile(e,t);else n=null==(i=r)?void 0:i.value;break;case fe.Memory:default:if(this.cache_.has(o)){var s=this.cache_.get(o);s&&(r=new be(JSON.parse(s)))&&(r.expired?this.cache_.delete(o):n=r.value)}}return n},e.set=function(e,t,r,n){void 0===e&&(e="cache"),void 0===n&&(n=0);var o=e+"_"+t,i=new be({value:r,maxAge:n});switch(this.mode){case fe.File:this.writeFile(e,t,i);break;case fe.Memory:default:var s=this.serialize(i);console.log(s),this.cache_.set(o,s)}return r},e.delete=function(e,t){switch(void 0===e&&(e="cache"),this.mode){case fe.File:this.unlinkFile(e,t);break;case fe.Memory:default:var r=e+"_"+t;this.cache_.has(r)&&this.cache_.delete(r)}},e.getPath=function(e,t){void 0===e&&(e="cache");var r=("_"+e+"_"+t).replace(/(\/|\?|\#|\&)+/g,(function(e,t){return encodeURIComponent(t)}));return""+this.folder+r},e.hasFile=function(e,t){void 0===e&&(e="cache");var r=!1,n=this.getPath(e,t);try{pe.existsSync(n)&&(r=!0)}catch(e){throw e}return r},e.readFile=function(e,t){void 0===e&&(e="cache");var r=null,n=this.getPath(e,t);try{var o=pe.readFileSync(n,"utf8");r=new be(JSON.parse(o))}catch(e){throw e}return r},e.writeFile=function(e,t,r){void 0===e&&(e="cache");var n=this.getPath(e,t);try{var o=this.serialize(r);pe.writeFileSync(n,o,"utf8")}catch(e){throw e}return r},e.unlinkFile=function(e,t){void 0===e&&(e="cache");var r=this.getPath(e,t);try{pe.existsSync(r)&&pe.unlinkSync(r)}catch(e){throw e}},e.readFile$=function(e,t){void 0===e&&(e="cache");var r=this;return a.Observable.create((function(n){var o=r.folder+"_"+e+"_"+t;pe.readFile(o,"utf8",(function(e,t){if(e)n.error(e);else{var r=new be(JSON.parse(t));n.next(r),n.complete()}}))}))},e.writeFile$=function(e,t,r){void 0===e&&(e="cache");var n=this;return a.Observable.create((function(o){var i=n.folder+"_"+e+"_"+t,s=n.serialize(r);pe.writeFile(i,s,"utf8",(function(e){e?o.error(e):(o.next(r),o.complete())}))}))},e.serialize=function(e){var t=new Map,r=JSON.stringify(e,(function(e,r){if(r&&"object"==typeof r){if(t.has(r))return;t.set(r,!0)}return r}),0);return t.clear(),r},e}();function ve(e){return e.nodeType===ye.ELEMENT_NODE}function we(e){return e.nodeType===ye.TEXT_NODE}function Ee(e){var t,r=new ze,n=r,o=new u.Parser({onopentag:function(e,r){t=new Ce(n,e,r),n.childNodes.push(t),n=t},onclosetag:function(e){n.parentNode&&(n=n.parentNode)},ontext:function(e){var t=new Ae(n,e);n.childNodes.push(t)},onprocessinginstruction:function(e,r){t="!doctype"===e?new Me(n,r):new ke(n,r),n.childNodes.push(t)},oncomment:function(e){t=new Re(n,e),n.childNodes.push(t)},oncommentend:function(){},oncdatastart:function(){console.log("oncdatastart")},oncdataend:function(){console.log("oncdataend")},onerror:function(e){console.log("error",e)}},{decodeEntities:!1,lowerCaseTags:!0});return o.write(e),o.end(),r}function Te(e){var t=[];return e.trim().split(" ").forEach((function(e){e.trim().split(">").forEach((function(e,r){for(var n,o=[],i=he(e.matchAll(/\:not\(\#([^\.[#:]+)\)|\:not\(\.([^\.[#:]+)\)|\:not\(\[([^\.\[#:]+)\]\)|\:not\(([^\.\[#:\]]+)\)|\#([^\.[#:]+)|\.([^\.[#:]+)|\[([^\.\[#:]+)\]|([^\.\[#:\]]+)/g));!(n=i()).done;){var s=n.value;s[1]?o.push({selector:s[1],type:me.Id,negate:!0}):s[2]?o.push({selector:s[2],type:me.Class,negate:!0}):s[3]?o.push({selector:s[3],type:me.Attribute,negate:!0}):s[4]?o.push({selector:s[4],type:me.TagName,negate:!0}):s[5]?o.push({selector:s[5],type:me.Id,negate:!1}):s[6]?o.push({selector:s[6],type:me.Class,negate:!1}):s[7]?o.push({selector:s[7],type:me.Attribute,negate:!1}):s[8]&&o.push({selector:s[8],type:me.TagName,negate:!1})}var a=r>0?{selector:e,selectors:o,inner:!0}:{selector:e,selectors:o,inner:!1};t.push.call(t,a)}))})),t}function Oe(e,t){return t.reduce((function(t,r){return t&&function(e,t){switch(t.type){case me.Id:return(""!==t.selector&&e.attributes.id===t.selector)!==t.negate;case me.Class:return-1!==e.classList.indexOf(t.selector)!==t.negate;case me.Attribute:return-1!==Object.keys(e.attributes).indexOf(t.selector)!==t.negate;case me.TagName:return e.nodeName===t.selector!==t.negate;default:return!1}}(e,r)}),!0)}function Ne(e,t,r){void 0===r&&(r=null);var n=null;if(r||e.length){r=r||e.shift();for(var o,i=he(t);!(o=i()).done;){var s=o.value;if(s instanceof Ce){if(Oe(s,r.selectors))return e.length?Ne(e,s.childNodes):s;r.inner||(n=Ne(e,s.childNodes,r))}}}return n}function _e(e,t,r){var n;if(void 0===t&&(t=!1),void 0===r&&(r=null),ve(e)){var o=new Ce(r,e.nodeName,Object.assign({},e.attributes));t&&(o.childNodes=e.childNodes.map((function(e){return _e.apply(e,[e,t,o])}))),n=o}else if(e.nodeType===ye.DOCUMENT_FRAGMENT_NODE){var i=new De;t&&(i.childNodes=e.childNodes.map((function(e){return _e.apply(e,[e,t,i])}))),n=i}else if(we(e))n=new Ae(r,e.nodeValue);else if(function(e){return e.nodeType===ye.COMMENT_NODE}(e))n=new Re(r,e.nodeValue);else{if(!function(e){return e.nodeType===ye.DOCUMENT_NODE}(e))throw new Error("Invalid node type");var s=new ze;t&&(s.childNodes=e.childNodes.map((function(e){return _e.apply(e,[e,t,s])}))),n=s}return n}ge.cache_=new Map,ge.mode=fe.Memory,function(e){e[e.ELEMENT_NODE=1]="ELEMENT_NODE",e[e.TEXT_NODE=3]="TEXT_NODE",e[e.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",e[e.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",e[e.COMMENT_NODE=8]="COMMENT_NODE",e[e.DOCUMENT_NODE=9]="DOCUMENT_NODE",e[e.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",e[e.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE"}(ye||(ye={})),function(e){e[e.None=-1]="None",e[e.Id=0]="Id",e[e.Class=1]="Class",e[e.Attribute=2]="Attribute",e[e.TagName=3]="TagName"}(me||(me={}));var xe,Se=function(){function e(e){void 0===e&&(e=null),this.nodeValue=null,this.parentNode=e,this.nodeType=-1}var t=e.prototype;return t.cloneNode=function(e){return void 0===e&&(e=!1),_e.apply(this,[this,e])},t.serialize=function(){return""},e}(),je=function(){var e=t.prototype;function t(e){Object.defineProperty(this,"node",{value:e,writable:!1,enumerable:!1}),this.init()}return e.item=function(e){var t=Object.keys(this);return t.length>e?t[e]:void 0},e.getPropertyPriority=function(e){var t=this[e];return t&&t.indexOf("!important")?"important":""},e.getPropertyValue=function(e){return this[e]},e.setProperty=function(e,t,r){this[e]=t+("important"===r?"!important":""),this.serialize_()},e.removeProperty=function(e){delete this[e],this.serialize_()},e.serialize_=function(){var e=this;this.node.attributes.style=Object.keys(this).map((function(t){return t+": "+e[t]+";"})).join(" ")},e.init=function(){var e,t=this;if(Object.keys(this).forEach((function(e){return delete t[e]})),null==(e=this.node.attributes)?void 0:e.style){[].concat(this.node.attributes.style.matchAll(/([^:]+):([^;]+);?\s*/gm)).forEach((function(e){var r=e[1],n=e[2];t[r]=n}))}},t}(),Pe=function(e){function t(t){var r;return(r=e.call(this)||this).node=t,r.init(),r}ne(t,e);var r=t.prototype;return r.item=function(e){return this[e]},r.contains=function(e){return-1!==this.indexOf(e)},r.add=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach((function(t){-1!==e.indexOf(t)&&e.push(t)})),this.serialize_()},r.remove=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r.forEach((function(t){var r=e.indexOf(t);-1!==r&&e.splice(r,1)})),this.serialize_()},r.toggle=function(e,t){var r=this.indexOf(e);return!1===t?(this.splice(r,1),this.serialize_(),!1):!0===t?(this.push(e),this.serialize_(),!0):-1!==r?(this.splice(r,1),this.serialize_(),!1):(this.push(e),this.serialize_(),!0)},r.replace=function(e,t){var r=this.indexOf(e);-1!==r&&this.splice(r,1),this.push(t),this.serialize_()},r.serialize_=function(){this.node.attributes.class=this.join(" ")},r.init=function(){var e;this.length=0,(null==(e=this.node.attributes)?void 0:e.class)&&Array.prototype.push.apply(this,this.node.attributes.class.split(" ").map((function(e){return e.trim()})))},t}(ue(Array)),Ce=function(e){function t(t,r,n){var o;return void 0===t&&(t=null),void 0===n&&(n=null),(o=e.call(this,t)||this).attributes={},o.nodeType=ye.ELEMENT_NODE,o.nodeName=r,n&&"object"==typeof n&&(o.attributes=n),o.style=new je(ce(o)),o.classList=new Pe(ce(o)),o.childNodes=[],o}ne(t,e);var r=t.prototype;return r.append=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r=r.map((function(t){var r;return"string"==typeof t?r=new Ae(e,t):(r=t).parentNode=e,r})),Array.prototype.push.apply(this.childNodes,r)},r.prepend=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];r=r.map((function(t){var r;return"string"==typeof t?r=new Ae(e,t):(r=t).parentNode=e,r})),Array.prototype.unshift.apply(this.childNodes,r)},r.replaceChildren=function(){for(var e=this,t=arguments.length,r=new Array(t),n=0;n<t;n++)r[n]=arguments[n];var o=r.map((function(t){var r;return"string"==typeof t?r=new Ae(e,t):(r=t).parentNode=e,r}));this.childNodes=o},r.querySelectorAll=function(e){var t=Te(e),r=this.childNodes.filter((function(e){return!0}));return console.log(t),r.length?r:null},r.querySelector=function(e){return Ne(Te(e),this.childNodes)},r.hasAttribute=function(e){return-1!==Object.keys(this.attributes).indexOf(e.toLowerCase())},r.getAttribute=function(e){return this.attributes[e.toLowerCase()]||null},r.setAttribute=function(e,t){this.attributes[e.toLowerCase()]=t.toString(),"style"===e?this.style.init():"class"===e&&this.classList.init()},r.removeAttribute=function(e){delete this.attributes[e],"style"===e?this.style.init():"class"===e&&this.classList.init()},r.replaceChild=function(e,t){var r=this.childNodes.indexOf(t);return-1!==r&&(this.childNodes[r]=e,e.parentNode=this),t},r.removeChild=function(e){if(!(e instanceof Se))throw new Error("Uncaught TypeError: Failed to execute 'removeChild' on 'Node': parameter 1 is not of type 'Node'.");var t=this.childNodes.indexOf(e);if(-1===t)throw new Error("Uncaught NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.");return this.childNodes.splice(t,1),e},r.insertBefore=function(e,t){void 0===t&&(t=null);var r=t?this.childNodes.indexOf(t):this.childNodes.length;return-1!==r&&(this.childNodes.splice(r,0,e),e.parentNode=this),e},r.cloneNode=function(e){return void 0===e&&(e=!1),_e.apply(this,[this,e])},r.addListener=function(e,t){},r.removeListener=function(e,t){},r.serialize=function(){return"<"+this.nodeName+this.serializeAttributes()+">"+this.childNodes.map((function(e){return e.serialize()})).join("")+"</"+this.nodeName+">"},r.serializeAttributes=function(){var e=this,t="",r=Object.keys(this.attributes);return r.length&&(t=" "+r.map((function(t){return t+'="'+e.attributes[t]+'"'})).join(" ")),t},re(t,[{key:"children",get:function(){var e,t=[],r=0,n=this.childNodes;for(e=n[r++];e;)(e=n[r++]).nodeType===ye.ELEMENT_NODE&&t.push(e);return t}},{key:"childElementCount",get:function(){var e,t=0,r=0,n=this.childNodes;for(e=n[t++];e;)e.nodeType===ye.ELEMENT_NODE&&r++,e=n[t++];return r}},{key:"firstChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[0]),e}},{key:"firstElementChild",get:function(){for(var e,t=he(this.childNodes);!(e=t()).done;){var r=e.value;if(ve(r))return r}return null}},{key:"lastChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[this.childNodes.length-1]),e}},{key:"lastElementChild",get:function(){for(var e=this.childNodes,t=e.length-1;t>-1;t--){var r=e[t];if(ve(r))return r}return null}},{key:"previousSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);t>0&&(e=this.parentNode.childNodes[t-1])}return e}},{key:"nextSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);-1!==t&&t<this.parentNode.childNodes.length-1&&(e=this.parentNode.childNodes[t])}return e}},{key:"wholeText",get:function(){if(this.nodeType===ye.TEXT_NODE)return this.nodeValue}},{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"innerText",set:function(e){this.childNodes=[new Ae(this,e)]},get:function(){return this.childNodes.filter((function(e){return we(e)||ve(e)})).map((function(e){return e.innerText})).join("")}},{key:"textContent",set:function(e){this.innerText=String(e)},get:function(){return this.innerText}},{key:"innerHTML",get:function(){return this.childNodes.map((function(e){return e.serialize()})).join("")},set:function(e){var t=this,r=Ee(e).childNodes.map((function(e){return e.parentNode=t,e}));this.childNodes=r}}]),t}(Se),Ae=function(e){function t(t,r){var n;return void 0===t&&(t=null),(n=e.call(this,t)||this).nodeType=ye.TEXT_NODE,n.nodeValue=String(r),n}return ne(t,e),t.prototype.serialize=function(){return this.nodeValue},re(t,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),t}(Se),Re=function(e){function t(t,r){var n;return void 0===t&&(t=null),(n=e.call(this,t)||this).nodeType=ye.COMMENT_NODE,n.nodeValue=String(r),n}return ne(t,e),t.prototype.serialize=function(){return"\x3c!--"+this.nodeValue+"--\x3e"},re(t,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),t}(Se),ke=function(e){function t(t,r){var n;return void 0===t&&(t=null),(n=e.call(this,t)||this).nodeType=ye.PROCESSING_INSTRUCTION_NODE,n.nodeValue=String(r),n}return ne(t,e),t.prototype.serialize=function(){return"<"+this.nodeValue+">"},t}(Se),Me=function(e){function t(t,r){var n;return void 0===t&&(t=null),(n=e.call(this,t)||this).nodeType=ye.DOCUMENT_TYPE_NODE,n.nodeValue=String(r),n}return ne(t,e),t.prototype.serialize=function(){return"<"+this.nodeValue+">"},t}(Se),De=function(e){function t(){var t;return(t=e.call(this,null,"#document-fragment")||this).nodeType=ye.DOCUMENT_FRAGMENT_NODE,t.childNodes=[],t}return ne(t,e),t}(Ce),ze=function(e){function t(){var t;return(t=e.call(this,null,"#document")||this).nodeType=ye.DOCUMENT_NODE,t.childNodes=[],t}ne(t,e),re(t,[{key:"hidden",get:function(){return!0}},{key:"visibilityState",get:function(){return"prerender"}},{key:"doctype",get:function(){return this.childNodes.find((function(e){return function(e){return e.nodeType===ye.DOCUMENT_TYPE_NODE}(e)}))}},{key:"body",get:function(){return this.childNodes.find((function(e){return ve(e)&&"body"===e.nodeName}))}},{key:"head",get:function(){return this.childNodes.find((function(e){return ve(e)&&"head"===e.nodeName}))}},{key:"title",get:function(){var e=this.childNodes.find((function(e){return ve(e)&&"title"===e.nodeName}));return e?e.innerText:null},set:function(e){var t=this.childNodes.find((function(e){return ve(e)&&"title"===e.nodeName}));t&&(t.innerText=e)}},{key:"documentElement",get:function(){return this.firstElementChild}}]);var r=t.prototype;return r.createAttribute=function(){},r.createAttributeNS=function(){},r.createCDATASection=function(){},r.createComment=function(e){return new Re(null,e)},r.createDocumentFragment=function(){return new De},r.createElement=function(e){return new Ce(null,e)},r.createElementNS=function(e){return new Ce(null,e)},r.createEvent=function(){},r.createNodeIterator=function(){},r.createProcessingInstruction=function(e){return new ke(null,e)},r.createRange=function(){},r.createTextNode=function(e){return new Ae(null,e)},r.createTouchList=function(){},r.createTreeWalker=function(){},r.serialize=function(){return""+this.childNodes.map((function(e){return e.serialize()})).join("")},t}(Ce),qe=require("fs"),Be=function(e){e&&Object.assign(this,e),this.vars=Object.assign({host:"http://localhost:5000",port:5e3,charset:"utf8",template:"./index.html",cacheMode:fe.Memory,cache:"./cache/",root:"./dist/browser/"},this.vars||{})},Ue=function(e){e&&Object.assign(this,e)},$e=function(e){e&&Object.assign(this,e)},Le=function(e){function t(){return e.apply(this,arguments)||this}return ne(t,e),t.bootstrap=function(e,t){if(!c.isPlatformServer)throw new c.ModuleError("missing platform server, node process not found");if(!e)throw new c.ModuleError("missing moduleFactory");if(!e.meta)throw new c.ModuleError("missing moduleFactory meta");if(!e.meta.bootstrap)throw new c.ModuleError("missing bootstrap");if(!e.meta.bootstrap.meta)throw new c.ModuleError("missing bootstrap meta");if(!e.meta.bootstrap.meta.selector)throw new c.ModuleError("missing bootstrap meta selector");if(!t)throw new c.ModuleError("missing template");var r=this.resolveGlobals(t),n=this.resolveMeta(e);if(n.node instanceof Ce){var o,i=n.node,s=n.nodeInnerHTML,a={selector:e.meta.bootstrap.meta.selector,innerHTML:s},u=new Ce(null,"script"),l=new Ae(null,"var rxcomp_hydrate_ = "+JSON.stringify(a)+";");u.append(l),null==(o=i.parentNode)||o.insertBefore(u,i)}var h=new e;h.meta=n,n.imports.forEach((function(e){e.prototype.constructor.call(h)}));var f=h.compile(n.node,{document:r});return h.instances=f,f[0].pushChanges(),h},t.serialize=function(){if(console.log("Server.serialize"),this.document instanceof ze)return this.document.serialize();throw new c.ModuleError("document is not an instance of RxDocument")},t.resolveGlobals=function(e){var t="string"==typeof e?Ee(e):e;return this.document=t,global.document=this.document,this.document},t}(c.Platform);function Fe(e){return a.Observable.create((function(t){var r=e.vars.template;if(r){var n=ge.get("template",r);console.log("template",!!n),n&&(t.next(n),t.complete()),qe.readFile(r,e.vars.charset,(function(e,n){e?t.error(e):(ge.set("template",r,n),t.next(n),t.complete())}))}else t.error(new Error("ServerError: missing template"))}))}Le.render$=function(e,t){return a.Observable.create((function(r){var n=new Be(e);n.vars.cacheMode&&(ge.mode=n.vars.cacheMode),n.vars.cache&&(ge.folder=n.vars.cache);var o=ge.get("cached",n.url);if(console.log("cached",!!o),o)return r.next(o),r.complete();Fe(n).pipe(s.switchMap((function(e){return n.template=e,t(n)}))).subscribe((function(e){ge.set("cached",n.url,e,3600),r.next(e),r.complete()}),(function(e){r.error(e)}))}))},Le.template$=Fe,Le.bootstrap$=function(e,t){return console.log("bootstrap$",t),a.Observable.create((function(r){if(!t.template)return r.error(new Error("ServerError: missing template"));try{Le.bootstrap(e,t.template);r.next(new Ue(Object.assign({serialize:function(){return Le.serialize()}},t))),r.complete()}catch(e){r.error(new $e(Object.assign({error:e},t)))}}))},function(e){e[e.Sent=0]="Sent",e[e.UploadProgress=1]="UploadProgress",e[e.ResponseHeader=2]="ResponseHeader",e[e.DownloadProgress=3]="DownloadProgress",e[e.Response=4]="Response",e[e.User=5]="User",e[e.ResponseError=6]="ResponseError"}(xe||(xe={}));var Ie=function(){function e(t){var r=this;this.headers_=new Map;var n=this.headers_;t instanceof e?t.headers_.forEach((function(e,t){n.set(t,e)})):"function"==typeof(null==t?void 0:t.forEach)?t.forEach((function(e,t){n.set(t,e.split(", "))})):"object"==typeof t?Object.keys(t).forEach((function(e){var o=t[e];"string"==typeof o&&(o=[o]),n.has(e)?o.forEach((function(t){return r.append(e,t)})):n.set(e,o)})):"string"==typeof t&&t.split("\n").forEach((function(e){var t=e.indexOf(":");if(t>0){var o=e.slice(0,t),i=e.slice(t+1).trim();n.has(o)?r.append(o,i):n.set(o,[i])}})),n.has("Accept")||n.set("Accept",["application/json","text/plain","*/*"]),n.has("Content-Type")||n.set("Content-Type",["application/json"])}var t=e.prototype;return t.has=function(e){return this.headers_.has(e)},t.get=function(e){var t=this.headers_.get(e);return t?t.join(", "):null},t.set=function(e,t){var r=this.clone_();return r.headers_.set(e,t.split(", ")),r},t.append=function(e,t){var r=this.clone_(),n=r.headers_.has(e)&&r.headers_.get(e)||[];return n.push(t),r.headers_.set(e,n),r},t.delete=function(e){var t=this.clone_();return t.headers_.delete(e),t},t.forEach=function(e,t){var r=this;this.headers_.forEach((function(t,n){e(t.join(", "),n,r)}))},t.serialize=function(){var e=[];return this.forEach((function(t,r){e.push([r,t])})),e},t.clone_=function(){var t=new e;return this.headers_.forEach((function(e,r){t.headers_.set(r,e)})),t},e}(),Ve=function(e){function t(t){var r;return(r=e.call(this,(null==t?void 0:t.message)||"Unknown Error")||this).status=0,r.statusText="Unknown Error",r.ok=!1,r.type=xe.ResponseError,r.message="Unknown Error",r.name="HttpErrorResponse",t&&(r.headers=new Ie(t.headers),r.status=t.status||r.status,r.statusText=t.statusText||r.statusText,r.url=t.url||r.url,r.error=t.error||r.error,r.name=t.name||r.name,r.request=t.request||null),r}return ne(t,e),t.prototype.clone=function(e){var r=new t(e=Object.assign({headers:this.headers,status:this.status,statusText:this.statusText,url:this.url,error:this.error,message:this.message,name:this.name,request:this.request},e||{}));return r},t}(ue(Error)),He=function(){function e(e){this.status=200,this.statusText="OK",this.type=xe.Response,this.body=null,e&&(this.headers=new Ie(e.headers),this.status=e.status||this.status,this.statusText=e.statusText||this.statusText,this.url=e.url||this.url,this.body=e.body||this.body),this.ok=this.status>=200&&this.status<300}return e.prototype.clone=function(t){var r=new e(t=Object.assign({headers:this.headers,status:this.status,statusText:this.statusText,url:this.url,ok:this.ok,type:this.type,body:this.body},t||{}));return r},e}(),Ge=function(){function e(){this.response_=null}var t=e.prototype;return t.handle=function(e){var t=this;if(!e.method)throw new Error("missing method");var r=e.urlWithParams,n=e.toInitRequest();return a.from(fetch(r,n).then((function(r){return t.getProgress(r,e)})).then((function(r){return t.getResponse(r,e)}))).pipe(s.catchError((function(r){var n={error:r};t.response_&&(n.headers=t.response_.headers,n.status=t.response_.status,n.statusText=t.response_.statusText,n.url=t.response_.url,n.request=e);var o=new Ve(n);return c.nextError$.next(o),a.of(t.response_)})),s.finalize((function(){t.response_=null})))},t.getProgress=function(e,t){var r=this,n=e.clone().body;if(c.isPlatformBrowser&&t.reportProgress&&n){var o=n.getReader(),i=e.headers&&e.headers.has("Content-Length")?+(e.headers.get("Content-Length")||0):0;return new Promise((function(n,s){var a={progress:0,percent:0,current:0,total:0};o.read().then((function(t){return function t(r,n){var s=a.current;return n?(a.total=i,a.current=i,a.progress=1,a.percent=100,o.closed.then((function(){return e.clone()}))):(r&&(s+=r.length||0,a.total=i,a.current=s,a.progress=s/i,a.percent=100*a.progress),o.read().then((function(e){var r=e.value,n=e.done;return t(r,n)})))}(t.value,t.done)})).then((function(e){return r.response_=new He(e),"function"==typeof e[t.responseType]?e[t.responseType]().then((function(t){return r.response_=new He(Object.assign(r.response_,{body:t})),e.ok?n(r.response_):s(r.response_)})):s(r.response_)})).catch((function(e){return console.log("upload error:",e)}))}))}return Promise.resolve(e)},t.getResponse=function(e,t){return this.response_=new He(e),c.isPlatformBrowser&&t.reportProgress&&e.body?Promise.resolve(this.response_):this.getResponseType(e,t)},t.getResponseType=function(e,t){var r=this;return new Promise((function(n,o){return r.response_=new He(e),"function"==typeof e[t.responseType]?e[t.responseType]().then((function(t){return r.response_=new He(Object.assign(r.response_,{body:t})),e.ok?n(r.response_):o(r.response_)})):o(r.response_)}))},t.getReadableStream=function(e,t){var r=e.body.getReader();return new ReadableStream({start:function(e){!function t(){r.read().then((function(r){var n=r.done,o=r.value;n?e.close():(e.enqueue(o),t())}))}()}})},e}(),Je=function(){function e(e,t){this.next=e,this.interceptor=t}return e.prototype.handle=function(e){return this.interceptor.intercept(e,this.next)},e}(),Ke=[],Ye=new Ge,Xe=function(){function e(){this.chain=null}return e.prototype.handle=function(e){if(null===this.chain){var t=Ke;this.chain=t.reduceRight((function(e,t){return new Je(e,t)}),Ye)}return this.chain.handle(e)},e}(),We=function(){function e(){}var t=e.prototype;return t.encodeKey=function(e){return Qe(e)},t.encodeValue=function(e){return Qe(e)},t.decodeKey=function(e){return decodeURIComponent(e)},t.decodeValue=function(e){return decodeURIComponent(e)},e}(),Ze=function(){function e(t,r){void 0===r&&(r=new We),this.params_=new Map,this.encoder=r;var n=this.params_;t instanceof e?t.params_.forEach((function(e,t){n.set(t,e)})):"object"==typeof t?Object.keys(t).forEach((function(e){var r=t[e];n.set(e,Array.isArray(r)?r:[r])})):"string"==typeof t&&function(e,t,r){if(t.length>0){t.split("&").forEach((function(t){var n=t.indexOf("="),o=-1==n?[r.decodeKey(t),""]:[r.decodeKey(t.slice(0,n)),r.decodeValue(t.slice(n+1))],i=o[0],s=o[1],a=e.get(i)||[];a.push(s),e.set(i,a)}))}}(n,t,this.encoder)}var t=e.prototype;return t.keys=function(){return Array.from(this.params_.keys())},t.has=function(e){return this.params_.has(e)},t.get=function(e){var t=this.params_.get(e);return t?t[0]:null},t.getAll=function(e){return this.params_.get(e)||null},t.set=function(e,t){var r=this.clone_();return r.params_.set(e,[t]),r},t.append=function(e,t){var r=this.clone_();if(r.has(e)){var n=r.params_.get(e)||[];n.push(t),r.params_.set(e,n)}else r.params_.set(e,[t]);return r},t.delete=function(e){var t=this.clone_();return t.params_.delete(e),t},t.toString=function(){var e=this;return this.keys().map((function(t){var r=e.params_.get(t);return e.encoder.encodeKey(t)+(r?"="+r.map((function(t){return e.encoder.encodeValue(t)})).join("&"):"")})).filter((function(e){return""!==e})).join("&")},t.clone_=function(){var t=new e(void 0,this.encoder);return this.params_.forEach((function(e,r){t.params_.set(r,e)})),t},e}();function Qe(e){return encodeURIComponent(e).replace(/%40/gi,"@").replace(/%3A/gi,":").replace(/%24/gi,"$").replace(/%2C/gi,",").replace(/%3B/gi,";").replace(/%2B/gi,"+").replace(/%3D/gi,"=").replace(/%3F/gi,"?").replace(/%2F/gi,"/")}var et=function(){function e(e,t,r,n){this.url=t,this.reportProgress=!1,this.withCredentials=!1,this.observe="body",this.responseType="json";var o,i=/\.(json|xml|txt)(\?.*)?$/.test(t);this.method=i?"GET":e.toUpperCase(),function(e){switch(e){case"DELETE":case"GET":case"HEAD":case"OPTIONS":case"JSONP":return!1;default:return!0}}(this.method)||n?(this.body=void 0!==r?r:null,o=n):o=r,o&&(this.reportProgress=!!o.reportProgress,this.withCredentials=!!o.withCredentials,this.observe=o.observe||this.observe,o.responseType&&(this.responseType=o.responseType),o.headers&&(this.headers=new Ie(o.headers)),o.params&&(this.params=new Ze(o.params))),this.headers||(this.headers=new Ie),this.params||(this.params=new Ze);var s=this.params.toString(),a=t.indexOf("?"),u=-1===a?"?":a<t.length-1?"&":"";this.urlWithParams=t+(s.length?u+s:s)}var t=e.prototype;return t.serializeBody=function(){return null===this.body?null:tt(this.body)||rt(this.body)||nt(this.body)||"string"==typeof this.body?this.body:this.body instanceof Ze?this.body.toString():"object"==typeof this.body||"boolean"==typeof this.body||Array.isArray(this.body)?JSON.stringify(this.body):this.body.toString()},t.detectContentTypeHeader=function(){return null===this.body||nt(this.body)?null:rt(this.body)?this.body.type||null:tt(this.body)?null:"string"==typeof this.body?"text/plain":this.body instanceof Ze?"application/x-www-form-urlencoded;charset=UTF-8":"object"==typeof this.body||"number"==typeof this.body||Array.isArray(this.body)?"application/json":null},t.toInitRequest=function(){return{method:this.method,headers:this.headers.serialize(),body:this.serializeBody(),mode:"same-origin",credentials:"same-origin",cache:"default",redirect:"error"}},t.toFetchRequest__=function(){return new Request(this.urlWithParams,this.toInitRequest())},t.clone=function(t){t=Object.assign({headers:this.headers,reportProgress:this.reportProgress,params:this.params,responseType:this.responseType,withCredentials:this.withCredentials,observe:this.observe,body:this.body,url:this.url,method:this.method},t||{});var r=new e(this.method,this.url,this.body,t);return r},e}();function tt(e){return"undefined"!=typeof ArrayBuffer&&e instanceof ArrayBuffer}function rt(e){return"undefined"!=typeof Blob&&e instanceof Blob}function nt(e){return"undefined"!=typeof FormData&&e instanceof FormData}var ot=function(){function e(){}return e.incrementPendingRequest=function(){e.pendingRequests$.next(e.pendingRequests$.getValue()+1)},e.decrementPendingRequest=function(){e.pendingRequests$.next(e.pendingRequests$.getValue()-1)},e.request$=function(t,r,n){var o,i=this;if(void 0===n&&(n={}),t instanceof et)o=t;else{var u=void 0;u=n.headers instanceof Ie?n.headers:new Ie(n.headers);var c=void 0;n.params&&(c=new Ze(n.params)),o=new et(t,r,void 0!==n.body?n.body:null,{headers:u,params:c,reportProgress:n.reportProgress,responseType:n.responseType||"json",withCredentials:n.withCredentials})}e.incrementPendingRequest();var l,h=a.of(o).pipe(s.concatMap((function(e){return i.handler.handle(e)})),s.finalize((function(){return e.decrementPendingRequest()})));return t instanceof et||"events"===n.observe?h.pipe(s.catchError((function(e){return console.log("error",e),a.throwError(i.getError(e,null,o))}))):h.pipe(s.filter((function(e){return e instanceof He}))).pipe(s.map((function(e){switch(l=e,n.observe||"body"){case"body":switch(o.responseType){case"arraybuffer":if(null!==e.body&&!(e.body instanceof ArrayBuffer))throw new Error("Response is not an ArrayBuffer.");return e.body;case"blob":if(null!==e.body&&!(e.body instanceof Blob))throw new Error("Response is not a Blob.");return e.body;case"text":if(null!==e.body&&"string"!=typeof e.body)throw new Error("Response is not a string.");return e.body;case"json":default:return e.body}case"response":return e;default:throw new Error("Unreachable: unhandled observe type "+n.observe+"}")}})),s.catchError((function(e){return console.log("error",e),a.throwError(i.getError(e,l,o))})))},e.delete$=function(e,t){return void 0===t&&(t={}),this.request$("DELETE",e,t)},e.get$=function(e,t){return void 0===t&&(t={}),this.request$("GET",e,t)},e.head$=function(e,t){return void 0===t&&(t={}),this.request$("HEAD",e,t)},e.jsonp$=function(e,t){return this.request$("JSONP",e,{params:(new Ze).append(t,"JSONP_CALLBACK"),observe:"body",responseType:"json"})},e.options$=function(e,t){return void 0===t&&(t={}),this.request$("OPTIONS",e,t)},e.patch$=function(e,t,r){return void 0===r&&(r={}),this.request$("PATCH",e,it(r,t))},e.post$=function(e,t,r){return void 0===r&&(r={}),this.request$("POST",e,it(r,t))},e.put$=function(e,t,r){return void 0===r&&(r={}),this.request$("PUT",e,it(r,t))},e.getError=function(e,t,r){e.status||(e.statusCode=(null==t?void 0:t.status)||0),e.statusMessage||(e.statusMessage=(null==t?void 0:t.statusText)||"Unknown Error");var n={error:e,status:e.status,statusText:e.statusText,message:e.message,request:r};return t&&(n.headers=t.headers,n.status=n.status||t.status,n.statusText=n.statusText||t.statusText,n.url=t.url),new Ve(n)},e}();function it(e,t){return Object.assign({},e,{body:t})}ot.pendingRequests$=new a.BehaviorSubject(0),ot.handler=new Xe;var st={name:"rxcomp-server",host:"",resource:"/",api:"/api",static:!1,development:!1,production:!0},at=new(function(){function e(){}return e.prototype.intercept=function(e,t){var r=e.clone({url:e.url});return t.handle(r)},e}());Ke.push(at);var ut=function(e){function t(){var t;return(t=e.apply(this,arguments)||this).items=[],t.error=null,t}ne(t,e);var r=t.prototype;return r.onInit=function(){var e=this,t=""+st.host+st.api;console.log("methodUrl",t),ot.post$(t,{query:"{ getTodos { id, title, completed } }"}).pipe(s.first()).subscribe((function(t){e.items=t.data.getTodos,e.pushChanges()}),(function(e){return console.log})),c.errors$.pipe(s.takeUntil(this.unsubscribe$)).subscribe((function(t){e.error=t,e.pushChanges()}))},r.onClick=function(e){e.completed=!e.completed,this.pushChanges()},t}(c.Component);ut.meta={selector:"[app-component]"};var ct=function(e){function t(){return e.apply(this,arguments)||this}return ne(t,e),t}(c.Module);ct.meta={imports:[c.CoreModule],declarations:[],bootstrap:ut},e.renderRequest$=function(e){return st.host=e.vars.host,Le.bootstrap$(ct,e).pipe(s.switchMap((function(e){return ot.pendingRequests$.pipe(s.filter((function(e){return 0===e})),s.map((function(){return e.body=e.serialize(),e})),s.first())})))},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=main.min.js.map