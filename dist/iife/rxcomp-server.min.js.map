{"version":3,"sources":["src/rxcomp-server.ts","../../src/file/file.service.ts","../../src/cache/cache.service.ts","../../src/nodes/nodes.ts","../../src/location/location.ts","../../src/history/history.ts","../../src/platform/server.ts","../../src/server.module.ts"],"names":["this","rxcomp","server","exports","rxjs","operators","htmlparser2","_defineProperties","target","props","i","length","descriptor","enumerable","configurable","writable","Object","defineProperty","key","_createClass","Constructor","protoProps","staticProps","prototype","_inheritsLoose","subClass","superClass","create","constructor","__proto__","_getPrototypeOf","o","setPrototypeOf","getPrototypeOf","_setPrototypeOf","p","_isNativeReflectConstruct","Reflect","construct","sham","Proxy","Date","toString","call","e","_construct","Parent","args","Class","a","push","apply","instance","Function","bind","arguments","_wrapNativeSuper","_cache","Map","undefined","fn","indexOf","TypeError","has","get","set","Wrapper","value","_assertThisInitialized","self","ReferenceError","_arrayLikeToArray","arr","len","arr2","Array","_createForOfIteratorHelperLoose","allowArrayLike","it","Symbol","iterator","isArray","minLen","n","slice","name","from","test","_unsupportedIterableToArray","done","next","CacheMode","CacheControlType","path","require","fs","FileService","exists","pathname","existsSync","exists$","Observable","observer","access","constants","F_OK","error","complete","console","log","readFile","dirname","readFileSync","readFile$","data","writeFile","content","mkdirSync","writeFileSync","writeFile$","mkdir","recursive","unlinkFile","unlinkSync","unlinkFile$","unlink","CacheItem","options","date","maxAge","cacheControl","Public","toData","cacheItem","Serializer","encode","encodeJson","fromData","decode","decodeJson","NoStore","getTime","now","CacheService","type","filename","getPath","mode","File","Memory","keys","cache_","_cacheItem","expired","delete","has$","_this","pipe","switchMap","of","get$","_this2","map","set$","_this3","delete$","_this4","getKey","folder","toLowerCase","replace","RxNodeType","SelectorType","RxDOMStringList","_Array","_proto","contains","string","item","index","RxLocation","hash_","host_","hostname_","pathname_","port_","protocol_","search_","href_","ancestorOrigins_","_proto2","assign","url","href","reload","hash","host","hostname","port","protocol","search","location","getLocationComponents","location_","RxHistory","currentIndex_","history_","scrollRestoration","back","forward","go","delta","pushState","title","replaceState","splice","RxNode","parentNode","nodeValue","nodeType","cloneNode","deep","serialize","RxStyle","node","init","getPropertyPriority","getPropertyValue","setProperty","important","serialize_","removeProperty","attributes","style","join","_this$node$attributes","forEach","concat","matchAll","match","RxClassList","_proto3","add","_len","names","remove","_this5","_len2","toggle","force","oldClass","newClass","class","_this$node$attributes2","split","trim","RxElement","_RxNode","nodeName","_this6","ELEMENT_NODE","classList","childNodes","_proto4","append","_this7","_len3","nodesOrDOMStrings","nodeOrDomString","RxText","prepend","_this8","_len4","unshift","replaceChildren","_this9","_len5","nodes","querySelectorAll","selector","getQueries","querySelector","hasAttribute","attribute","getAttribute","setAttribute","removeAttribute","replaceChild","newChild","oldChild","removeChild","child","Error","insertBefore","newNode","referenceNode","addListener","eventName","handler","removeListener","serializeAttributes","x","_this10","k","children","count","_step","_iterator","isRxElement","TEXT_NODE","html","filter","isRxText","innerText","String","_this11","parse","_RxNode2","_this12","RxCData","_RxNode3","_this13","CDATA_SECTION_NODE","RxComment","_RxNode4","_this14","COMMENT_NODE","RxProcessingInstruction","_RxNode5","_this15","PROCESSING_INSTRUCTION_NODE","RxDocumentType","_RxNode6","_this16","DOCUMENT_TYPE_NODE","RxDocumentFragment","_RxElement","_this17","DOCUMENT_FRAGMENT_NODE","RxDocument","_RxElement2","_this18","DOCUMENT_NODE","_proto10","createAttribute","createAttributeNS","createCDATASection","createComment","createDocumentFragment","createElement","createElementNS","createEvent","createNodeIterator","createProcessingInstruction","createRange","createTextNode","createTouchList","createTreeWalker","find","isRxDocumentType","head","documentElement","body","element","firstElementChild","isRxComment","isRxDocument","doc","parser","Parser","onopentag","onclosetag","ontext","textNode","onprocessinginstruction","oncomment","oncommentend","decodeEntities","lowerCaseTags","write","end","queries","_step2","selectors","_iterator2","Id","negate","Attribute","TagName","inner","matchSelector","id","matchSelectors","reduce","query","shift","_step3","_iterator3","results","_step4","_iterator4","source","nodeElement","nodeDocumentFragment","ServerRequest","vars","charset","template","cacheMode","cache","root","ServerResponse","ServerErrorResponse","Server","_Platform","bootstrap","moduleFactory","request","isPlatformServer","ModuleError","meta","document","resolveGlobals","resolveMeta","_node$parentNode","nodeInnerHTML","rxcomp_hydrate_","innerHTML","scriptNode","scriptText","JSON","stringify","module","imports","instances","compile","pushChanges","global","history","origin","documentOrHtml","Platform","render$","iRequest","renderRequest$","fromCache$","response","template$","fromRenderRequest$","src","throwError","bootstrap$","factories","pipes","ServerModule","_Module","Module","declarations","RxQuery","RxSelector","None","_cloneNode","isRxProcessingInstruction","_querySelector","_querySelectorAll"],"mappings":"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","file":"dist/iife/rxcomp-server.min.js","sourcesContent":[null,"import { Observable, Observer } from \"rxjs\";\nconst path = require('path');\nconst fs = require('fs');\n\nexport default class FileService {\n\n\tstatic exists(pathname: string): boolean {\n\t\treturn fs.existsSync(pathname);\n\t}\n\n\tstatic exists$(pathname: string): Observable<boolean> {\n\t\treturn Observable.create((observer: Observer<boolean>) => {\n\t\t\ttry {\n\t\t\t\tfs.access(pathname, fs.constants.F_OK, (error: Error) => {\n\t\t\t\t\tconst exists: boolean = !error;\n\t\t\t\t\tobserver.next(exists);\n\t\t\t\t\tobserver.complete();\n\t\t\t\t});\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('FileService.exists$.error', error);\n\t\t\t\tobserver.next(false);\n\t\t\t\tobserver.complete();\n\t\t\t\t// observer.error(error);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic readFile(pathname: string): string | null {\n\t\tconst dirname: string = path.dirname(pathname);\n\t\tif (!fs.existsSync(dirname)) {\n\t\t\treturn null;\n\t\t}\n\t\treturn fs.readFileSync(pathname, 'utf8');\n\t}\n\n\tstatic readFile$(pathname: string): Observable<string | null> {\n\t\treturn Observable.create((observer: Observer<string | null>) => {\n\t\t\ttry {\n\t\t\t\tfs.readFile(pathname, 'utf8', (error: Error, data: string) => {\n\t\t\t\t\t// return observer.error(error);\n\t\t\t\t\tobserver.next(error ? null : data);\n\t\t\t\t\tobserver.complete();\n\t\t\t\t});\n\t\t\t\t// sync\n\t\t\t\t// observer.next(this.readFile(pathname));\n\t\t\t\t// observer.complete();\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('FileService.readFile$.error', error);\n\t\t\t\tobserver.next(null);\n\t\t\t\tobserver.complete();\n\t\t\t\t// observer.error(error);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic writeFile(pathname: string, content: string): boolean {\n\t\ttry {\n\t\t\tconst dirname: string = path.dirname(pathname);\n\t\t\tif (!fs.existsSync(dirname)) {\n\t\t\t\tfs.mkdirSync(dirname);\n\t\t\t}\n\t\t\tfs.writeFileSync(pathname, content, 'utf8');\n\t\t\treturn true;\n\t\t} catch (error) {\n\t\t\tconsole.log('FileService.writeFile.error', error);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tstatic writeFile$(pathname: string, content: string): Observable<boolean> {\n\t\treturn Observable.create((observer: Observer<boolean>) => {\n\t\t\ttry {\n\t\t\t\tconst dirname: string = path.dirname(pathname);\n\t\t\t\tfs.mkdir(dirname, { recursive: true }, (error: Error) => {\n\t\t\t\t\tif (error) {\n\t\t\t\t\t\tobserver.next(false);\n\t\t\t\t\t\tobserver.complete();\n\t\t\t\t\t\treturn;\n\t\t\t\t\t\t// return observer.error(error);\n\t\t\t\t\t}\n\t\t\t\t\tfs.writeFile(pathname, content, 'utf8', (error: Error) => {\n\t\t\t\t\t\tobserver.next(!error);\n\t\t\t\t\t\tobserver.complete();\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t\t// sync\n\t\t\t\t// this.writeFile(pathname, content);\n\t\t\t\t// observer.next(true);\n\t\t\t\t// observer.complete();\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('FileService.writeFile$.error', error);\n\t\t\t\tobserver.next(false);\n\t\t\t\tobserver.complete();\n\t\t\t\t// observer.error(error);\n\t\t\t}\n\t\t});\n\t}\n\n\tstatic unlinkFile(pathname: string): boolean {\n\t\ttry {\n\t\t\tif (fs.existsSync(pathname)) {\n\t\t\t\tfs.unlinkSync(pathname);\n\t\t\t\treturn true;\n\t\t\t} else {\n\t\t\t\treturn false;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log('FileService.unlinkFile.error', error);\n\t\t\treturn false;\n\t\t}\n\t}\n\n\tstatic unlinkFile$(pathname: string): Observable<boolean> {\n\t\treturn Observable.create((observer: Observer<boolean>) => {\n\t\t\ttry {\n\t\t\t\tfs.unlink(pathname, (error: Error) => {\n\t\t\t\t\tobserver.next(!error);\n\t\t\t\t\tobserver.complete();\n\t\t\t\t\t// return observer.error(error);\n\t\t\t\t});\n\t\t\t\t// sync\n\t\t\t\t// this.unlinkFile(pathname);\n\t\t\t\t// observer.next(true);\n\t\t\t\t// observer.complete();\n\t\t\t} catch (error) {\n\t\t\t\tconsole.log('FileService.unlinkFile$.error', error);\n\t\t\t\tobserver.next(false);\n\t\t\t\t// observer.error(error);\n\t\t\t}\n\t\t});\n\t}\n}\n","import { decodeJson, encodeJson, Serializer } from \"rxcomp\";\nimport { Observable, Observer, of } from \"rxjs\";\nimport { map, switchMap } from \"rxjs/operators\";\nimport FileService from \"../file/file.service\";\n\nexport enum CacheMode {\n\tMemory = 'memory',\n\tFile = 'file',\n}\n\nexport enum CacheControlType {\n\tPublic = 'public', // The response may be stored by any cache, even if the response is normally non-cacheable.\n\tPrivate = 'private', // The response may be stored only by a browser's cache, even if the response is normally non-cacheable. If you mean to not store the response in any cache, use no-store instead. This directive is not effective in preventing caches from storing your response.\n\tNoCache = 'no-cache', // The response may be stored by any cache, even if the response is normally non-cacheable. However, the stored response MUST always go through validation with the origin server first before using it, therefore, you cannot use no-cache in-conjunction with immutable. If you mean to not store the response in any cache, use no-store instead. This directive is not effective in preventing caches from storing your response.\n\tNoStore = 'no-store', // The response may not be stored in any cache. Although other directives may be set, this alone is the only directive you need in preventing cached responses on modern browsers. max-age=0 is already implied. Setting must-revalidate does not make sense because in order to go through revalidation you need the response to be stored in a cache, which no-store prevents.\n}\n\nexport interface ICacheItem {\n\tvalue: any;\n\tdate?: Date,\n\tmaxAge?: number;\n\tcacheControl?: CacheControlType;\n}\n\nexport class CacheItem {\n\tvalue: any;\n\tdate: Date = new Date();\n\tmaxAge: number = 0;\n\tcacheControl: CacheControlType = CacheControlType.Public;\n\tget expired(): boolean {\n\t\treturn this.cacheControl === CacheControlType.NoStore\n\t\t\t|| this.maxAge === 0\n\t\t\t|| (this.date.getTime() + (this.maxAge * 1000) < Date.now());\n\t}\n\tconstructor(options?: ICacheItem) {\n\t\tif (options) {\n\t\t\tthis.value = options.value;\n\t\t\tthis.date = options.date ? new Date(options.date) : this.date;\n\t\t\tthis.maxAge = options.maxAge || this.maxAge;\n\t\t\tthis.cacheControl = options.cacheControl || this.cacheControl;\n\t\t}\n\t}\n\tstatic toData(cacheItem: CacheItem): string | undefined {\n\t\treturn Serializer.encode(cacheItem, [encodeJson]);\n\t}\n\tstatic fromData(data: string): CacheItem {\n\t\treturn new CacheItem(Serializer.decode<ICacheItem>(data, [decodeJson]));\n\t}\n}\n\nexport default class CacheService {\n\tprivate static cache_: { [key: string]: string } = {};\n\tstatic mode: CacheMode = CacheMode.Memory;\n\tstatic folder: string;\n\n\tstatic has(type: string = 'cache', filename: string): boolean {\n\t\tlet has: boolean = false;\n\t\ttry {\n\t\t\tconst key: string = this.getPath(type, filename);\n\t\t\tswitch (this.mode) {\n\t\t\t\tcase CacheMode.File:\n\t\t\t\t\thas = FileService.exists(key);\n\t\t\t\t\t// has = this.hasFile(type, filename);\n\t\t\t\t\tbreak;\n\t\t\t\tcase CacheMode.Memory:\n\t\t\t\tdefault:\n\t\t\t\t\thas = Object.keys(this.cache_).indexOf(key) !== -1;\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log('CacheService.has.error', error);\n\t\t}\n\t\treturn has;\n\t}\n\n\tstatic get(type: string = 'cache', filename: string): any {\n\t\tlet value = null, cacheItem: CacheItem | null;\n\t\ttry {\n\t\t\tconst key: string = this.getPath(type, filename);\n\t\t\tswitch (this.mode) {\n\t\t\t\tcase CacheMode.File:\n\t\t\t\t\tif (FileService.exists(key)) {\n\t\t\t\t\t\tconst data: string | null = FileService.readFile(key);\n\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\tcacheItem = CacheItem.fromData(data);\n\t\t\t\t\t\t\tif (cacheItem.expired) {\n\t\t\t\t\t\t\t\tFileService.unlinkFile(key);\n\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\tvalue = cacheItem?.value;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase CacheMode.Memory:\n\t\t\t\tdefault:\n\t\t\t\t\tif (Object.keys(this.cache_).indexOf(key) !== -1) {\n\t\t\t\t\t\tconst data: string | undefined = this.cache_[key];\n\t\t\t\t\t\tif (data) {\n\t\t\t\t\t\t\tcacheItem = CacheItem.fromData(data);\n\t\t\t\t\t\t\tif (cacheItem) {\n\t\t\t\t\t\t\t\tif (cacheItem.expired) {\n\t\t\t\t\t\t\t\t\tdelete this.cache_[key];\n\t\t\t\t\t\t\t\t} else {\n\t\t\t\t\t\t\t\t\tvalue = cacheItem.value;\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log('CacheService.get.error', error);\n\t\t}\n\t\treturn value;\n\t}\n\n\tstatic set(type: string = 'cache', filename: string, value: any, maxAge: number = 0, cacheControl: CacheControlType = CacheControlType.Public): any {\n\t\ttry {\n\t\t\tconst key: string = this.getPath(type, filename);\n\t\t\tconst cacheItem: CacheItem = new CacheItem({ value, maxAge, cacheControl });\n\t\t\tlet data: string | undefined;\n\t\t\tswitch (this.mode) {\n\t\t\t\tcase CacheMode.File:\n\t\t\t\t\tdata = CacheItem.toData(cacheItem);\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tFileService.writeFile(key, data);\n\t\t\t\t\t}\n\t\t\t\t\tbreak;\n\t\t\t\tcase CacheMode.Memory:\n\t\t\t\tdefault:\n\t\t\t\t\tdata = CacheItem.toData(cacheItem);\n\t\t\t\t\tif (data) {\n\t\t\t\t\t\tthis.cache_[key] = data;\n\t\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log('CacheService.set.error', error);\n\t\t}\n\t\treturn value;\n\t}\n\n\tstatic delete(type: string = 'cache', filename: string): void {\n\t\ttry {\n\t\t\tconst key: string = this.getPath(type, filename);\n\t\t\tswitch (this.mode) {\n\t\t\t\tcase CacheMode.File:\n\t\t\t\t\tFileService.unlinkFile(key);\n\t\t\t\t\tbreak;\n\t\t\t\tcase CacheMode.Memory:\n\t\t\t\tdefault:\n\t\t\t\t\tif (Object.keys(this.cache_).indexOf(key) !== -1) {\n\t\t\t\t\t\tdelete this.cache_[key];\n\t\t\t\t\t}\n\t\t\t}\n\t\t} catch (error) {\n\t\t\tconsole.log('CacheService.delete.error', error);\n\t\t}\n\t}\n\n\tstatic has$(type: string = 'cache', filename: string): Observable<boolean> {\n\t\tconst key$: Observable<string> = Observable.create((observer: Observer<string>) => {\n\t\t\tconst key: string = this.getPath(type, filename);\n\t\t\tobserver.next(key);\n\t\t\tobserver.complete();\n\t\t});\n\t\treturn key$.pipe(\n\t\t\tswitchMap((key: string) => {\n\t\t\t\tif (this.mode === CacheMode.File) {\n\t\t\t\t\treturn FileService.exists$(key);\n\t\t\t\t} else {\n\t\t\t\t\treturn of(Object.keys(this.cache_).indexOf(key) !== -1);\n\t\t\t\t}\n\t\t\t})\n\t\t);\n\t}\n\n\tstatic get$<T>(type: string, filename: string): Observable<T>;\n\tstatic get$(type: string = 'cache', filename: string): Observable<any> {\n\t\tlet key: string;\n\t\tconst key$: Observable<string> = Observable.create((observer: Observer<string>) => {\n\t\t\tkey = this.getPath(type, filename);\n\t\t\tobserver.next(key);\n\t\t\tobserver.complete();\n\t\t});\n\t\treturn key$.pipe(\n\t\t\tswitchMap((key: string) => {\n\t\t\t\tif (this.mode === CacheMode.File) {\n\t\t\t\t\treturn FileService.readFile$(key);\n\t\t\t\t} else {\n\t\t\t\t\treturn of(this.cache_[key]);\n\t\t\t\t}\n\t\t\t}),\n\t\t\tswitchMap((data: string | undefined | null) => {\n\t\t\t\tconst cacheItem: CacheItem | null = data ? CacheItem.fromData(data) : null;\n\t\t\t\tif (cacheItem && cacheItem.expired) {\n\t\t\t\t\treturn FileService.unlinkFile$(key).pipe(map(() => null));\n\t\t\t\t}\n\t\t\t\treturn of(cacheItem ? cacheItem.value : null);\n\t\t\t}),\n\t\t);\n\t}\n\n\tstatic set$(type: string = 'cache', filename: string, value: any, maxAge: number = 0, cacheControl: CacheControlType = CacheControlType.Public): any {\n\t\tlet key: string, cacheItem: CacheItem, data: string | undefined;\n\t\tconst data$: Observable<string> = Observable.create((observer: Observer<string | undefined>) => {\n\t\t\tkey = this.getPath(type, filename);\n\t\t\tcacheItem = new CacheItem({ value, maxAge, cacheControl });\n\t\t\tdata = CacheItem.toData(cacheItem);\n\t\t\tobserver.next(data);\n\t\t\tobserver.complete();\n\t\t});\n\t\treturn data$.pipe(\n\t\t\tswitchMap((data: string | undefined) => {\n\t\t\t\tif (data) {\n\t\t\t\t\tif (this.mode === CacheMode.File) {\n\t\t\t\t\t\treturn FileService.writeFile$(key, data);\n\t\t\t\t\t} else {\n\t\t\t\t\t\tthis.cache_[key] = data;\n\t\t\t\t\t\treturn of(true);\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\treturn of(false);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tstatic delete$(type: string = 'cache', filename: string): Observable<boolean> {\n\t\tlet key: string;\n\t\tconst key$: Observable<string> = Observable.create((observer: Observer<string>) => {\n\t\t\tkey = this.getPath(type, filename);\n\t\t\tobserver.next(key);\n\t\t\tobserver.complete();\n\t\t});\n\t\treturn key$.pipe(\n\t\t\tswitchMap((key: string) => {\n\t\t\t\tif (this.mode === CacheMode.File) {\n\t\t\t\t\treturn FileService.unlinkFile$(key);\n\t\t\t\t} else if (Object.keys(this.cache_).indexOf(key) !== -1) {\n\t\t\t\t\tdelete this.cache_[key];\n\t\t\t\t\treturn of(true);\n\t\t\t\t} else {\n\t\t\t\t\treturn of(false);\n\t\t\t\t}\n\t\t\t}),\n\t\t);\n\t}\n\n\tprotected static getPath(type: string = 'cache', filename: string): string {\n\t\tconst key: string = this.getKey(type, filename);\n\t\treturn `${this.folder}${key}`;\n\t}\n\n\tprotected static getKey(type: string = 'cache', filename: string): string {\n\t\tlet key: string = `${type}-${filename}`.toLowerCase();\n\t\tkey = key.replace(/(\\s+)|(\\W+)/g, function (...matches) { return matches[1] ? '' : '_' });\n\t\treturn key;\n\t}\n}\n\n/*\nCache-Control: max-age=0, private, must-revalidate\nDate: Fri, 14 Aug 2020 20:09:02 GMT\nExpect-CT: max-age=2592000, report-uri=\"https://api.github.com/_private/browser/errors\"\nStatus: 200 OK\nStrict-Transport-Security: max-age=31536000; includeSubdomains; preload\nCache-Control: no-cache\nConnection: keep-alive\nPragma: no-cache\n*/\n","import { Parser } from 'htmlparser2';\nimport { ILocation, RxLocation } from '../location/location';\n\n// export const NO_CHILDS = ['title','base','meta','link','img','br','input',];\n// const SKIP = ['html','head','title','base','meta','script','link','body',];\n// document.createComment = nodeValue => { return new RxComment(null, nodeValue); };\n// document.createTextNode = nodeValue => { return new RxText(null, nodeValue); };\n\nexport enum RxNodeType {\n\tELEMENT_NODE = 1, //\tUn nodo Element come <p> o <div>.\n\tTEXT_NODE = 3, //\tL'attuale Text dentro un Element o Attr.\n\tCDATA_SECTION_NODE = 4, //\tUna CDATASection, ad esempio <!CDATA[[  ]]>.\n\tPROCESSING_INSTRUCTION_NODE = 7, //\tUna ProcessingInstruction di un documento XML, come <?xml-stylesheet  ?>.\n\tCOMMENT_NODE = 8, //\tUn nodo Comment, come <!--  -->.\n\tDOCUMENT_NODE = 9, //\tUn nodo Document.\n\tDOCUMENT_TYPE_NODE = 10, //\tUn nodo DocumentType, come <!DOCTYPE html>.\n\tDOCUMENT_FRAGMENT_NODE = 11, //\tUn nodo DocumentFragment.\n}\n\nexport enum SelectorType {\n\tNone = -1,\n\tId = 0,\n\tClass = 1,\n\tAttribute = 2,\n\tTagName = 3,\n}\n\nexport class RxSelector {\n\tselector: string = '';\n\ttype: SelectorType = SelectorType.None;\n\tnegate: boolean = false;\n\tconstructor(options: RxSelector) {\n\t\tif (options) {\n\t\t\tObject.assign(this, options);\n\t\t}\n\t}\n}\n\nexport class RxQuery {\n\tselector: string = '';\n\tselectors: RxSelector[] = [];\n\tinner: boolean = false;\n\tconstructor(options: RxQuery) {\n\t\tif (options) {\n\t\t\tObject.assign(this, options);\n\t\t}\n\t}\n}\n\nexport class RxNode {\n\tparentNode: RxElement | null;\n\tnodeType: RxNodeType;\n\tnodeValue: string | null = null;\n\n\tconstructor(parentNode: RxElement | null = null) {\n\t\tthis.parentNode = parentNode;\n\t\tthis.nodeType = -1;\n\t}\n\tcloneNode(deep: boolean = false) {\n\t\treturn cloneNode.apply(this, [this, deep]);\n\t}\n\tserialize(): string {\n\t\treturn ``;\n\t}\n}\n\nexport class RxStyle {\n\t[key: string]: any;\n\titem(index: number): string | undefined {\n\t\tconst keys = Object.keys(this);\n\t\tif (keys.length > index) {\n\t\t\treturn keys[index];\n\t\t} else {\n\t\t\treturn undefined;\n\t\t}\n\t}\n\tgetPropertyPriority(key: string): string {\n\t\tconst value = this[key];\n\t\tif (value && value.indexOf('!important')) {\n\t\t\treturn 'important';\n\t\t} else {\n\t\t\treturn '';\n\t\t}\n\t}\n\tgetPropertyValue(key: string): string {\n\t\treturn this[key];\n\t}\n\tsetProperty(key: string, value: string, important: 'important' | '' | undefined) {\n\t\tthis[key] = value + (important === 'important' ? '!important' : '');\n\t\tthis.serialize_();\n\t}\n\tremoveProperty(key: string) {\n\t\tdelete this[key];\n\t\tthis.serialize_();\n\t}\n\tprivate serialize_() {\n\t\tthis.node.attributes.style = Object.keys(this).map(key => {\n\t\t\treturn `${key}: ${this[key]};`;\n\t\t}).join(' ');\n\t}\n\tinit() {\n\t\tconst keys = Object.keys(this);\n\t\tkeys.forEach(key => delete this[key]);\n\t\tif (this.node.attributes?.style) {\n\t\t\tconst regex: RegExp = /([^:]+):([^;]+);?\\s*/gm\n\t\t\tconst matches: RegExpMatchArray[] = [...this.node.attributes.style.matchAll(regex)];\n\t\t\tmatches.forEach((match: RegExpMatchArray) => {\n\t\t\t\tconst key: string = match[1];\n\t\t\t\tconst value: string = match[2];\n\t\t\t\tthis[key] = value;\n\t\t\t});\n\t\t}\n\t}\n\tconstructor(node: RxElement) {\n\t\tObject.defineProperty(this, 'node', {\n\t\t\tvalue: node,\n\t\t\twritable: false,\n\t\t\tenumerable: false\n\t\t});\n\t\tthis.init();\n\t}\n}\n\nexport class RxClassList extends Array<string> {\n\tnode: RxElement;\n\titem(index: number) {\n\t\treturn this[index];\n\t}\n\tcontains(name: string): boolean {\n\t\treturn this.indexOf(name) !== -1;\n\t}\n\tadd(...names: string[]) {\n\t\tnames.forEach(name => {\n\t\t\tif (this.indexOf(name) !== -1) {\n\t\t\t\tthis.push(name);\n\t\t\t}\n\t\t});\n\t\tthis.serialize_();\n\t}\n\tremove(...names: string[]) {\n\t\tnames.forEach(name => {\n\t\t\tconst index: number = this.indexOf(name);\n\t\t\tif (index !== -1) {\n\t\t\t\tthis.splice(index, 1);\n\t\t\t}\n\t\t});\n\t\tthis.serialize_();\n\t}\n\ttoggle(name: string, force?: boolean): boolean {\n\t\tconst index: number = this.indexOf(name);\n\t\tif (force === false) {\n\t\t\tthis.splice(index, 1);\n\t\t\tthis.serialize_();\n\t\t\treturn false;\n\t\t} else if (force === true) {\n\t\t\tthis.push(name);\n\t\t\tthis.serialize_();\n\t\t\treturn true;\n\t\t} else if (index !== -1) {\n\t\t\tthis.splice(index, 1);\n\t\t\tthis.serialize_();\n\t\t\treturn false;\n\t\t} else {\n\t\t\tthis.push(name);\n\t\t\tthis.serialize_();\n\t\t\treturn true;\n\t\t}\n\t}\n\treplace(oldClass: string, newClass: string) {\n\t\tconst index: number = this.indexOf(oldClass);\n\t\tif (index !== -1) {\n\t\t\tthis.splice(index, 1);\n\t\t}\n\t\tthis.push(newClass);\n\t\tthis.serialize_();\n\t}\n\tprivate serialize_() {\n\t\tthis.node.attributes.class = this.join(' ');\n\t}\n\tinit() {\n\t\tthis.length = 0;\n\t\tif (this.node.attributes?.class) {\n\t\t\tArray.prototype.push.apply(this, this.node.attributes.class.split(' ').map(name => name.trim()));\n\t\t}\n\t}\n\tconstructor(node: RxElement) {\n\t\tsuper();\n\t\tthis.node = node;\n\t\tthis.init();\n\t}\n}\n\nexport class RxElement extends RxNode {\n\tnodeName: string;\n\tchildNodes: RxNode[];\n\tattributes: { [key: string]: string | null } = {};\n\tstyle: RxStyle;\n\tclassList: RxClassList;\n\tget children(): RxElement[] {\n\t\tlet children: RxElement[] = [],\n\t\t\ti = 0,\n\t\t\tnode,\n\t\t\tnodes = this.childNodes;\n\t\tnode = nodes[i++];\n\t\twhile (node) {\n\t\t\tnode = nodes[i++];\n\t\t\tif (node.nodeType === RxNodeType.ELEMENT_NODE) {\n\t\t\t\tchildren.push(node as RxElement);\n\t\t\t}\n\t\t}\n\t\treturn children;\n\t}\n\tget childElementCount(): number {\n\t\tlet i = 0,\n\t\t\tcount = 0,\n\t\t\tnode,\n\t\t\tnodes = this.childNodes;\n\t\tnode = nodes[i++];\n\t\twhile (node) {\n\t\t\tif (node.nodeType === RxNodeType.ELEMENT_NODE) {\n\t\t\t\tcount++;\n\t\t\t}\n\t\t\tnode = nodes[i++];\n\t\t}\n\t\treturn count;\n\t}\n\tget firstChild(): RxNode | null {\n\t\tlet node = null;\n\t\tif (this.childNodes.length) {\n\t\t\tnode = this.childNodes[0];\n\t\t}\n\t\treturn node;\n\t}\n\tget firstElementChild(): RxElement | null {\n\t\tfor (let node of this.childNodes) {\n\t\t\tif (isRxElement(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tget lastChild(): RxNode | null {\n\t\tlet node = null;\n\t\tif (this.childNodes.length) {\n\t\t\tnode = this.childNodes[this.childNodes.length - 1];\n\t\t}\n\t\treturn node;\n\t}\n\tget lastElementChild(): RxElement | null {\n\t\tconst nodes = this.childNodes;\n\t\tfor (let i = nodes.length - 1; i > -1; i--) {\n\t\t\tconst node = nodes[i];\n\t\t\tif (isRxElement(node)) {\n\t\t\t\treturn node;\n\t\t\t}\n\t\t}\n\t\treturn null;\n\t}\n\tget previousSibling(): RxNode | null {\n\t\tlet node = null;\n\t\tif (this.parentNode) {\n\t\t\tconst index = this.parentNode.childNodes.indexOf(this);\n\t\t\tif (index > 0) {\n\t\t\t\tnode = this.parentNode.childNodes[index - 1];\n\t\t\t}\n\t\t}\n\t\treturn node;\n\t}\n\tget nextSibling(): RxNode | null {\n\t\tlet node = null;\n\t\tif (this.parentNode) {\n\t\t\tconst index = this.parentNode.childNodes.indexOf(this);\n\t\t\tif (index !== -1 && index < this.parentNode.childNodes.length - 1) {\n\t\t\t\tnode = this.parentNode.childNodes[index];\n\t\t\t}\n\t\t}\n\t\treturn node;\n\t}\n\tget wholeText() {\n\t\tlet nodeValue;\n\t\tif (this.nodeType === RxNodeType.TEXT_NODE) {\n\t\t\treturn this.nodeValue;\n\t\t}\n\t\treturn nodeValue;\n\t}\n\tget outerHTML(): string | null {\n\t\tlet html = null;\n\t\tif (this.parentNode) {\n\t\t\thtml = this.parentNode.serialize();\n\t\t}\n\t\treturn html;\n\t}\n\tset innerText(nodeValue: string | null) {\n\t\tthis.childNodes = [new RxText(this, nodeValue)];\n\t}\n\tget innerText(): string | null {\n\t\t// return this.childNodes.filter((n): n is RxText => isRxText(n)).map(n => n.innerText).join('');\n\t\treturn this.childNodes.filter((n): n is RxText | RxElement => isRxText(n) || isRxElement(n)).map(n => n.innerText).join('');\n\t}\n\tset textContent(nodeValue: string | null) {\n\t\tthis.innerText = String(nodeValue);\n\t}\n\tget textContent(): string | null {\n\t\treturn this.innerText;\n\t}\n\tget innerHTML(): string {\n\t\treturn this.childNodes.map(x => x.serialize()).join('');\n\t}\n\tset innerHTML(html: string) {\n\t\tconst doc = parse(html);\n\t\tconst childNodes = doc.childNodes.map(n => {\n\t\t\tn.parentNode = this;\n\t\t\treturn n;\n\t\t});\n\t\tthis.childNodes = childNodes;\n\t}\n\tconstructor(parentNode: RxElement | null = null, nodeName: string, attributes: { [key: string]: string | null } | null = null) {\n\t\tsuper(parentNode);\n\t\tthis.nodeType = RxNodeType.ELEMENT_NODE;\n\t\tthis.nodeName = nodeName;\n\t\tif (attributes && typeof attributes === 'object') {\n\t\t\tthis.attributes = attributes;\n\t\t}\n\t\tthis.style = new RxStyle(this);\n\t\tthis.classList = new RxClassList(this);\n\t\tthis.childNodes = [];\n\t\t/*\n\t\t\tif (SKIP.indexOf(nodeName) === -1) {\n\t\t\t\tconsole.log(parentNode.nodeName, '>', nodeName);\n\t\t}\n\t\t*/\n\t}\n\tappend(...nodesOrDOMStrings: (RxNode | string)[]) {\n\t\tnodesOrDOMStrings = nodesOrDOMStrings.map(nodeOrDomString => {\n\t\t\tlet node;\n\t\t\tif (typeof nodeOrDomString === 'string') {\n\t\t\t\tnode = new RxText(this, nodeOrDomString);\n\t\t\t} else {\n\t\t\t\tnode = nodeOrDomString;\n\t\t\t\tnode.parentNode = this;\n\t\t\t}\n\t\t\treturn node;\n\t\t});\n\t\tArray.prototype.push.apply(this.childNodes, nodesOrDOMStrings);\n\t\t/*\n\t\tfor (let nodeOrDomString of nodesOrDOMStrings) {\n\t\t\t\tlet node;\n\t\t\t\tif (typeof nodeOrDomString === 'string') {\n\t\t\t\t\tnode = new RxText(this, nodeOrDomString);\n\t\t\t\t} else {\n\t\t\t\t\tnode = nodeOrDomString;\n\t\t\t\t}\n\t\t\t\tthis.childNodes.push(node);\n\t\t}\n\t\t*/\n\t}\n\tprepend(...nodesOrDOMStrings: (RxNode | string)[]) {\n\t\tnodesOrDOMStrings = nodesOrDOMStrings.map(nodeOrDomString => {\n\t\t\tlet node;\n\t\t\tif (typeof nodeOrDomString === 'string') {\n\t\t\t\tnode = new RxText(this, nodeOrDomString);\n\t\t\t} else {\n\t\t\t\tnode = nodeOrDomString;\n\t\t\t\tnode.parentNode = this;\n\t\t\t}\n\t\t\treturn node;\n\t\t});\n\t\tArray.prototype.unshift.apply(this.childNodes, nodesOrDOMStrings);\n\t\t/*\n\t\t\tfor (let nodeOrDomString of nodesOrDOMStrings) {\n\t\t\t\tlet node;\n\t\t\t\tif (typeof nodeOrDomString === 'string') {\n\t\t\t\t\tnode = new RxText(this, nodeOrDomString);\n\t\t\t\t} else {\n\t\t\t\t\tnode = nodeOrDomString;\n\t\t\t\t}\n\t\t\t\tthis.childNodes.unshift(node);\n\t\t}\n\t\t*/\n\t}\n\treplaceChildren(...nodesOrDOMStrings: (RxNode | string)[]) {\n\t\tconst nodes: RxNode[] = nodesOrDOMStrings.map((nodeOrDomString) => {\n\t\t\tlet node: RxNode;\n\t\t\tif (typeof nodeOrDomString === 'string') {\n\t\t\t\tnode = new RxText(this, nodeOrDomString);\n\t\t\t} else {\n\t\t\t\tnode = nodeOrDomString as RxNode;\n\t\t\t\tnode.parentNode = this;\n\t\t\t}\n\t\t\treturn node;\n\t\t});\n\t\tthis.childNodes = nodes;\n\t}\n\tquerySelectorAll(selector: string): RxNode[] | null {\n\t\tconst queries = getQueries(selector);\n\t\tconst nodes = querySelectorAll(queries, this.childNodes);\n\t\treturn (nodes && nodes.length) ? nodes : null;\n\t}\n\tquerySelector(selector: string): RxNode | null {\n\t\tconst queries = getQueries(selector);\n\t\tconst node = querySelector(queries, this.childNodes);\n\t\treturn node;\n\t}\n\thasAttribute(attribute: string): boolean {\n\t\treturn Object.keys(this.attributes).indexOf(attribute.toLowerCase()) !== -1;\n\t}\n\tgetAttribute(attribute: string): string | null {\n\t\treturn this.attributes[attribute.toLowerCase()] || null;\n\t}\n\tsetAttribute(attribute: string, value: any) {\n\t\tthis.attributes[attribute.toLowerCase()] = value.toString();\n\t\tif (attribute === 'style') {\n\t\t\tthis.style.init();\n\t\t} else if (attribute === 'class') {\n\t\t\tthis.classList.init();\n\t\t}\n\t}\n\tremoveAttribute(attribute: string) {\n\t\tdelete this.attributes[attribute];\n\t\tif (attribute === 'style') {\n\t\t\tthis.style.init();\n\t\t} else if (attribute === 'class') {\n\t\t\tthis.classList.init();\n\t\t}\n\t}\n\treplaceChild(newChild: RxNode, oldChild: RxNode): RxNode {\n\t\tconst index = this.childNodes.indexOf(oldChild);\n\t\tif (index !== -1) {\n\t\t\tthis.childNodes[index] = newChild;\n\t\t\tnewChild.parentNode = this;\n\t\t}\n\t\t// console.log('replaceChild', this, newChild, oldChild);\n\t\treturn oldChild;\n\t}\n\tremoveChild(child: RxNode): RxNode {\n\t\tif (!(child instanceof RxNode)) {\n\t\t\tthrow new Error(`Uncaught TypeError: Failed to execute 'removeChild' on 'Node': parameter 1 is not of type 'Node'.`);\n\t\t}\n\t\tconst index = this.childNodes.indexOf(child);\n\t\tif (index === -1) {\n\t\t\tthrow new Error(`Uncaught NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.`);\n\t\t}\n\t\tthis.childNodes.splice(index, 1);\n\t\t// console.log('removeChild', this.childNodes.length);\n\t\treturn child;\n\t}\n\tinsertBefore(newNode: RxNode, referenceNode: RxNode | null = null): RxNode {\n\t\tconst index = referenceNode\n\t\t\t? this.childNodes.indexOf(referenceNode)\n\t\t\t: this.childNodes.length;\n\t\tif (index !== -1) {\n\t\t\tthis.childNodes.splice(index, 0, newNode);\n\t\t\tnewNode.parentNode = this;\n\t\t}\n\t\t// console.log('insertBefore', this, newNode, referenceNode);\n\t\treturn newNode;\n\t}\n\tcloneNode(deep: boolean = false): RxNode {\n\t\treturn cloneNode.apply(this, [this, deep]);\n\t}\n\taddListener(eventName: string, handler: (e: any) => {}) { }\n\tremoveListener(eventName: string, handler: (e: any) => {}) { }\n\tserialize(): string {\n\t\treturn `<${\n\t\t\tthis.nodeName\n\t\t\t}${this.serializeAttributes()}>${this.childNodes\n\t\t\t\t.map(x => x.serialize())\n\t\t\t\t.join('')}</${this.nodeName}>`;\n\t}\n\tserializeAttributes(): string {\n\t\tlet attributes = '';\n\t\tconst keys = Object.keys(this.attributes);\n\t\tif (keys.length) {\n\t\t\tattributes =\n\t\t\t\t' ' +\n\t\t\t\tkeys\n\t\t\t\t\t.map(k => {\n\t\t\t\t\t\treturn `${k}=\"${this.attributes[k]}\"`;\n\t\t\t\t\t})\n\t\t\t\t\t.join(' ');\n\t\t}\n\t\treturn attributes;\n\t}\n}\n\nexport class RxText extends RxNode {\n\tnodeValue: string;\n\tget outerHTML(): string | null {\n\t\tlet html = null;\n\t\tif (this.parentNode) {\n\t\t\thtml = this.parentNode.serialize();\n\t\t}\n\t\treturn html;\n\t}\n\tget wholeText(): string | null {\n\t\treturn this.nodeValue;\n\t}\n\tset innerText(nodeValue) {\n\t\tthis.nodeValue = String(nodeValue);\n\t}\n\tget innerText(): string | null {\n\t\treturn this.nodeValue;\n\t}\n\tset textContent(nodeValue) {\n\t\tthis.nodeValue = String(nodeValue);\n\t}\n\tget textContent(): string | null {\n\t\treturn this.nodeValue;\n\t}\n\tconstructor(parentNode: RxElement | null = null, nodeValue: any) {\n\t\tsuper(parentNode);\n\t\tthis.nodeType = RxNodeType.TEXT_NODE;\n\t\tthis.nodeValue = String(nodeValue);\n\t\t// console.log('RxText', nodeValue);\n\t}\n\tserialize(): string {\n\t\treturn this.nodeValue;\n\t}\n}\n\nexport class RxCData extends RxNode {\n\tnodeValue: string;\n\tget outerHTML(): string | null {\n\t\tlet html = null;\n\t\tif (this.parentNode) {\n\t\t\thtml = this.parentNode.serialize();\n\t\t}\n\t\treturn html;\n\t}\n\tget wholeText(): string | null {\n\t\treturn this.nodeValue;\n\t}\n\tset innerText(nodeValue) {\n\t\tthis.nodeValue = String(nodeValue);\n\t}\n\tget innerText(): string | null {\n\t\treturn this.nodeValue;\n\t}\n\tset textContent(nodeValue) {\n\t\tthis.nodeValue = String(nodeValue);\n\t}\n\tget textContent(): string | null {\n\t\treturn this.nodeValue;\n\t}\n\tconstructor(parentNode: RxElement | null = null, nodeValue: any) {\n\t\tsuper(parentNode);\n\t\tthis.nodeType = RxNodeType.CDATA_SECTION_NODE;\n\t\tthis.nodeValue = String(nodeValue);\n\t}\n\tserialize(): string {\n\t\treturn this.nodeValue;\n\t}\n}\n\nexport class RxComment extends RxNode {\n\tnodeValue: string;\n\tget outerHTML(): string | null {\n\t\tlet html = null;\n\t\tif (this.parentNode) {\n\t\t\thtml = this.parentNode.serialize();\n\t\t}\n\t\treturn html;\n\t}\n\tget wholeText(): string | null {\n\t\treturn this.nodeValue;\n\t}\n\tset innerText(nodeValue) {\n\t\tthis.nodeValue = String(nodeValue);\n\t}\n\tget innerText(): string | null {\n\t\treturn this.nodeValue;\n\t}\n\tset textContent(nodeValue) {\n\t\tthis.nodeValue = String(nodeValue);\n\t}\n\tget textContent(): string | null {\n\t\treturn this.nodeValue;\n\t}\n\tconstructor(parentNode: RxElement | null = null, nodeValue: any) {\n\t\tsuper(parentNode);\n\t\tthis.nodeType = RxNodeType.COMMENT_NODE;\n\t\tthis.nodeValue = String(nodeValue);\n\t}\n\tserialize(): string {\n\t\treturn `<!--${this.nodeValue}-->`;\n\t}\n}\n\nexport class RxProcessingInstruction extends RxNode {\n\tconstructor(parentNode: RxElement | null = null, nodeValue: any) {\n\t\tsuper(parentNode);\n\t\tthis.nodeType = RxNodeType.PROCESSING_INSTRUCTION_NODE;\n\t\tthis.nodeValue = String(nodeValue);\n\t}\n\tserialize(): string {\n\t\treturn `<${this.nodeValue}>`;\n\t}\n}\n\nexport class RxDocumentType extends RxNode {\n\tconstructor(parentNode: RxElement | null = null, nodeValue: any) {\n\t\tsuper(parentNode);\n\t\tthis.nodeType = RxNodeType.DOCUMENT_TYPE_NODE;\n\t\tthis.nodeValue = String(nodeValue);\n\t}\n\tserialize(): string {\n\t\treturn `<${this.nodeValue}>`;\n\t}\n}\n\nexport class RxDocumentFragment extends RxElement {\n\tconstructor() {\n\t\tsuper(null, '#document-fragment');\n\t\tthis.nodeType = RxNodeType.DOCUMENT_FRAGMENT_NODE;\n\t\tthis.childNodes = [];\n\t}\n}\n\n// !!! TODO\n// Any web page loaded in the browser and serves as an entry point into the web page's content, which is the DOM tree.//\n// interface Document extends Node, DocumentAndElementEventHandlers, DocumentOrShadowRoot, GlobalEventHandlers, NonElementParentNode, ParentNode, XPathEvaluatorBase {\nexport interface IDocument extends Document {\n\t/*\n\treadonly URL: string; // Sets or gets the URL for the current document.\n\treadonly characterSet: string; // Returns document's encoding.\n\treadonly charset: string; // Gets or sets the character set used to encode the object.\n\treadonly compatMode: string; // Gets a value that indicates whether standards-compliant mode is switched on for the object.\n\treadonly contentType: string; // Returns document's content type.\n\treadonly currentScript: HTMLOrSVGScriptElement | null; // Returns the script element, or the SVG script element, that is currently executing, as long as the element represents a classic script. In the case of reentrant script execution, returns the one that most recently started executing amongst those that have not yet finished executing.\n\treadonly defaultView: (WindowProxy & typeof globalThis) | null; // Returns null if the Document is not currently executing a script or SVG script element (e.g., because the running script is an event handler, or a timeout), or if the currently executing script or SVG script element represents a module script.\n\treadonly doctype: DocumentType | null; // Gets an object representing the document type declaration associated with the current document.\n\treadonly documentElement: HTMLElement; // Gets a reference to the root node of the document.\n\treadonly documentURI: string; // Returns document's URL.\n\treadonly embeds: HTMLCollectionOf<HTMLEmbedElement>; // Retrieves a collection of all embed objects in the document.\n\treadonly forms: HTMLCollectionOf<HTMLFormElement>; // Retrieves a collection, in source order, of all form objects in the document.\n\treadonly fullscreenEnabled: boolean; // Returns true if document has the ability to display elements fullscreen and fullscreen is supported, or false otherwise.\n\treadonly head: HTMLHeadElement; // Returns the head element.\n\treadonly hidden: boolean;\n\treadonly images: HTMLCollectionOf<HTMLImageElement>; // Retrieves a collection, in source order, of img objects in the document.\n\treadonly implementation: DOMImplementation; // Gets the implementation object of the current document.\n\treadonly inputEncoding: string; // Returns the character encoding used to create the webpage that is loaded into the document object.\n\treadonly lastModified: string; // Gets the date that the page was last modified, if the page supplies one.\n\treadonly links: HTMLCollectionOf<HTMLAnchorElement | HTMLAreaElement>; // Retrieves a collection of all a objects that specify the href property and all area objects in the document.\n\treadonly origin: string; // Returns document's origin.\n\treadonly ownerDocument: null;\n\treadonly plugins: HTMLCollectionOf<HTMLEmbedElement>; // Return an HTMLCollection of the embed elements in the Document.\n\treadonly readyState: DocumentReadyState; // Retrieves a value that indicates the current state of the object.\n\treadonly referrer: string; // Gets the URL of the location that referred the user to the current page.\n\treadonly scripts: HTMLCollectionOf<HTMLScriptElement>; // Retrieves a collection of all script objects in the document.\n\treadonly scrollingElement: Element | null;\n\treadonly timeline: DocumentTimeline;\n\treadonly visibilityState: VisibilityState;\n\tbody: HTMLElement; // Specifies the beginning and end of the document body.\n\tcookie: string; // Returns the HTTP cookies that apply to the Document. If there are no cookies or cookies can't be applied to this resource, the empty string will be returned.\n\t// Can be set, to add a new cookie to the element's set of HTTP cookies.\n\t// If the contents are sandboxed into a unique origin (e.g. in an iframe with the sandbox attribute), a \"SecurityError\" DOMException will be thrown on getting and setting.\n\tdesignMode: string; // Sets or gets a value that indicates whether the document can be edited.\n\tdir: string; // Sets or retrieves a value that indicates the reading order of the object.\n\tdomain: string; // Sets or gets the security domain of the document.\n\tlocation: Location; // Contains information about the current URL.\n\ttitle: string; // Contains the title of the document.\n\t// METHODS\n\tonfullscreenchange: ((this: Document, ev: Event) => any) | null;\n\tonfullscreenerror: ((this: Document, ev: Event) => any) | null;\n\tonpointerlockchange: ((this: Document, ev: Event) => any) | null;\n\tonpointerlockerror: ((this: Document, ev: Event) => any) | null;\n\tonreadystatechange: ((this: Document, ev: Event) => any) | null; // Fires when the state of the object has changed.\n\t// @param ev The event\n\tonvisibilitychange: ((this: Document, ev: Event) => any) | null;\n\tadoptNode<T extends Node>(source: T): T; // Moves node from another document and returns it.\n\t// If node is a document, throws a \"NotSupportedError\" DOMException or, if node is a shadow root, throws a \"HierarchyRequestError\" DOMException.\n\tcaretPositionFromPoint(x: number, y: number): CaretPosition | null;\n\tclose(): void; // Closes an output stream and forces the sent data to display.\n\tcreateAttribute(localName: string): Attr; // Creates an attribute object with a specified name.\n\t// @param name String that sets the attribute object's name.\n\tcreateAttributeNS(namespace: string | null, qualifiedName: string): Attr;\n\tcreateCDATASection(data: string): CDATASection; // Returns a CDATASection node whose data is data.\n\tcreateComment(data: string): Comment; // Creates a comment object with the specified data.\n\t// @param data Sets the comment object's data.\n\tcreateDocumentFragment(): DocumentFragment; // Creates a new document.\n\tcreateElement<K extends keyof HTMLElementTagNameMap>(tagName: K, options?: ElementCreationOptions): HTMLElementTagNameMap[K]; // Creates an instance of the element for the specified tag.\n\t// @param tagName The name of an element.\n\t// @deprecated\n\t// createElement<K extends keyof HTMLElementDeprecatedTagNameMap>(tagName: K, options?: ElementCreationOptions): HTMLElementDeprecatedTagNameMap[K];\n\tcreateElement(tagName: string, options?: ElementCreationOptions): HTMLElement;\n\tcreateElementNS(namespaceURI: 'http://www.w3.org/1999/xhtml', qualifiedName: string): HTMLElement;\n\tcreateElementNS<K extends keyof SVGElementTagNameMap>(namespaceURI: 'http://www.w3.org/2000/svg', qualifiedName: K): SVGElementTagNameMap[K];\n\tcreateElementNS(namespaceURI: 'http://www.w3.org/2000/svg', qualifiedName: string): SVGElement;\n\tcreateElementNS(namespaceURI: string | null, qualifiedName: string, options?: ElementCreationOptions): Element;\n\tcreateElementNS(namespace: string | null, qualifiedName: string, options?: string | ElementCreationOptions): Element; // Returns an element with namespace namespace. Its namespace prefix will be everything before \":\" (U+003E) in qualifiedName or null. Its local name will be everything after \":\" (U+003E) in qualifiedName or qualifiedName.\n\t// If localName does not match the Name production an 'InvalidCharacterError' DOMException will be thrown.\n\t// If one of the following conditions is true a 'NamespaceError' DOMException will be thrown:\n\t// localName does not match the QName production.\n\t// Namespace prefix is not null and namespace is the empty string.\n\t// Namespace prefix is 'xml' and namespace is not the XML namespace.\n\t// qualifiedName or namespace prefix is 'xmlns' and namespace is not the XMLNS namespace.\n\t// namespace is the XMLNS namespace and neither qualifiedName nor namespace prefix is 'xmlns'.\n\t// When supplied, options's is can be used to create a customized built-in element.\n\tcreateEvent(eventInterface: 'AnimationEvent'): AnimationEvent;\n\tcreateEvent(eventInterface: 'AnimationPlaybackEvent'): AnimationPlaybackEvent;\n\tcreateEvent(eventInterface: 'AudioProcessingEvent'): AudioProcessingEvent;\n\tcreateEvent(eventInterface: 'BeforeUnloadEvent'): BeforeUnloadEvent;\n\tcreateEvent(eventInterface: 'ClipboardEvent'): ClipboardEvent;\n\tcreateEvent(eventInterface: 'CloseEvent'): CloseEvent;\n\tcreateEvent(eventInterface: 'CompositionEvent'): CompositionEvent;\n\tcreateEvent(eventInterface: 'CustomEvent'): CustomEvent;\n\tcreateEvent(eventInterface: 'DeviceLightEvent'): DeviceLightEvent;\n\tcreateEvent(eventInterface: 'DeviceMotionEvent'): DeviceMotionEvent;\n\tcreateEvent(eventInterface: 'DeviceOrientationEvent'): DeviceOrientationEvent;\n\tcreateEvent(eventInterface: 'DragEvent'): DragEvent;\n\tcreateEvent(eventInterface: 'ErrorEvent'): ErrorEvent;\n\tcreateEvent(eventInterface: 'Event'): Event;\n\tcreateEvent(eventInterface: 'Events'): Event;\n\tcreateEvent(eventInterface: 'FocusEvent'): FocusEvent;\n\tcreateEvent(eventInterface: 'FocusNavigationEvent'): FocusNavigationEvent;\n\tcreateEvent(eventInterface: 'GamepadEvent'): GamepadEvent;\n\tcreateEvent(eventInterface: 'HashChangeEvent'): HashChangeEvent;\n\tcreateEvent(eventInterface: 'IDBVersionChangeEvent'): IDBVersionChangeEvent;\n\tcreateEvent(eventInterface: 'InputEvent'): InputEvent;\n\tcreateEvent(eventInterface: 'KeyboardEvent'): KeyboardEvent;\n\tcreateEvent(eventInterface: 'ListeningStateChangedEvent'): ListeningStateChangedEvent;\n\tcreateEvent(eventInterface: 'MSGestureEvent'): MSGestureEvent;\n\tcreateEvent(eventInterface: 'MSMediaKeyMessageEvent'): MSMediaKeyMessageEvent;\n\tcreateEvent(eventInterface: 'MSMediaKeyNeededEvent'): MSMediaKeyNeededEvent;\n\tcreateEvent(eventInterface: 'MSPointerEvent'): MSPointerEvent;\n\tcreateEvent(eventInterface: 'MediaEncryptedEvent'): MediaEncryptedEvent;\n\tcreateEvent(eventInterface: 'MediaKeyMessageEvent'): MediaKeyMessageEvent;\n\tcreateEvent(eventInterface: 'MediaQueryListEvent'): MediaQueryListEvent;\n\tcreateEvent(eventInterface: 'MediaStreamErrorEvent'): MediaStreamErrorEvent;\n\tcreateEvent(eventInterface: 'MediaStreamEvent'): MediaStreamEvent;\n\tcreateEvent(eventInterface: 'MediaStreamTrackEvent'): MediaStreamTrackEvent;\n\tcreateEvent(eventInterface: 'MessageEvent'): MessageEvent;\n\tcreateEvent(eventInterface: 'MouseEvent'): MouseEvent;\n\tcreateEvent(eventInterface: 'MouseEvents'): MouseEvent;\n\tcreateEvent(eventInterface: 'MutationEvent'): MutationEvent;\n\tcreateEvent(eventInterface: 'MutationEvents'): MutationEvent;\n\tcreateEvent(eventInterface: 'OfflineAudioCompletionEvent'): OfflineAudioCompletionEvent;\n\tcreateEvent(eventInterface: 'OverflowEvent'): OverflowEvent;\n\tcreateEvent(eventInterface: 'PageTransitionEvent'): PageTransitionEvent;\n\tcreateEvent(eventInterface: 'PaymentRequestUpdateEvent'): PaymentRequestUpdateEvent;\n\tcreateEvent(eventInterface: 'PermissionRequestedEvent'): PermissionRequestedEvent;\n\tcreateEvent(eventInterface: 'PointerEvent'): PointerEvent;\n\tcreateEvent(eventInterface: 'PopStateEvent'): PopStateEvent;\n\tcreateEvent(eventInterface: 'ProgressEvent'): ProgressEvent;\n\tcreateEvent(eventInterface: 'PromiseRejectionEvent'): PromiseRejectionEvent;\n\tcreateEvent(eventInterface: 'RTCDTMFToneChangeEvent'): RTCDTMFToneChangeEvent;\n\tcreateEvent(eventInterface: 'RTCDataChannelEvent'): RTCDataChannelEvent;\n\tcreateEvent(eventInterface: 'RTCDtlsTransportStateChangedEvent'): RTCDtlsTransportStateChangedEvent;\n\tcreateEvent(eventInterface: 'RTCErrorEvent'): RTCErrorEvent;\n\tcreateEvent(eventInterface: 'RTCIceCandidatePairChangedEvent'): RTCIceCandidatePairChangedEvent;\n\tcreateEvent(eventInterface: 'RTCIceGathererEvent'): RTCIceGathererEvent;\n\tcreateEvent(eventInterface: 'RTCIceTransportStateChangedEvent'): RTCIceTransportStateChangedEvent;\n\tcreateEvent(eventInterface: 'RTCPeerConnectionIceErrorEvent'): RTCPeerConnectionIceErrorEvent;\n\tcreateEvent(eventInterface: 'RTCPeerConnectionIceEvent'): RTCPeerConnectionIceEvent;\n\tcreateEvent(eventInterface: 'RTCSsrcConflictEvent'): RTCSsrcConflictEvent;\n\tcreateEvent(eventInterface: 'RTCStatsEvent'): RTCStatsEvent;\n\tcreateEvent(eventInterface: 'RTCTrackEvent'): RTCTrackEvent;\n\tcreateEvent(eventInterface: 'SVGZoomEvent'): SVGZoomEvent;\n\tcreateEvent(eventInterface: 'SVGZoomEvents'): SVGZoomEvent;\n\tcreateEvent(eventInterface: 'SecurityPolicyViolationEvent'): SecurityPolicyViolationEvent;\n\tcreateEvent(eventInterface: 'ServiceWorkerMessageEvent'): ServiceWorkerMessageEvent;\n\tcreateEvent(eventInterface: 'SpeechRecognitionEvent'): SpeechRecognitionEvent;\n\tcreateEvent(eventInterface: 'SpeechSynthesisErrorEvent'): SpeechSynthesisErrorEvent;\n\tcreateEvent(eventInterface: 'SpeechSynthesisEvent'): SpeechSynthesisEvent;\n\tcreateEvent(eventInterface: 'StorageEvent'): StorageEvent;\n\tcreateEvent(eventInterface: 'TextEvent'): TextEvent;\n\tcreateEvent(eventInterface: 'TouchEvent'): TouchEvent;\n\tcreateEvent(eventInterface: 'TrackEvent'): TrackEvent;\n\tcreateEvent(eventInterface: 'TransitionEvent'): TransitionEvent;\n\tcreateEvent(eventInterface: 'UIEvent'): UIEvent;\n\tcreateEvent(eventInterface: 'UIEvents'): UIEvent;\n\tcreateEvent(eventInterface: 'VRDisplayEvent'): VRDisplayEvent;\n\tcreateEvent(eventInterface: 'VRDisplayEvent '): VRDisplayEvent;\n\tcreateEvent(eventInterface: 'WebGLContextEvent'): WebGLContextEvent;\n\tcreateEvent(eventInterface: 'WheelEvent'): WheelEvent;\n\tcreateEvent(eventInterface: string): Event;\n\tcreateNodeIterator(root: Node, whatToShow?: number, filter?: NodeFilter | null): NodeIterator; // Creates a NodeIterator object that you can use to traverse filtered lists of nodes or elements in a document.\n\t// @param root The root element or node to start traversing on.\n\t// @param whatToShow The type of nodes or elements to appear in the node list\n\t// @param filter A custom NodeFilter function to use. For more information, see filter. Use null for no filter.\n\t// @param entityReferenceExpansion A flag that specifies whether entity reference nodes are expanded.\n\tcreateProcessingInstruction(target: string, data: string): ProcessingInstruction; // Returns a ProcessingInstruction node whose target is target and data is data. If target does not match the Name production an 'InvalidCharacterError' DOMException will be thrown. If data contains \"?>\" an \"InvalidCharacterError\" DOMException will be thrown.\n\tcreateRange(): Range; // Returns an empty range object that has both of its boundary points positioned at the beginning of the document.\n\tcreateTextNode(data: string): Text; // Creates a text string from the specified value.\n\t// @param data String that specifies the nodeValue property of the text node.\n\tcreateTreeWalker(root: Node, whatToShow?: number, filter?: NodeFilter | null): TreeWalker; // Creates a TreeWalker object that you can use to traverse filtered lists of nodes or elements in a document.\n\t// @param root The root element or node to start traversing on.\n\t// @param whatToShow The type of nodes or elements to appear in the node list. For more information, see whatToShow.\n\t// @param filter A custom NodeFilter function to use.\n\t// @param entityReferenceExpansion A flag that specifies whether entity reference nodes are expanded.\n\t// @deprecated\n\t// createTreeWalker(root: Node, whatToShow: number, filter: NodeFilter | null, entityReferenceExpansion?: boolean): TreeWalker;\n\telementFromPoint(x: number, y: number): Element | null; // Returns the element for the specified x coordinate and the specified y coordinate.\n\t// @param x The x-offset\n\t// @param y The y-offset\n\telementsFromPoint(x: number, y: number): Element[];\n\texecCommand(commandId: string, showUI?: boolean, value?: string): boolean; // Executes a command on the current document, current selection, or the given range.\n\t// @param commandId String that specifies the command to execute. This command can be any of the command identifiers that can be executed in script.\n\t// @param showUI Display the user interface, defaults to false.\n\t// @param value Value to assign.\n\texitFullscreen(): Promise<void>; // Stops document's fullscreen element from being displayed fullscreen and resolves promise when done.\n\texitPointerLock(): void;\n\tgetAnimations(): Animation[];\n\tgetElementById(elementId: string): HTMLElement | null; // Returns a reference to the first object with the specified value of the ID or NAME attribute.\n\t// @param elementId String that specifies the ID value. Case-insensitive.\n\tgetElementsByClassName(classNames: string): HTMLCollectionOf<Element>; // Returns a HTMLCollection of the elements in the object on which the method was invoked (a document or an element) that have all the classes given by classNames. The classNames argument is interpreted as a space-separated list of classes.\n\tgetElementsByName(elementName: string): NodeListOf<HTMLElement>; // Gets a collection of objects based on the value of the NAME or ID attribute.\n\t// @param elementName Gets a collection of objects based on the value of the NAME or ID attribute.\n\tgetElementsByTagName<K extends keyof HTMLElementTagNameMap>(qualifiedName: K): HTMLCollectionOf<HTMLElementTagNameMap[K]>;\n\tgetElementsByTagName<K extends keyof SVGElementTagNameMap>(qualifiedName: K): HTMLCollectionOf<SVGElementTagNameMap[K]>;\n\tgetElementsByTagName(qualifiedName: string): HTMLCollectionOf<Element>; // Retrieves a collection of objects based on the specified element name.\n\t// @param name Specifies the name of an element.\n\tgetElementsByTagNameNS(namespaceURI: 'http://www.w3.org/1999/xhtml', localName: string): HTMLCollectionOf<HTMLElement>;\n\tgetElementsByTagNameNS(namespaceURI: 'http://www.w3.org/2000/svg', localName: string): HTMLCollectionOf<SVGElement>;\n\tgetElementsByTagNameNS(namespaceURI: string, localName: string): HTMLCollectionOf<Element>; // If namespace and localName are '*' returns a HTMLCollection of all descendant elements.\n\t// If only namespace is '*' returns a HTMLCollection of all descendant elements whose local name is localName.\n\t// If only localName is '*' returns a HTMLCollection of all descendant elements whose namespace is namespace.\n\t// Otherwise, returns a HTMLCollection of all descendant elements whose namespace is namespace and local name is localName.\n\tgetSelection(): Selection | null; // Returns an object representing the current selection of the document that is loaded into the object displaying a webpage.\n\thasFocus(): boolean; // Gets a value indicating whether the object currently has focus.\n\timportNode<T extends Node>(importedNode: T, deep: boolean): T; // Returns a copy of node. If deep is true, the copy also includes the node's descendants.\n\t// If node is a document or a shadow root, throws a 'NotSupportedError' DOMException.\n\topen(url?: string, name?: string, features?: string, replace?: boolean): Document; // Opens a new window and loads a document specified by a given URL. Also, opens a new window that uses the url parameter and the name parameter to collect the output of the write method and the writeln method.\n\t// @param url Specifies a MIME type for the document.\n\t// @param name Specifies the name of the window. This name is used as the value for the TARGET attribute on a form or an anchor element.\n\t// @param features Contains a list of items separated by commas. Each item consists of an option and a value, separated by an equals sign (for example, \"fullscreen=yes, toolbar=yes\"). The following values are supported.\n\t// @param replace Specifies whether the existing entry for the document is replaced in the history list.\n\tqueryCommandEnabled(commandId: string): boolean; // Returns a Boolean value that indicates whether a specified command can be successfully executed using execCommand, given the current state of the document.\n\t// @param commandId Specifies a command identifier.\n\tqueryCommandIndeterm(commandId: string): boolean; // Returns a Boolean value that indicates whether the specified command is in the indeterminate state.\n\t// @param commandId String that specifies a command identifier.\n\tqueryCommandState(commandId: string): boolean; // Returns a Boolean value that indicates the current state of the command.\n\t// @param commandId String that specifies a command identifier.\n\tqueryCommandSupported(commandId: string): boolean; // Returns a Boolean value that indicates whether the current command is supported on the current range.\n\t// @param commandId Specifies a command identifier.\n\tqueryCommandValue(commandId: string): string; // Returns the current value of the document, range, or current selection for the given command.\n\t// @param commandId String that specifies a command identifier.\n\twrite(...text: string[]): void; // Writes one or more HTML expressions to a document in the specified window.\n\t// @param content Specifies the text and HTML tags to write.\n\twriteln(...text: string[]): void; // Writes one or more HTML expressions, followed by a carriage return, to a document in the specified window.\n\t// @param content The text and HTML tags to write.\n\taddEventListener<K extends keyof DocumentEventMap>(type: K, listener: (this: Document, ev: DocumentEventMap[K]) => any, options?: boolean | AddEventListenerOptions): void;\n\taddEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | AddEventListenerOptions): void;\n\tremoveEventListener<K extends keyof DocumentEventMap>(type: K, listener: (this: Document, ev: DocumentEventMap[K]) => any, options?: boolean | EventListenerOptions): void;\n\tremoveEventListener(type: string, listener: EventListenerOrEventListenerObject, options?: boolean | EventListenerOptions): void;\n\t// DEPRECATED !!!\n\t// Sets or gets the color of all active links in the document.\n\t// @deprecated\n\t// alinkColor: string; // Returns a reference to the collection of elements contained by the object.\n\t// @deprecated\n\t// readonly all: HTMLAllCollection; // Retrieves a collection of all a objects that have a name and/or id property. Objects in this collection are in HTML source order.\n\t// @deprecated\n\t// readonly anchors: HTMLCollectionOf<HTMLAnchorElement>; // Retrieves a collection of all applet objects in the document.\n\t// @deprecated\n\t// readonly applets: HTMLCollectionOf<HTMLAppletElement>; // Deprecated. Sets or retrieves a value that indicates the background color behind the object.\n\t// @deprecated\n\t// bgColor: string; // Sets or gets the foreground (text) color of the document.\n\t// @deprecated\n\t// fgColor: string; // @deprecated\n\t// readonly fullscreen: boolean; // Sets or gets the color of the document links.\n\t// @deprecated\n\t// linkColor: string; // Sets or gets the color of the links that the user has visited.\n\t// @deprecated\n\t// vlinkColor: string; // @deprecated\n\t// captureEvents(): void; // @deprecated\n\t// caretRangeFromPoint(x: number, y: number): Range; // @deprecated\n\t// clear(): void; // @deprecated\n\t// releaseEvents(): void;\n\t*/\n}\n\nexport class RxDocument extends RxElement {\n\tprivate location_: ILocation = RxLocation.location;\n\tget location() {\n\t\treturn this.location_;\n\t}\n\tget URL(): string {\n\t\treturn this.location_.href;\n\t}\n\tget hidden(): true {\n\t\treturn true;\n\t}\n\tget visibilityState(): 'prerender' {\n\t\treturn 'prerender';\n\t}\n\tget doctype(): RxDocumentType | null {\n\t\treturn this.childNodes.find(x => isRxDocumentType(x)) as RxDocumentType;\n\t}\n\tget head(): RxElement {\n\t\t// console.log('childNodes', this.childNodes);\n\t\tlet head: RxElement | null = this.documentElement.childNodes.find(x => isRxElement(x) && x.nodeName === 'head') as RxElement;\n\t\tif (!head) {\n\t\t\thead = new RxElement(this.documentElement, 'head');\n\t\t\tthis.documentElement.append(head);\n\t\t}\n\t\treturn head;\n\t}\n\tget body(): RxElement | null {\n\t\tlet body: RxElement | null = this.childNodes.find(x => isRxElement(x) && x.nodeName === 'body') as RxElement;\n\t\tif (!body) {\n\t\t\tbody = new RxElement(this.documentElement, 'body');\n\t\t\tthis.documentElement.append(body);\n\t\t}\n\t\treturn body;\n\t}\n\tget title(): string | null {\n\t\tconst title = this.head.childNodes.find(x => isRxElement(x) && x.nodeName === 'title') as RxElement;\n\t\tif (title) {\n\t\t\treturn title.innerText;\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t}\n\tset title(nodeValue: string | null) {\n\t\tlet title: RxElement | null = this.head.childNodes.find(x => isRxElement(x) && x.nodeName === 'title') as RxElement | null;\n\t\tif (!title) {\n\t\t\ttitle = new RxElement(this.head, 'title');\n\t\t}\n\t\ttitle.innerText = nodeValue;\n\t}\n\tget documentElement(): RxElement {\n\t\tlet element: RxElement | null = this.firstElementChild;\n\t\tif (!element) {\n\t\t\telement = new RxElement(this, 'html');\n\t\t}\n\t\treturn element;\n\t}\n\n\t/*\n\t\treadonly characterSet: string; // Returns document's encoding.\n\t\treadonly charset: string; // Gets or sets the character set used to encode the object.\n\t\treadonly compatMode: string; // Gets a value that indicates whether standards-compliant mode is switched on for the object.\n\t\treadonly contentType: string; // Returns document's content type.\n\t\treadonly currentScript: HTMLOrSVGScriptElement | null; // Returns the script element, or the SVG script element, that is currently executing, as long as the element represents a classic script. In the case of reentrant script execution, returns the one that most recently started executing amongst those that have not yet finished executing.\n\t\treadonly defaultView: (WindowProxy & typeof globalThis) | null; // Returns null if the Document is not currently executing a script or SVG script element (e.g., because the running script is an event handler, or a timeout), or if the currently executing script or SVG script element represents a module script.\n\t\treadonly documentElement: HTMLElement; // Gets a reference to the root node of the document.\n\t\treadonly documentURI: string; // Returns document's URL.\n\t\treadonly embeds: HTMLCollectionOf<HTMLEmbedElement>; // Retrieves a collection of all embed objects in the document.\n\t\treadonly forms: HTMLCollectionOf<HTMLFormElement>; // Retrieves a collection, in source order, of all form objects in the document.\n\t\treadonly fullscreenEnabled: boolean; // Returns true if document has the ability to display elements fullscreen and fullscreen is supported, or false otherwise.\n\t\treadonly head: HTMLHeadElement; // Returns the head element.\n\t\treadonly hidden: boolean;\n\t\treadonly images: HTMLCollectionOf<HTMLImageElement>; // Retrieves a collection, in source order, of img objects in the document.\n\t\treadonly implementation: DOMImplementation; // Gets the implementation object of the current document.\n\t\treadonly inputEncoding: string; // Returns the character encoding used to create the webpage that is loaded into the document object.\n\t\treadonly lastModified: string; // Gets the date that the page was last modified, if the page supplies one.\n\t\treadonly links: HTMLCollectionOf<HTMLAnchorElement | HTMLAreaElement>; // Retrieves a collection of all a objects that specify the href property and all area objects in the document.\n\t\treadonly origin: string; // Returns document's origin.\n\t\treadonly ownerDocument: null;\n\t\treadonly plugins: HTMLCollectionOf<HTMLEmbedElement>; // Return an HTMLCollection of the embed elements in the Document.\n\t\treadonly readyState: DocumentReadyState; // Retrieves a value that indicates the current state of the object.\n\t\treadonly referrer: string; // Gets the URL of the location that referred the user to the current page.\n\t\treadonly scripts: HTMLCollectionOf<HTMLScriptElement>; // Retrieves a collection of all script objects in the document.\n\t\treadonly scrollingElement: Element | null;\n\t\treadonly timeline: DocumentTimeline;\n\t\treadonly visibilityState: VisibilityState;\n\t\t*/\n\n\tconstructor() {\n\t\tsuper(null, '#document');\n\t\tthis.nodeType = RxNodeType.DOCUMENT_NODE;\n\t\tthis.childNodes = [];\n\t}\n\tcreateAttribute() { }\n\t// Creates a new Attr object and returns it.\n\tcreateAttributeNS() { }\n\t// Creates a new attribute node in a given namespace and returns it.\n\tcreateCDATASection() { }\n\t// Creates a new CDATA node and returns it.\n\tcreateComment(nodeValue: string) {\n\t\treturn new RxComment(null, nodeValue);\n\t}\n\t// Creates a new comment node and returns it.\n\tcreateDocumentFragment() {\n\t\treturn new RxDocumentFragment();\n\t}\n\t// Creates a new document fragment.\n\tcreateElement(nodeName: string): RxElement {\n\t\treturn new RxElement(null, nodeName);\n\t}\n\t// Creates a new element with the given tag name.\n\tcreateElementNS(nodeName: string): RxElement {\n\t\treturn new RxElement(null, nodeName);\n\t}\n\t// Creates a new element with the given tag name and namespace URI.\n\tcreateEvent() { }\n\t// Creates an event object.\n\tcreateNodeIterator() { }\n\t// Creates a NodeIterator object.\n\tcreateProcessingInstruction(nodeValue: string) {\n\t\treturn new RxProcessingInstruction(null, nodeValue);\n\t}\n\t// Creates a new ProcessingInstruction object.\n\tcreateRange() { }\n\t// Creates a Range object.\n\tcreateTextNode(nodeValue: string) {\n\t\treturn new RxText(null, nodeValue);\n\t}\n\t// Creates a text node.\n\tcreateTouchList() { }\n\t// Creates a TouchList object.\n\tcreateTreeWalker() { }\n\t// Creates a TreeWalker object.\n\tserialize(): string {\n\t\treturn `${this.childNodes.map(x => x.serialize()).join('')}`;\n\t}\n}\n\nexport function isRxElement(x: RxNode): x is RxElement {\n\treturn x.nodeType === RxNodeType.ELEMENT_NODE;\n}\n\nexport function isRxText(x: RxNode): x is RxText {\n\treturn x.nodeType === RxNodeType.TEXT_NODE;\n}\n\nexport function isRxComment(x: RxNode): x is RxComment {\n\treturn x.nodeType === RxNodeType.COMMENT_NODE;\n}\n\nexport function isRxDocument(x: RxNode): x is RxDocument {\n\treturn x.nodeType === RxNodeType.DOCUMENT_NODE;\n}\n\nexport function isRxDocumentFragment(x: RxNode): x is RxDocumentFragment {\n\treturn x.nodeType === RxNodeType.DOCUMENT_FRAGMENT_NODE;\n}\n\nexport function isRxDocumentType(x: RxNode): x is RxDocumentType {\n\treturn x.nodeType === RxNodeType.DOCUMENT_TYPE_NODE;\n}\n\nexport function isRxProcessingInstruction(x: RxNode): x is RxProcessingInstruction {\n\treturn x.nodeType === RxNodeType.PROCESSING_INSTRUCTION_NODE;\n}\n\nexport function parse(html: string) {\n\tconst doc = new RxDocument();\n\tlet parentNode: RxElement = doc,\n\t\tnode;\n\tconst parser = new Parser(\n\t\t{\n\t\t\tonopentag: (nodeName, attributes) => {\n\t\t\t\t// console.log(nodeName);\n\t\t\t\tnode = new RxElement(parentNode, nodeName, attributes);\n\t\t\t\tparentNode.childNodes.push(node);\n\t\t\t\tparentNode = node;\n\t\t\t\t// if (NO_CHILDS.indexOf(nodeName) === -1) {\n\t\t\t\t//\tconsole.log(nodeName);\n\t\t\t\t//\tparentNode = node;\n\t\t\t\t// }\n\t\t\t},\n\t\t\tonclosetag: (nodeName) => {\n\t\t\t\tif (parentNode.parentNode) {\n\t\t\t\t\tparentNode = parentNode.parentNode;\n\t\t\t\t}\n\t\t\t},\n\t\t\tontext: (nodeValue) => {\n\t\t\t\t// console.log('ontext', nodeValue);\n\t\t\t\t// if (nodeValue.length) {\n\t\t\t\tconst textNode = new RxText(parentNode, nodeValue);\n\t\t\t\tparentNode.childNodes.push(textNode);\n\t\t\t\t// }\n\t\t\t},\n\t\t\tonprocessinginstruction: (nodeName, nodeValue) => {\n\t\t\t\t// console.log('onprocessinginstruction', nodeName, nodeValue);\n\t\t\t\tif (nodeName === '!doctype') {\n\t\t\t\t\tnode = new RxDocumentType(parentNode, nodeValue);\n\t\t\t\t} else {\n\t\t\t\t\tnode = new RxProcessingInstruction(parentNode, nodeValue);\n\t\t\t\t}\n\t\t\t\tparentNode.childNodes.push(node);\n\t\t\t},\n\t\t\toncomment: nodeValue => {\n\t\t\t\t// console.log('oncomment', nodeValue);\n\t\t\t\tnode = new RxComment(parentNode, nodeValue);\n\t\t\t\tparentNode.childNodes.push(node);\n\t\t\t\t// parentNode = node;\n\t\t\t},\n\t\t\toncommentend: () => {\n\t\t\t\t// console.log('oncommentend');\n\t\t\t\t// parentNode = parentNode.parentNode;\n\t\t\t},\n\t\t\t/*\n\t\t\toncdatastart: () => {\n\t\t\t\tconsole.log('oncdatastart');\n\t\t\t},\n\t\t\toncdataend: () => {\n\t\t\t\tconsole.log('oncdataend');\n\t\t\t},\n\t\t\tonerror: error => {\n\t\t\t\tconsole.log('error', error);\n\t\t\t},\n\t\t\tonopentagname: (name) => {\n\t\t\t\tconsole.log('onopentagname', name);\n\t\t\t},\n\t\t\tonattribute: (name, value) => {\n\t\t\t\tconsole.log('onattribute', name, value);\n\t\t\t},\n\t\t\tonreset: () => {\n\t\t\t\tconsole.log('reset');\n\t\t\t},\n\t\t\tonend: () => {\n\t\t\t\tconsole.log('end');\n\t\t\t},\n\t\t\t*/\n\t\t},\n\t\t{\n\t\t\tdecodeEntities: false,\n\t\t\tlowerCaseTags: true,\n\t\t}\n\t);\n\tparser.write(html);\n\tparser.end();\n\treturn doc;\n}\n\nexport function getQueries(selector: string): RxQuery[] {\n\tconst queries: RxQuery[] = [];\n\tselector\n\t\t.trim()\n\t\t.split(' ')\n\t\t.forEach((x: string) => {\n\t\t\tx.trim()\n\t\t\t\t.split('>')\n\t\t\t\t.forEach((x, i) => {\n\t\t\t\t\t// const regex = /\\.([^\\.[]+)|\\[([^\\.\\[]+)\\]|([^\\.\\[\\]]+)/g;\n\t\t\t\t\t// const regex = /\\#([^\\.[#]+)|\\.([^\\.[#]+)|\\[([^\\.\\[#]+)\\]|([^\\.\\[#\\]]+)/g;\n\t\t\t\t\tconst regex = /\\:not\\(\\#([^\\.[#:]+)\\)|\\:not\\(\\.([^\\.[#:]+)\\)|\\:not\\(\\[([^\\.\\[#:]+)\\]\\)|\\:not\\(([^\\.\\[#:\\]]+)\\)|\\#([^\\.[#:]+)|\\.([^\\.[#:]+)|\\[([^\\.\\[#:]+)\\]|([^\\.\\[#:\\]]+)/g;\n\t\t\t\t\t/* eslint no-useless-escape: \"off\" */\n\t\t\t\t\tconst selectors = [];\n\t\t\t\t\tconst matches = x.matchAll(regex);\n\t\t\t\t\tfor (const match of matches) {\n\t\t\t\t\t\tif (match[1]) {\n\t\t\t\t\t\t\tselectors.push({ selector: match[1], type: SelectorType.Id, negate: true });\n\t\t\t\t\t\t} else if (match[2]) {\n\t\t\t\t\t\t\tselectors.push({ selector: match[2], type: SelectorType.Class, negate: true });\n\t\t\t\t\t\t} else if (match[3]) {\n\t\t\t\t\t\t\tselectors.push({ selector: match[3], type: SelectorType.Attribute, negate: true });\n\t\t\t\t\t\t} else if (match[4]) {\n\t\t\t\t\t\t\tselectors.push({ selector: match[4], type: SelectorType.TagName, negate: true });\n\t\t\t\t\t\t} else if (match[5]) {\n\t\t\t\t\t\t\tselectors.push({ selector: match[5], type: SelectorType.Id, negate: false });\n\t\t\t\t\t\t} else if (match[6]) {\n\t\t\t\t\t\t\tselectors.push({ selector: match[6], type: SelectorType.Class, negate: false });\n\t\t\t\t\t\t} else if (match[7]) {\n\t\t\t\t\t\t\tselectors.push({ selector: match[7], type: SelectorType.Attribute, negate: false });\n\t\t\t\t\t\t} else if (match[8]) {\n\t\t\t\t\t\t\tselectors.push({ selector: match[8], type: SelectorType.TagName, negate: false });\n\t\t\t\t\t\t}\n\t\t\t\t\t\t// console.log('match', match);\n\t\t\t\t\t}\n\t\t\t\t\tconst selector =\n\t\t\t\t\t\ti > 0\n\t\t\t\t\t\t\t? { selector: x, selectors, inner: true }\n\t\t\t\t\t\t\t: { selector: x, selectors, inner: false };\n\t\t\t\t\tqueries.push.call(queries, selector);\n\t\t\t\t});\n\t\t});\n\treturn queries;\n}\n\nexport function matchSelector(child: RxElement, selector: RxSelector): boolean {\n\tswitch (selector.type) {\n\t\tcase SelectorType.Id:\n\t\t\treturn (selector.selector !== '' && child.attributes.id === selector.selector) !== selector.negate;\n\t\tcase SelectorType.Class:\n\t\t\treturn (child.classList.indexOf(selector.selector) !== -1) !== selector.negate;\n\t\tcase SelectorType.Attribute:\n\t\t\treturn (Object.keys(child.attributes).indexOf(selector.selector) !== -1) !== selector.negate;\n\t\tcase SelectorType.TagName:\n\t\t\treturn (child.nodeName === selector.selector) !== selector.negate;\n\t\tdefault:\n\t\t\treturn false;\n\t}\n}\n\nexport function matchSelectors(child: RxElement, selectors: RxSelector[]): boolean {\n\treturn selectors.reduce(function (p: boolean, selector: RxSelector) {\n\t\treturn p && matchSelector(child, selector);\n\t}, true);\n}\n\nexport function querySelectorAll(queries: RxQuery[], childNodes: RxNode[], query: RxQuery | null = null, nodes: RxElement[] = []): RxElement[] | null {\n\tif (query || queries.length) {\n\t\tquery = query || queries.shift() as RxQuery;\n\t\tfor (let child of childNodes) {\n\t\t\tif (child instanceof RxElement) {\n\t\t\t\tif (matchSelectors(child, query.selectors)) {\n\t\t\t\t\t// console.log(query);\n\t\t\t\t\tif (queries.length) {\n\t\t\t\t\t\tconst results: RxElement[] | null = querySelectorAll(queries, child.childNodes);\n\t\t\t\t\t\tif (results) {\n\t\t\t\t\t\t\tArray.prototype.push.apply(nodes, results);\n\t\t\t\t\t\t}\n\t\t\t\t\t} else {\n\t\t\t\t\t\tnodes.push(child);\n\t\t\t\t\t}\n\t\t\t\t} else if (!query.inner) {\n\t\t\t\t\tconst results: RxElement[] | null = querySelectorAll(queries, child.childNodes, query);\n\t\t\t\t\tif (results) {\n\t\t\t\t\t\tArray.prototype.push.apply(nodes, results);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn nodes.length ? nodes : null;\n}\n\nexport function querySelector(queries: RxQuery[], childNodes: RxNode[], query: RxQuery | null = null): RxElement | null {\n\tlet node = null;\n\tif (query || queries.length) {\n\t\tquery = query || queries.shift() as RxQuery;\n\t\tfor (let child of childNodes) {\n\t\t\tif (child instanceof RxElement) {\n\t\t\t\tif (matchSelectors(child, query.selectors)) {\n\t\t\t\t\t// console.log(query);\n\t\t\t\t\tif (queries.length) {\n\t\t\t\t\t\treturn querySelector(queries, child.childNodes);\n\t\t\t\t\t} else {\n\t\t\t\t\t\treturn child;\n\t\t\t\t\t}\n\t\t\t\t} else if (!query.inner) {\n\t\t\t\t\tnode = querySelector(queries, child.childNodes, query);\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t}\n\treturn node;\n}\n\nexport function cloneNode(source: RxNode, deep: boolean = false, parentNode: RxElement | null = null): RxNode {\n\tlet node: RxNode;\n\tif (isRxElement(source)) {\n\t\tconst nodeElement: RxElement = new RxElement(\n\t\t\tparentNode,\n\t\t\tsource.nodeName,\n\t\t\tObject.assign({}, source.attributes),\n\t\t);\n\t\tif (deep) {\n\t\t\tnodeElement.childNodes = source.childNodes.map(x => cloneNode.apply(x, [x, deep, nodeElement]));\n\t\t}\n\t\tnode = nodeElement;\n\t} else if (isRxDocumentFragment(source)) {\n\t\tconst nodeDocumentFragment: RxDocumentFragment = new RxDocumentFragment();\n\t\tif (deep) {\n\t\t\tnodeDocumentFragment.childNodes = source.childNodes.map(x => cloneNode.apply(x, [x, deep, nodeDocumentFragment]));\n\t\t}\n\t\tnode = nodeDocumentFragment;\n\t} else if (isRxText(source)) {\n\t\tnode = new RxText(parentNode, source.nodeValue);\n\t} else if (isRxComment(source)) {\n\t\tnode = new RxComment(parentNode, source.nodeValue);\n\t} else if (isRxDocument(source)) {\n\t\tconst documentElement: RxDocument = new RxDocument();\n\t\tif (deep) {\n\t\t\tdocumentElement.childNodes = source.childNodes.map(x => cloneNode.apply(x, [x, deep, documentElement]));\n\t\t}\n\t\tnode = documentElement;\n\t} else {\n\t\tthrow new Error('Invalid node type');\n\t}\n\treturn node;\n}\n","import { getLocationComponents, ILocationInit } from \"rxcomp\";\n\nexport interface IDOMStringList extends DOMStringList {\n\t// Returns the number of strings in strings.\n\treadonly length: number;\n\t// Returns true if strings contains string, and false otherwise.\n\tcontains(string: string): boolean;\n\t// Returns the string with index index from strings.\n\titem(index: number): string | null;\n\t[index: number]: string;\n}\n\nexport class RxDOMStringList extends Array<string> implements IDOMStringList {\n\t/*\n\tprivate list_: string[] = [];\n\tget length(): number {\n\t\treturn this.list_.length;\n\t}\n\t*/\n\tcontains(string: string): boolean {\n\t\t// return this.list_.indexOf(string) !== -1;\n\t\treturn this.indexOf(string) !== -1;\n\t}\n\titem(index: number): string | null {\n\t\t// if (index > 0 && index < this.list_.length) {\n\t\tif (index > 0 && index < this.length) {\n\t\t\t// return this.list_[index];\n\t\t\treturn this[index];\n\t\t} else {\n\t\t\treturn null;\n\t\t}\n\t};\n\t// [index: number]: string;\n}\n\nexport interface ILocation extends Location {\n\t/*\n\thash: string; // Returns the Location object's URL's fragment (includes leading \"#\" if non-empty). Can be set, to navigate to the same URL with a changed fragment (ignores leading \"#\").\n\thost: string; // Returns the Location object's URL's host and port (if different from the default port for the scheme). Can be set, to navigate to the same URL with a changed host and port.\n\thostname: string; // Returns the Location object's URL's host. Can be set, to navigate to the same URL with a changed host.\n\tpathname: string; // Returns the Location object's URL's path. Can be set, to navigate to the same URL with a changed path.\n\tport: string; // Returns the Location object's URL's port. Can be set, to navigate to the same URL with a changed port.\n\tprotocol: string; // Returns the Location object's URL's scheme. Can be set, to navigate to the same URL with a changed scheme.\n\tsearch: string; // Returns the Location object's URL's query (includes leading \"?\" if non-empty). Can be set, to navigate to the same URL with a changed query (ignores leading \"?\").\n\thref: string; // Returns the Location object's URL. Can be set, to navigate to the given URL.\n\treadonly origin: string; // Returns the Location object's URL's origin.\n\treadonly ancestorOrigins: DOMStringList; // Returns a DOMStringList object listing the origins of the ancestor browsing contexts, from the parent browsing context to the top-level browsing context.\n\tassign(url: string): void; // Navigates to the given URL.\n\treload(): void; // reload(forcedReload: boolean): void; // @deprecated\n\treplace(url: string): void; // Removes the current page from the session history and navigates to the given URL.\n\ttoString(): string;\n\t*/\n}\n\nexport class RxLocation implements ILocation {\n\t/*\n\thash: string = '';\n\thost: string = '';\n\thostname: string = '';\n\tpathname: string = '';\n\tport: string = '';\n\tprotocol: string = '';\n\tsearch: string = '';\n\t*/\n\n\tprivate hash_: string = '';\n\tget hash(): string { return this.hash_; }\n\tset hash(hash: string) { this.hash_ = hash; this.href = this.href; }\n\n\tprivate host_: string = '';\n\tget host(): string { return this.host_; }\n\tset host(host: string) { this.host_ = host; this.href = this.href; }\n\n\tprivate hostname_: string = '';\n\tget hostname(): string { return this.hostname_; }\n\tset hostname(hostname: string) { this.hostname_ = hostname; this.href = this.href; }\n\n\tprivate pathname_: string = '';\n\tget pathname(): string { return this.pathname_; }\n\tset pathname(pathname: string) { this.pathname_ = pathname; this.href = this.href; }\n\n\tprivate port_: string = '';\n\tget port(): string { return this.port_; }\n\tset port(port: string) { this.port_ = port; this.href = this.href; }\n\n\tprivate protocol_: string = '';\n\tget protocol(): string { return this.protocol_; }\n\tset protocol(protocol: string) { this.protocol_ = protocol; this.href = this.href; }\n\n\tprivate search_: string = '';\n\tget search(): string { return this.search_; }\n\tset search(search: string) { this.search_ = search; this.href = this.href; }\n\n\tprivate href_: string = '';\n\tget href(): string {\n\t\tconst href: string = `${this.protocol}//${this.host}${this.port.length ? `:${this.port}` : ``}${this.pathname}${this.search}${this.hash}`;\n\t\tthis.href_ = href;\n\t\treturn href;\n\t}\n\tset href(href: string) {\n\t\tif (this.href_ !== href) {\n\t\t\tthis.href_ = href;\n\t\t\tconst location: ILocationInit = getLocationComponents(href);\n\t\t\tthis.protocol_ = location.protocol;\n\t\t\tthis.host_ = location.host;\n\t\t\tthis.hostname_ = location.hostname;\n\t\t\tthis.port_ = location.port;\n\t\t\tthis.pathname_ = location.pathname;\n\t\t\tthis.search_ = location.search;\n\t\t\tthis.hash_ = location.hash;\n\t\t}\n\t}\n\tget origin(): string {\n\t\treturn `${this.protocol}//${this.host}${this.port.length ? `:${this.port}` : ``}`;\n\t}\n\tprivate ancestorOrigins_: IDOMStringList = new RxDOMStringList();\n\tget ancestorOrigins(): DOMStringList {\n\t\treturn this.ancestorOrigins_;\n\t}\n\tassign(url: string): void {\n\t\tthis.href = url;\n\t}\n\treload(): void { }\n\treplace(url: string): void {\n\t\tthis.href = url;\n\t}\n\ttoString(): string {\n\t\treturn this.href;\n\t}\n\tprivate static location_: ILocation;\n\tstatic get location(): ILocation {\n\t\tif (this.location_) {\n\t\t\treturn this.location_;\n\t\t} else {\n\t\t\treturn this.location_ = new RxLocation();\n\t\t}\n\t}\n}\n","import { RxLocation } from \"../location/location\";\n\nexport interface IHistoryItem {\n\tdata: any;\n\ttitle: string;\n\turl?: string | null;\n}\n\nexport interface IHistory extends History {\n\t/*\n\treadonly length: number;\n    scrollRestoration: ScrollRestoration;\n    readonly state: any;\n    back(): void;\n    forward(): void;\n    go(delta?: number): void;\n    pushState(data: any, title: string, url?: string | null): void;\n\treplaceState(data: any, title: string, url?: string | null): void;\n\t*/\n}\n\nexport class RxHistory implements IHistory {\n\tprivate currentIndex_: number = 0;\n\tprivate history_: IHistoryItem[] = [];\n\tget length(): number {\n\t\treturn this.history_.length;\n\t}\n\tscrollRestoration: ScrollRestoration = 'auto';\n\tstate: any;\n\tback(): void {\n\t\tif (this.currentIndex_ > 0) {\n\t\t\tthis.currentIndex_--;\n\t\t\tconst item: IHistoryItem = this.history_[this.currentIndex_];\n\t\t\tif (item.url) RxLocation.location.href = item.url;\n\t\t}\n\t};\n\tforward(): void {\n\t\tif (this.currentIndex_ < this.history_.length - 1) {\n\t\t\tthis.currentIndex_++;\n\t\t\tconst item: IHistoryItem = this.history_[this.currentIndex_];\n\t\t\tif (item.url) RxLocation.location.href = item.url;\n\t\t}\n\t};\n\tgo(delta?: number): void {\n\t\tif (typeof delta === 'number') {\n\t\t\tconst index: number = this.currentIndex_ + delta;\n\t\t\tif (index > 0 && index < this.history_.length) {\n\t\t\t\tconst item: IHistoryItem = this.history_[index];\n\t\t\t\tif (item.url) RxLocation.location.href = item.url;\n\t\t\t}\n\t\t}\n\t};\n\tpushState(data: any, title: string, url?: string | null): void {\n\t\tthis.history_.push({ data, title, url });\n\t\tthis.currentIndex_ = this.history_.length - 1;\n\t};\n\treplaceState(data: any, title: string, url?: string | null): void {\n\t\tif (this.history_.length) {\n\t\t\tthis.history_.splice(this.history_.length - 1, 1, { data, title, url });\n\t\t} else {\n\t\t\tthis.history_.push({ data, title, url });\n\t\t}\n\t\tthis.currentIndex_ = this.history_.length - 1;\n\t};\n\tprivate static history_: History;\n\tstatic get history(): IHistory {\n\t\tif (this.history_) {\n\t\t\treturn this.history_;\n\t\t} else {\n\t\t\treturn this.history_ = new RxHistory();\n\t\t}\n\t}\n}\n","import { isPlatformServer, Module, ModuleError, Platform } from 'rxcomp';\nimport { Observable, Observer, of, throwError } from 'rxjs';\nimport { switchMap } from 'rxjs/operators';\nimport CacheService, { CacheControlType, CacheMode } from '../cache/cache.service';\nimport FileService from '../file/file.service';\nimport { IHistory, RxHistory } from '../history/history';\nimport { ILocation, RxLocation } from '../location/location';\nimport { parse, RxDocument, RxElement, RxText } from '../nodes/nodes';\n\nexport interface IServerVars {\n\tname?: string;\n\thost?: string;\n\tport?: number;\n\tcharset?: string;\n\ttemplate?: string;\n\tcacheMode?: CacheMode;\n\tcache?: string;\n\troot?: string;\n\tresource?: string;\n\tapi?: string;\n\tstatic?: boolean;\n\tdevelopment?: boolean;\n\tproduction?: boolean;\n\t[key: string]: any;\n}\n\nexport interface IServerRequest {\n\turl: string;\n\ttemplate?: string;\n\tvars?: IServerVars;\n}\n\nexport interface IServerResponse extends IServerRequest {\n\tserialize: () => string;\n\tbody?: string;\n\tstatusCode?: number;\n\tstatusMessage?: string;\n\tmaxAge?: number;\n\tcacheControl?: CacheControlType;\n}\n\nexport interface IServerErrorResponse extends IServerRequest {\n\terror: Error;\n\tstatusCode?: number;\n\tstatusMessage?: string;\n}\n\nexport class ServerRequest implements IServerRequest {\n\turl!: string;\n\ttemplate!: string;\n\tvars!: IServerVars;\n\tconstructor(options?: IServerRequest) {\n\t\tif (options) {\n\t\t\tObject.assign(this, options);\n\t\t}\n\t\tthis.vars = Object.assign({\n\t\t\thost: 'http://localhost:5000',\n\t\t\tport: 5000,\n\t\t\tcharset: 'utf8',\n\t\t\ttemplate: `./index.html`,\n\t\t\tcacheMode: CacheMode.Memory,\n\t\t\tcache: './cache/',\n\t\t\troot: './dist/browser/',\n\t\t}, this.vars || {});\n\t}\n}\n\nexport class ServerResponse implements IServerResponse {\n\turl!: string;\n\ttemplate!: string;\n\tvars!: IServerVars;\n\tserialize!: () => string;\n\tbody!: string;\n\tstatusCode?: number;\n\tstatusMessage?: string;\n\tmaxAge: number = 3600;\n\tcacheControl: CacheControlType = CacheControlType.Public;\n\tconstructor(options?: IServerResponse) {\n\t\tif (options) {\n\t\t\tObject.assign(this, options);\n\t\t}\n\t}\n}\n\nexport class ServerErrorResponse implements IServerErrorResponse {\n\turl!: string;\n\tvars!: IServerVars;\n\terror!: Error;\n\tstatusCode?: number;\n\tstatusMessage?: string;\n\tconstructor(options?: IServerErrorResponse) {\n\t\tif (options) {\n\t\t\tObject.assign(this, options);\n\t\t}\n\t}\n}\n\nexport default class Server extends Platform {\n\n\t/**\n\t * @param moduleFactory\n\t * @description This method returns a Server compiled module\n\t */\n\tstatic bootstrap(moduleFactory?: typeof Module, request?: ServerRequest) {\n\t\tif (!isPlatformServer) {\n\t\t\tthrow new ModuleError('missing platform server, node process not found');\n\t\t}\n\t\tif (!moduleFactory) {\n\t\t\tthrow new ModuleError('missing moduleFactory');\n\t\t}\n\t\tif (!moduleFactory.meta) {\n\t\t\tthrow new ModuleError('missing moduleFactory meta');\n\t\t}\n\t\tif (!moduleFactory.meta.bootstrap) {\n\t\t\tthrow new ModuleError('missing bootstrap');\n\t\t}\n\t\tif (!moduleFactory.meta.bootstrap.meta) {\n\t\t\tthrow new ModuleError('missing bootstrap meta');\n\t\t}\n\t\tif (!moduleFactory.meta.bootstrap.meta.selector) {\n\t\t\tthrow new ModuleError('missing bootstrap meta selector');\n\t\t}\n\t\tif (!request?.template) {\n\t\t\tthrow new ModuleError('missing template');\n\t\t}\n\t\t/*\n\t\tif (typeof ((ReadableStream.prototype as any)[Symbol.asyncIterator]) === 'undefined') {\n\t\t\t(ReadableStream.prototype as any)[Symbol.asyncIterator] = async function* () {\n\t\t\t\tconst reader = this.getReader()\n\t\t\t\twhile (1) {\n\t\t\t\t\tconst r = await reader.read();\n\t\t\t\t\tif (r.done) {\n\t\t\t\t\t\treturn r.value;\n\t\t\t\t\t}\n\t\t\t\t\tyield r.value;\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\t*/\n\t\tconst document = this.resolveGlobals(request);\n\t\tconst meta = this.resolveMeta(moduleFactory);\n\t\tif (meta.node instanceof RxElement) {\n\t\t\tconst node: RxElement = meta.node as RxElement;\n\t\t\tconst nodeInnerHTML = meta.nodeInnerHTML;\n\t\t\tconst rxcomp_hydrate_ = {\n\t\t\t\tselector: moduleFactory.meta.bootstrap.meta.selector,\n\t\t\t\tinnerHTML: nodeInnerHTML,\n\t\t\t};\n\t\t\tconst scriptNode = new RxElement(null, 'script');\n\t\t\tconst scriptText = new RxText(null, `var rxcomp_hydrate_ = ${JSON.stringify(rxcomp_hydrate_)};`);\n\t\t\tscriptNode.append(scriptText);\n\t\t\tnode.parentNode?.insertBefore(scriptNode, node);\n\t\t}\n\t\tconst module = new moduleFactory();\n\t\tmodule.meta = meta;\n\t\tmeta.imports.forEach((moduleFactory: typeof Module) => {\n\t\t\tmoduleFactory.prototype.constructor.call(module);\n\t\t});\n\t\tconst instances = module.compile(meta.node, { document } as Window);\n\t\tmodule.instances = instances;\n\t\tconst root = instances[0];\n\t\troot.pushChanges();\n\t\treturn module;\n\t}\n\n\tstatic serialize(): string {\n\t\t// console.log('Server.serialize');\n\t\tif (this.document instanceof RxDocument) {\n\t\t\tconst serialized = this.document.serialize();\n\t\t\t// console.log('serialized', serialized);\n\t\t\treturn serialized;\n\t\t} else {\n\t\t\tthrow new ModuleError('document is not an instance of RxDocument');\n\t\t}\n\t}\n\n\tprotected static document: Document | RxDocument;\n\n\tprotected static resolveGlobals(request: ServerRequest): Document | RxDocument {\n\t\tconst url: string = request.url;\n\t\tconst location: ILocation = RxLocation.location;\n\t\tlocation.assign(url);\n\t\tglobal.location = location;\n\t\tconst history: IHistory = RxHistory.history;\n\t\thistory.replaceState(null, '', location.origin);\n\t\tglobal.history = history;\n\t\tconst documentOrHtml: Document | string = request.template!;\n\t\tconst document: Document | RxDocument = typeof documentOrHtml === 'string' ? parse(documentOrHtml) : documentOrHtml;\n\t\tthis.document = document as unknown as Document; // !!!\n\t\tglobal.document = this.document;\n\t\thistory.replaceState(null, document.title || '', location.origin);\n\t\treturn this.document;\n\t}\n\n\tstatic render$ = render$;\n\tstatic template$ = template$;\n\tstatic bootstrap$ = bootstrap$;\n}\n\nexport function render$(iRequest: IServerRequest, renderRequest$: (request: ServerRequest) => Observable<ServerResponse>): Observable<ServerResponse> {\n\tlet request: ServerRequest;\n\tconst request$: Observable<ServerRequest> = Observable.create(function (observer: Observer<ServerRequest>) {\n\t\trequest = new ServerRequest(iRequest);\n\t\tobserver.next(request);\n\t\tobserver.complete();\n\t});\n\treturn request$.pipe(\n\t\tswitchMap((request: ServerRequest) => fromCache$(request)),\n\t\tswitchMap((response: ServerResponse | null) => {\n\t\t\tconsole.log('Server.render$.fromCache', 'route', request.url, !!response);\n\t\t\tif (response) {\n\t\t\t\treturn of(response);\n\t\t\t} else {\n\t\t\t\treturn fromRenderRequest$(request, renderRequest$);\n\t\t\t}\n\t\t})\n\t);\n}\n\nexport function fromCache$(request: ServerRequest): Observable<ServerResponse | null> {\n\tif (request.vars.cacheMode) {\n\t\tCacheService.mode = request.vars.cacheMode;\n\t}\n\tif (request.vars.cache) {\n\t\tCacheService.folder = request.vars.cache;\n\t}\n\treturn CacheService.get$<ServerResponse | null>('render', request.url);\n}\n\nexport function fromRenderRequest$(request: ServerRequest, renderRequest$: (request: ServerRequest) => Observable<ServerResponse>): Observable<ServerResponse> {\n\treturn template$(request).pipe(\n\t\tswitchMap((template: string) => {\n\t\t\trequest.template = template;\n\t\t\treturn renderRequest$(request);\n\t\t}),\n\t\tswitchMap((response: ServerResponse) => {\n\t\t\treturn CacheService.set$('render', request.url, response, response.maxAge, response.cacheControl).pipe(\n\t\t\t\tswitchMap(() => of(response)),\n\t\t\t) as Observable<ServerResponse>;\n\t\t}),\n\t)\n}\n\nexport function template$(request: ServerRequest): Observable<string> {\n\tconst templateSrc$ = Observable.create(function (observer: Observer<string>) {\n\t\tconst src: string | undefined = request.vars.template;\n\t\tif (src) {\n\t\t\tobserver.next(src);\n\t\t\tobserver.complete();\n\t\t} else {\n\t\t\tobserver.error(new Error('ServerError: you must provide a template path'));\n\t\t}\n\t});\n\treturn templateSrc$.pipe(\n\t\tswitchMap((src: string) => FileService.readFile$(src)),\n\t\tswitchMap((template: string | null) => template ? of(template) : throwError(new Error(`ServerError: missing template at path ${request.vars.template}`)))\n\t);\n}\n\nexport function bootstrap$(moduleFactory: typeof Module, request: ServerRequest): Observable<ServerResponse> {\n\t// console.log('Server.bootstrap$', request);\n\treturn Observable.create(function (observer: Observer<ServerResponse>) {\n\t\tif (!request.template) {\n\t\t\treturn observer.error(new Error('ServerError: missing template'));\n\t\t}\n\t\ttry {\n\t\t\t// const module = Server.bootstrap(moduleFactory, request.template);\n\t\t\tServer.bootstrap(moduleFactory, request);\n\t\t\tconst serialize = () => Server.serialize();\n\t\t\tobserver.next(new ServerResponse(Object.assign({ serialize }, request) as IServerResponse));\n\t\t\tobserver.complete();\n\t\t} catch (error) {\n\t\t\tobserver.error(new ServerErrorResponse(Object.assign({ error }, request) as IServerErrorResponse));\n\t\t}\n\t});\n}\n","import { Factory, IModuleMeta, Module, Pipe } from 'rxcomp';\n\nconst factories: typeof Factory[] = [\n];\n\nconst pipes: typeof Pipe[] = [\n];\n\n/**\n *  ServerModule Class.\n * @example\n * export default class AppModule extends Module {}\n *\n * AppModule.meta = {\n *  imports: [\n *   CoreModule,\n *    ServerModule\n *  ],\n *  declarations: [\n *   ErrorsComponent\n *  ],\n *  bootstrap: AppComponent,\n * };\n * @extends Module\n */\nexport default class ServerModule extends Module {\n\n\tstatic meta: IModuleMeta = {\n\t\tdeclarations: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t],\n\t\texports: [\n\t\t\t...factories,\n\t\t\t...pipes,\n\t\t]\n\t};\n\n}\n"]}