/**
 * @license rxcomp-server v1.0.0-beta.12
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxcomp"),require("htmlparser2")):"function"==typeof define&&define.amd?define(["exports","rxcomp","htmlparser2"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).rxcomp=e.rxcomp||{},e.rxcomp.server={}),e.rxcomp,e.htmlparser2)}(this,(function(e,t,n){"use strict";function r(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function o(e,t,n){return t&&r(e.prototype,t),n&&r(e,n),e}function i(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function u(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function s(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return u(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?u(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}var c,l;function a(t){return t.nodeType===e.RxNodeType.ELEMENT_NODE}function d(t){return t.nodeType===e.RxNodeType.TEXT_NODE}function f(t){return t.nodeType===e.RxNodeType.COMMENT_NODE}function h(t){return t.nodeType===e.RxNodeType.DOCUMENT_NODE}function p(t){return t.nodeType===e.RxNodeType.DOCUMENT_TYPE_NODE}function N(e){var t,r=new D,o=r,i=new n.Parser({onopentag:function(e,n){t=new v(o,e,n),o.childNodes.push(t),o=t},onclosetag:function(e){o.parentNode&&(o=o.parentNode)},ontext:function(e){var t=new E(o,e);o.childNodes.push(t)},onprocessinginstruction:function(e,n){t="!doctype"===e?new S(o,n):new b(o,n),o.childNodes.push(t)},oncomment:function(e){t=new O(o,e),o.childNodes.push(t)},oncommentend:function(){},oncdatastart:function(){console.log("oncdatastart")},oncdataend:function(){console.log("oncdataend")},onerror:function(e){console.log("error",e)}},{decodeEntities:!1,lowerCaseTags:!0});return i.write(e),i.end(),r}function y(t){var n=[];return t.trim().split(" ").forEach((function(t){t.trim().split(">").forEach((function(t,r){for(var o,i=[],u=s(t.matchAll(/\.([^\.[]+)|\[([^\.\[]+)\]|([^\.\[\]]+)/g));!(o=u()).done;){var c=o.value;c[1]?i.push({selector:c[1],type:e.SelectorType.Class}):c[2]?i.push({selector:c[2],type:e.SelectorType.Attribute}):c[3]&&i.push({selector:c[3],type:e.SelectorType.TagName})}var l=r>0?{selector:t,selectors:i,inner:!0}:{selector:t,selectors:i,inner:!1};n.push.call(n,l)}))})),n}function T(t,n,r){void 0===r&&(r=null);var o=null;if(r||t.length){r=r||t.shift();for(var i,u=function(){var n=i.value;if(n instanceof v){if(r.selectors.reduce((function(t,r,o){return t&&function(t,n){switch(n.type){case e.SelectorType.Class:return-1!==t.classList.indexOf(n.selector);case e.SelectorType.Attribute:return-1!==Object.keys(t.attributes).indexOf(n.selector);case e.SelectorType.TagName:return t.nodeName===n.selector;default:return!1}}(n,r)}),!0))return t.length?{v:T(t,n.childNodes)}:{v:n};r.inner||(o=T(t,n.childNodes,r))}},c=s(n);!(i=c()).done;){var l=u();if("object"==typeof l)return l.v}}return o}function m(t,n,r){var o;if(void 0===n&&(n=!1),void 0===r&&(r=null),a(t)){var i=new v(r,t.nodeName,Object.assign({},t.attributes));n&&(i.childNodes=t.childNodes.map((function(e){return m.apply(e,[e,n,i])}))),o=i}else if(t.nodeType===e.RxNodeType.DOCUMENT_FRAGMENT_NODE){var u=new C;n&&(u.childNodes=t.childNodes.map((function(e){return m.apply(e,[e,n,u])}))),o=u}else if(d(t))o=new E(r,t.nodeValue);else if(f(t))o=new O(r,t.nodeValue);else{if(!h(t))throw"Invalid node type";var s=new D;n&&(s.childNodes=t.childNodes.map((function(e){return m.apply(e,[e,n,s])}))),o=s}return o}(c=e.RxNodeType||(e.RxNodeType={}))[c.ELEMENT_NODE=1]="ELEMENT_NODE",c[c.TEXT_NODE=3]="TEXT_NODE",c[c.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",c[c.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",c[c.COMMENT_NODE=8]="COMMENT_NODE",c[c.DOCUMENT_NODE=9]="DOCUMENT_NODE",c[c.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",c[c.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE",(l=e.SelectorType||(e.SelectorType={}))[l.None=-1]="None",l[l.Id=0]="Id",l[l.Class=1]="Class",l[l.Attribute=2]="Attribute",l[l.TagName=3]="TagName";var g=function(){function e(e){void 0===e&&(e=null),this.nodeValue=null,this.parentNode=e,this.nodeType=-1}var t=e.prototype;return t.cloneNode=function(e){return void 0===e&&(e=!1),m.apply(this,[this,e])},t.serialize=function(){return""},e}(),v=function(t){function n(n,r,o){var i;return void 0===n&&(n=null),void 0===o&&(o=null),(i=t.call(this,n)||this).nodeType=e.RxNodeType.ELEMENT_NODE,i.nodeName=r,i.attributes=o||{},i.childNodes=[],i}i(n,t);var r=n.prototype;return r.append=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n=n.map((function(t){var n;return"string"==typeof t?n=new E(e,t):(n=t).parentNode=e,n})),Array.prototype.push.apply(this.childNodes,n)},r.prepend=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n=n.map((function(t){var n;return"string"==typeof t?n=new E(e,t):(n=t).parentNode=e,n})),Array.prototype.unshift.apply(this.childNodes,n)},r.replaceChildren=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var o=n.map((function(t){var n;return"string"==typeof t?n=new E(e,t):(n=t).parentNode=e,n}));this.childNodes=o},r.querySelectorAll=function(e){var t=y(e),n=this.childNodes.filter((function(e){return!0}));return console.log(t),n.length?n:null},r.querySelector=function(e){return T(y(e),this.childNodes)},r.hasAttribute=function(e){return-1!==Object.keys(this.attributes).indexOf(e.toLowerCase())},r.getAttribute=function(e){return this.attributes[e.toLowerCase()]||null},r.setAttribute=function(e,t){this.attributes[e.toLowerCase()]=t.toString()},r.removeAttribute=function(e){delete this.attributes[e]},r.replaceChild=function(e,t){var n=this.childNodes.indexOf(t);return-1!==n&&(this.childNodes[n]=e,e.parentNode=this),t},r.removeChild=function(e){if(!(e instanceof g))throw"Uncaught TypeError: Failed to execute 'removeChild' on 'Node': parameter 1 is not of type 'Node'.";var t=this.childNodes.indexOf(e);if(-1===t)throw"Uncaught NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.";return this.childNodes.splice(t,1),e},r.insertBefore=function(e,t){void 0===t&&(t=null);var n=t?this.childNodes.indexOf(t):this.childNodes.length;return-1!==n&&(this.childNodes.splice(n,0,e),e.parentNode=this),e},r.cloneNode=function(e){return void 0===e&&(e=!1),m.apply(this,[this,e])},r.addListener=function(e,t){},r.removeListener=function(e,t){},r.serialize=function(){return"<"+this.nodeName+this.serializeAttributes()+">"+this.childNodes.map((function(e){return e.serialize()})).join("")+"</"+this.nodeName+">"},r.serializeAttributes=function(){var e=this,t="",n=Object.keys(this.attributes);return n.length&&(t=" "+n.map((function(t){return t+'="'+e.attributes[t]+'"'})).join(" ")),t},o(n,[{key:"children",get:function(){var t,n=[],r=0,o=this.childNodes;for(t=o[r++];t;)(t=o[r++]).nodeType===e.RxNodeType.ELEMENT_NODE&&n.push(t);return n}},{key:"childElementCount",get:function(){var t,n=0,r=0,o=this.childNodes;for(t=o[n++];t;)t.nodeType===e.RxNodeType.ELEMENT_NODE&&r++,t=o[n++];return r}},{key:"firstChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[0]),e}},{key:"firstElementChild",get:function(){for(var e,t=s(this.childNodes);!(e=t()).done;){var n=e.value;if(a(n))return n}return null}},{key:"lastElementChild",get:function(){for(var e=this.childNodes,t=e.length-1;t>-1;t--){var n=e[t];if(a(n))return n}return null}},{key:"previousSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);t>0&&(e=this.parentNode.childNodes[t-1])}return e}},{key:"nextSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);-1!==t&&t<this.parentNode.childNodes.length-1&&(e=this.parentNode.childNodes[t])}return e}},{key:"wholeText",get:function(){if(this.nodeType===e.RxNodeType.TEXT_NODE)return this.nodeValue}},{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"classList",get:function(){return this.attributes.class?this.attributes.class.split(" ").map((function(e){return e.trim()})):[]}},{key:"innerText",set:function(e){this.childNodes=[new E(this,e)]},get:function(){return this.childNodes.filter((function(e){return d(e)||a(e)})).map((function(e){return e.innerText})).join("")}},{key:"textContent",set:function(e){this.innerText=String(e)},get:function(){return this.innerText}},{key:"innerHTML",set:function(e){var t=this,n=N(e).childNodes.map((function(e){return e.parentNode=t,e}));this.childNodes=n}}]),n}(g),E=function(t){function n(n,r){var o;return void 0===n&&(n=null),(o=t.call(this,n)||this).nodeType=e.RxNodeType.TEXT_NODE,o.nodeValue=String(r),o}return i(n,t),n.prototype.serialize=function(){return this.nodeValue},o(n,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),n}(g),x=function(t){function n(n,r){var o;return void 0===n&&(n=null),(o=t.call(this,n)||this).nodeType=e.RxNodeType.CDATA_SECTION_NODE,o.nodeValue=String(r),o}return i(n,t),n.prototype.serialize=function(){return this.nodeValue},o(n,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),n}(g),O=function(t){function n(n,r){var o;return void 0===n&&(n=null),(o=t.call(this,n)||this).nodeType=e.RxNodeType.COMMENT_NODE,o.nodeValue=String(r),o}return i(n,t),n.prototype.serialize=function(){return"\x3c!--"+this.nodeValue+"--\x3e"},o(n,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),n}(g),b=function(t){function n(n,r){var o;return void 0===n&&(n=null),(o=t.call(this,n)||this).nodeType=e.RxNodeType.PROCESSING_INSTRUCTION_NODE,o.nodeValue=String(r),o}return i(n,t),n.prototype.serialize=function(){return"<"+this.nodeValue+">"},n}(g),S=function(t){function n(n,r){var o;return void 0===n&&(n=null),(o=t.call(this,n)||this).nodeType=e.RxNodeType.DOCUMENT_TYPE_NODE,o.nodeValue=String(r),o}return i(n,t),n.prototype.serialize=function(){return"<"+this.nodeValue+">"},n}(g),C=function(t){function n(){var n;return(n=t.call(this,null,"#document-fragment")||this).nodeType=e.RxNodeType.DOCUMENT_FRAGMENT_NODE,n.childNodes=[],n}return i(n,t),n}(v),D=function(t){function n(){var n;return(n=t.call(this,null,"#document")||this).nodeType=e.RxNodeType.DOCUMENT_NODE,n.childNodes=[],n}i(n,t),o(n,[{key:"hidden",get:function(){return!0}},{key:"visibilityState",get:function(){return"prerender"}},{key:"doctype",get:function(){return this.childNodes.find((function(e){return p(e)}))}},{key:"body",get:function(){return this.childNodes.find((function(e){return a(e)&&"body"===e.nodeName}))}},{key:"head",get:function(){return this.childNodes.find((function(e){return a(e)&&"head"===e.nodeName}))}},{key:"title",get:function(){var e=this.childNodes.find((function(e){return a(e)&&"title"===e.nodeName}));return e?e.innerText:null},set:function(e){var t=this.childNodes.find((function(e){return a(e)&&"title"===e.nodeName}));t&&(t.innerText=e)}},{key:"documentElement",get:function(){return this.firstElementChild}}]);var r=n.prototype;return r.createAttribute=function(){},r.createAttributeNS=function(){},r.createCDATASection=function(){},r.createComment=function(e){return new O(null,e)},r.createDocumentFragment=function(){return new C},r.createElement=function(e){return new v(null,e)},r.createElementNS=function(e){return new v(null,e)},r.createEvent=function(){},r.createNodeIterator=function(){},r.createProcessingInstruction=function(e){return new b(null,e)},r.createRange=function(){},r.createTextNode=function(e){return new E(null,e)},r.createTouchList=function(){},r.createTreeWalker=function(){},r.serialize=function(){return""+this.childNodes.map((function(e){return e.serialize()})).join("")},n}(v),_=function(){function e(){}return e.bootstrap=function(e){this.document="string"==typeof e?N(e):e,"undefined"!=typeof process&&(global.document=this.document)},e.querySelector=function(e){return this.document.querySelector(e)},e}(),R=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t.bootstrap=function(e,t){if(!t)throw"missing html template";if(_.bootstrap(t),!e)throw"missing moduleFactory";if(!e.meta)throw"missing moduleFactory meta";if(!e.meta.bootstrap)throw"missing bootstrap";if(!e.meta.bootstrap.meta)throw"missing bootstrap meta";if(!e.meta.bootstrap.meta.selector)throw"missing bootstrap meta selector";var n=this.resolveMeta(e),r=new e;r.meta=n;var o=r.compile(n.node,{});return r.instances=o,o[0].pushChanges(),r},t.querySelector=function(e){return _.document.querySelector(e)},t.serialize=function(){if(console.log("Server.serialize"),_.document instanceof D)return _.document.serialize();throw"Renderer.document is not an instance of RxDocument"},t}(t.Platform),w=[],M=[],A=function(e){function t(){return e.apply(this,arguments)||this}return i(t,e),t}(t.Module);A.meta={declarations:[].concat(w,M),exports:[].concat(w,M)},e.Renderer=_,e.RxCData=x,e.RxComment=O,e.RxDocument=D,e.RxDocumentType=S,e.RxElement=v,e.RxNode=g,e.RxProcessingInstruction=b,e.RxQuery=function(e){this.selector="",this.selectors=[],this.inner=!1,e&&Object.assign(this,e)},e.RxSelector=function(t){this.selector="",this.type=e.SelectorType.None,t&&Object.assign(this,t)},e.RxText=E,e.Server=R,e.ServerModule=A,e.cloneNode=m,e.getQueries=y,e.isRxComment=f,e.isRxDocument=h,e.isRxDocumentType=p,e.isRxElement=a,e.isRxProcessingInstruction=function(t){return t.nodeType===e.RxNodeType.PROCESSING_INSTRUCTION_NODE},e.isRxText=d,e.parse=N,e.querySelector=T,e.querySelectorAll=function(e,t,n){return null},Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=rxcomp-server.min.js.map