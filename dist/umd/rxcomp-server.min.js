/**
 * @license rxcomp-server v1.0.0-beta.14
 * (c) 2020 Luca Zampetti <lzampetti@gmail.com>
 * License: MIT
 */
!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("rxcomp"),require("rxjs"),require("rxjs/operators"),require("htmlparser2")):"function"==typeof define&&define.amd?define(["exports","rxcomp","rxjs","rxjs/operators","htmlparser2"],t):t(((e="undefined"!=typeof globalThis?globalThis:e||self).rxcomp=e.rxcomp||{},e.rxcomp.server={}),e.rxcomp,e.rxjs,e.rxjs.operators,e.htmlparser2)}(this,(function(e,t,n,r,i){"use strict";function o(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function s(e,t,n){return t&&o(e.prototype,t),n&&o(e,n),e}function c(e,t){e.prototype=Object.create(t.prototype),e.prototype.constructor=e,e.__proto__=t}function u(e){return(u=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function l(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],(function(){}))),!0}catch(e){return!1}}function h(e,t,n){return(h=l()?Reflect.construct:function(e,t,n){var r=[null];r.push.apply(r,t);var i=new(Function.bind.apply(e,r));return n&&a(i,n.prototype),i}).apply(null,arguments)}function f(e){var t="function"==typeof Map?new Map:void 0;return(f=function(e){if(null===e||(n=e,-1===Function.toString.call(n).indexOf("[native code]")))return e;var n;if("function"!=typeof e)throw new TypeError("Super expression must either be null or a function");if(void 0!==t){if(t.has(e))return t.get(e);t.set(e,r)}function r(){return h(e,arguments,u(this).constructor)}return r.prototype=Object.create(e.prototype,{constructor:{value:r,enumerable:!1,writable:!0,configurable:!0}}),a(r,e)})(e)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function y(e,t){var n;if("undefined"==typeof Symbol||null==e[Symbol.iterator]){if(Array.isArray(e)||(n=function(e,t){if(e){if("string"==typeof e)return p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?p(e,t):void 0}}(e))||t&&e&&"number"==typeof e.length){n&&(e=n);var r=0;return function(){return r>=e.length?{done:!0}:{done:!1,value:e[r++]}}}throw new TypeError("Invalid attempt to iterate non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}return(n=e[Symbol.iterator]()).next.bind(n)}var m,v,g=require("path"),N=require("fs"),T=function(){function e(){}return e.exists=function(e){return N.existsSync(e)},e.exists$=function(e){return n.Observable.create((function(t){try{N.access(e,N.constants.F_OK,(function(e){var n=!e;t.next(n),t.complete()}))}catch(e){console.log("FileService.exists$.error",e),t.next(!1),t.complete()}}))},e.readFile=function(e){var t=g.dirname(e);return N.existsSync(t)?N.readFileSync(e,"utf8"):null},e.readFile$=function(e){return n.Observable.create((function(t){try{N.readFile(e,"utf8",(function(e,n){t.next(e?null:n),t.complete()}))}catch(e){console.log("FileService.readFile$.error",e),t.next(null),t.complete()}}))},e.writeFile=function(e,t){try{var n=g.dirname(e);return N.existsSync(n)||N.mkdirSync(n),N.writeFileSync(e,t,"utf8"),!0}catch(e){return console.log("FileService.writeFile.error",e),!1}},e.writeFile$=function(e,t){return n.Observable.create((function(n){try{var r=g.dirname(e);N.mkdir(r,{recursive:!0},(function(r){if(r)return n.next(!1),void n.complete();N.writeFile(e,t,"utf8",(function(e){n.next(!e),n.complete()}))}))}catch(e){console.log("FileService.writeFile$.error",e),n.next(!1),n.complete()}}))},e.unlinkFile=function(e){try{return!!N.existsSync(e)&&(N.unlinkSync(e),!0)}catch(e){return console.log("FileService.unlinkFile.error",e),!1}},e.unlinkFile$=function(e){return n.Observable.create((function(t){try{N.unlink(e,(function(e){t.next(!e),t.complete()}))}catch(e){console.log("FileService.unlinkFile$.error",e),t.next(!1)}}))},e}();!function(e){e.Memory="memory",e.File="file"}(m||(m={})),(v=e.CacheControlType||(e.CacheControlType={})).Public="public",v.Private="private",v.NoCache="no-cache",v.NoStore="no-store";var _=function(){function n(t){this.date=new Date,this.maxAge=0,this.cacheControl=e.CacheControlType.Public,t&&(this.value=t.value,this.date=t.date?new Date(t.date):this.date,this.maxAge=t.maxAge||this.maxAge,this.cacheControl=t.cacheControl||this.cacheControl)}return n.toData=function(e){return t.Serializer.encode(e,[t.encodeJson])},n.fromData=function(e){return new n(t.Serializer.decode(e,[t.decodeJson]))},s(n,[{key:"expired",get:function(){return this.cacheControl===e.CacheControlType.NoStore||0===this.maxAge||this.date.getTime()+1e3*this.maxAge<Date.now()}}]),n}(),x=function(){function t(){}return t.has=function(e,t){void 0===e&&(e="cache");var n=!1;try{var r=this.getPath(e,t);switch(this.mode){case m.File:n=T.exists(r);break;case m.Memory:default:n=-1!==Object.keys(this.cache_).indexOf(r)}}catch(e){console.log("CacheService.has.error",e)}return n},t.get=function(e,t){void 0===e&&(e="cache");var n,r=null;try{var i=this.getPath(e,t);switch(this.mode){case m.File:if(T.exists(i)){var o,s=T.readFile(i);if(s)if((n=_.fromData(s)).expired)T.unlinkFile(i);else r=null==(o=n)?void 0:o.value}break;case m.Memory:default:if(-1!==Object.keys(this.cache_).indexOf(i)){var c=this.cache_[i];c&&(n=_.fromData(c))&&(n.expired?delete this.cache_[i]:r=n.value)}}}catch(e){console.log("CacheService.get.error",e)}return r},t.set=function(t,n,r,i,o){void 0===t&&(t="cache"),void 0===i&&(i=0),void 0===o&&(o=e.CacheControlType.Public);try{var s,c=this.getPath(t,n),u=new _({value:r,maxAge:i,cacheControl:o});switch(this.mode){case m.File:(s=_.toData(u))&&T.writeFile(c,s);break;case m.Memory:default:(s=_.toData(u))&&(this.cache_[c]=s)}}catch(e){console.log("CacheService.set.error",e)}return r},t.delete=function(e,t){void 0===e&&(e="cache");try{var n=this.getPath(e,t);switch(this.mode){case m.File:T.unlinkFile(n);break;case m.Memory:default:-1!==Object.keys(this.cache_).indexOf(n)&&delete this.cache_[n]}}catch(e){console.log("CacheService.delete.error",e)}},t.has$=function(e,t){var i=this;return void 0===e&&(e="cache"),n.Observable.create((function(n){var r=i.getPath(e,t);n.next(r),n.complete()})).pipe(r.switchMap((function(e){return i.mode===m.File?T.exists$(e):n.of(-1!==Object.keys(i.cache_).indexOf(e))})))},t.get$=function(e,t){var i,o=this;return void 0===e&&(e="cache"),n.Observable.create((function(n){i=o.getPath(e,t),n.next(i),n.complete()})).pipe(r.switchMap((function(e){return o.mode===m.File?T.readFile$(e):n.of(o.cache_[e])})),r.switchMap((function(e){var t=e?_.fromData(e):null;return t&&t.expired?T.unlinkFile$(i).pipe(r.map((function(){return null}))):n.of(t?t.value:null)})))},t.set$=function(t,i,o,s,c){var u,a,l,h=this;return void 0===t&&(t="cache"),void 0===s&&(s=0),void 0===c&&(c=e.CacheControlType.Public),n.Observable.create((function(e){u=h.getPath(t,i),a=new _({value:o,maxAge:s,cacheControl:c}),l=_.toData(a),e.next(l),e.complete()})).pipe(r.switchMap((function(e){return e?h.mode===m.File?T.writeFile$(u,e):(h.cache_[u]=e,n.of(!0)):n.of(!1)})))},t.delete$=function(e,t){var i,o=this;return void 0===e&&(e="cache"),n.Observable.create((function(n){i=o.getPath(e,t),n.next(i),n.complete()})).pipe(r.switchMap((function(e){return o.mode===m.File?T.unlinkFile$(e):-1!==Object.keys(o.cache_).indexOf(e)?(delete o.cache_[e],n.of(!0)):n.of(!1)})))},t.getPath=function(e,t){void 0===e&&(e="cache");var n=this.getKey(e,t);return""+this.folder+n},t.getKey=function(e,t){void 0===e&&(e="cache");var n=(e+"-"+t).toLowerCase();return n=n.replace(/(\s+)|(\W+)/g,(function(){return(arguments.length<=1?void 0:arguments[1])?"":"_"}))},t}();x.cache_={},x.mode=m.Memory;var b,E,w=function(e){function t(){return e.apply(this,arguments)||this}c(t,e);var n=t.prototype;return n.contains=function(e){return-1!==this.indexOf(e)},n.item=function(e){return e>0&&e<this.length?this[e]:null},t}(f(Array)),O=function(){function e(){this.hash_="",this.host_="",this.hostname_="",this.pathname_="",this.port_="",this.protocol_="",this.search_="",this.href_="",this.ancestorOrigins_=new w}var n=e.prototype;return n.assign=function(e){this.href=e},n.reload=function(){},n.replace=function(e){this.href=e},n.toString=function(){return this.href},s(e,[{key:"hash",get:function(){return this.hash_},set:function(e){this.hash_=e,this.href=this.href}},{key:"host",get:function(){return this.host_},set:function(e){this.host_=e,this.href=this.href}},{key:"hostname",get:function(){return this.hostname_},set:function(e){this.hostname_=e,this.href=this.href}},{key:"pathname",get:function(){return this.pathname_},set:function(e){this.pathname_=e,this.href=this.href}},{key:"port",get:function(){return this.port_},set:function(e){this.port_=e,this.href=this.href}},{key:"protocol",get:function(){return this.protocol_},set:function(e){this.protocol_=e,this.href=this.href}},{key:"search",get:function(){return this.search_},set:function(e){this.search_=e,this.href=this.href}},{key:"href",get:function(){var e=this.protocol+"//"+this.host+(this.port.length?":"+this.port:"")+this.pathname+this.search+this.hash;return this.href_=e,e},set:function(e){if(this.href_!==e){this.href_=e;var n=t.getLocationComponents(e);this.protocol_=n.protocol,this.host_=n.host,this.hostname_=n.hostname,this.port_=n.port,this.pathname_=n.pathname,this.search_=n.search,this.hash_=n.hash}}},{key:"origin",get:function(){return this.protocol+"//"+this.host+(this.port.length?":"+this.port:"")}},{key:"ancestorOrigins",get:function(){return this.ancestorOrigins_}}],[{key:"location",get:function(){return this.location_?this.location_:this.location_=new e}}]),e}(),S=function(){function e(){this.currentIndex_=0,this.history_=[],this.scrollRestoration="auto"}var t=e.prototype;return t.back=function(){if(this.currentIndex_>0){this.currentIndex_--;var e=this.history_[this.currentIndex_];e.url&&(O.location.href=e.url)}},t.forward=function(){if(this.currentIndex_<this.history_.length-1){this.currentIndex_++;var e=this.history_[this.currentIndex_];e.url&&(O.location.href=e.url)}},t.go=function(e){if("number"==typeof e){var t=this.currentIndex_+e;if(t>0&&t<this.history_.length){var n=this.history_[t];n.url&&(O.location.href=n.url)}}},t.pushState=function(e,t,n){this.history_.push({data:e,title:t,url:n}),this.currentIndex_=this.history_.length-1},t.replaceState=function(e,t,n){this.history_.length?this.history_.splice(this.history_.length-1,1,{data:e,title:t,url:n}):this.history_.push({data:e,title:t,url:n}),this.currentIndex_=this.history_.length-1},s(e,[{key:"length",get:function(){return this.history_.length}}],[{key:"history",get:function(){return this.history_?this.history_:this.history_=new e}}]),e}();(b=e.RxNodeType||(e.RxNodeType={}))[b.ELEMENT_NODE=1]="ELEMENT_NODE",b[b.TEXT_NODE=3]="TEXT_NODE",b[b.CDATA_SECTION_NODE=4]="CDATA_SECTION_NODE",b[b.PROCESSING_INSTRUCTION_NODE=7]="PROCESSING_INSTRUCTION_NODE",b[b.COMMENT_NODE=8]="COMMENT_NODE",b[b.DOCUMENT_NODE=9]="DOCUMENT_NODE",b[b.DOCUMENT_TYPE_NODE=10]="DOCUMENT_TYPE_NODE",b[b.DOCUMENT_FRAGMENT_NODE=11]="DOCUMENT_FRAGMENT_NODE",(E=e.SelectorType||(e.SelectorType={}))[E.None=-1]="None",E[E.Id=0]="Id",E[E.Class=1]="Class",E[E.Attribute=2]="Attribute",E[E.TagName=3]="TagName";var C=function(){function e(e){void 0===e&&(e=null),this.nodeValue=null,this.parentNode=e,this.nodeType=-1}var t=e.prototype;return t.cloneNode=function(e){return void 0===e&&(e=!1),Q.apply(this,[this,e])},t.serialize=function(){return""},e}(),k=function(){function e(e){Object.defineProperty(this,"node",{value:e,writable:!1,enumerable:!1}),this.init()}var t=e.prototype;return t.init=function(){var e,t=this;if(Object.keys(this).forEach((function(e){return delete t[e]})),null==(e=this.node.attributes)?void 0:e.style){[].concat(this.node.attributes.style.matchAll(/([^:]+):([^;]+);?\s*/gm)).forEach((function(e){var n=e[1],r=e[2];t[n]=r}))}},t.item=function(e){var t=Object.keys(this);return t.length>e?t[e]:void 0},t.getPropertyPriority=function(e){var t=this[e];return t&&t.indexOf("!important")?"important":""},t.getPropertyValue=function(e){return this[e]},t.setProperty=function(e,t,n){this[e]=t+("important"===n?"!important":""),this.serialize_()},t.removeProperty=function(e){delete this[e],this.serialize_()},t.serialize_=function(){var e=this;this.node.attributes.style=Object.keys(this).map((function(t){return t+": "+e[t]+";"})).join(" ")},e}(),M=function(e){function t(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];return e.call.apply(e,[this].concat(n))||this}c(t,e);var n=t.prototype;return n.init=function(){this.length=0,this.node.hasAttribute("class")&&Array.prototype.push.apply(this,this.node.getAttribute("class").split(" ").map((function(e){return e.trim()})))},n.slice=function(e,n){var r=this.length;e=(e=e||0)>=0?e:Math.max(0,r+e);var i,o=(n=(n=void 0!==n?n:r)>=0?Math.min(n,r):r+n)-e,s=o>0?new t(o):new t;for(i=0;i<o;i++)s[i]=this[e+i];return s.node=this.node,s},n.item=function(e){return this[e]},n.contains=function(e){return-1!==this.indexOf(e)},n.add=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){-1===e.indexOf(t)&&e.push(t)})),this.serialize_()},n.remove=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n.forEach((function(t){var n=e.indexOf(t);-1!==n&&e.splice(n,1)})),this.serialize_()},n.toggle=function(e,t){var n=this.indexOf(e);return!1===t?(this.splice(n,1),this.serialize_(),!1):!0===t?(this.push(e),this.serialize_(),!0):-1!==n?(this.splice(n,1),this.serialize_(),!1):(this.push(e),this.serialize_(),!0)},n.replace=function(e,t){var n=this.indexOf(e);-1!==n&&this.splice(n,1),this.push(t),this.serialize_()},n.serialize_=function(){this.node.setAttribute("class",this.join(" "))},s(t,[{key:"node",get:function(){return this.node_},set:function(e){this.node_!==e&&(this.node_=e,this.init())}}]),t}(f(Array)),D=function(t){function n(n,r,i){var o;void 0===n&&(n=null),void 0===i&&(i=null),(o=t.call(this,n)||this).attributes={},o.nodeType=e.RxNodeType.ELEMENT_NODE,o.nodeName=r,i&&"object"==typeof i&&(o.attributes=i),o.style=new k(d(o));var s=new M;return s.node=d(o),o.classList=s,o.childNodes=[],o}c(n,t);var r=n.prototype;return r.append=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n=n.map((function(t){var n;return"string"==typeof t?n=new R(e,t):(n=t).parentNode=e,n})),Array.prototype.push.apply(this.childNodes,n)},r.appendChild=function(e){return e.parentNode&&e.parentNode.removeChild(e),G(e)?this.append.apply(this,e.childNodes):this.append(e),e},r.prepend=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];n=n.map((function(t){var n;return"string"==typeof t?n=new R(e,t):(n=t).parentNode=e,n})),Array.prototype.unshift.apply(this.childNodes,n)},r.replaceChildren=function(){for(var e=this,t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];var i=n.map((function(t){var n;return"string"==typeof t?n=new R(e,t):(n=t).parentNode=e,n}));this.childNodes=i},r.querySelectorAll=function(e){var t=K(X(e),this.childNodes);return t&&t.length?t:null},r.querySelector=function(e){return W(X(e),this.childNodes)},r.hasAttribute=function(e){return-1!==Object.keys(this.attributes).indexOf(e.toLowerCase())},r.getAttribute=function(e){return this.attributes[e.toLowerCase()]||null},r.setAttribute=function(e,t){this.attributes[e.toLowerCase()]=t.toString(),"style"===e?this.style.init():"class"===e&&this.classList.init()},r.removeAttribute=function(e){delete this.attributes[e],"style"===e?this.style.init():"class"===e&&this.classList.init()},r.replaceChild=function(e,t){var n=this.childNodes.indexOf(t);return-1!==n&&(this.childNodes[n]=e,e.parentNode=this),t},r.removeChild=function(e){if(!(e instanceof C))throw new Error("Uncaught TypeError: Failed to execute 'removeChild' on 'Node': parameter 1 is not of type 'Node'.");var t=this.childNodes.indexOf(e);if(-1===t)throw new Error("Uncaught NotFoundError: Failed to execute 'removeChild' on 'Node': The node to be removed is not a child of this node.");return this.childNodes.splice(t,1),e},r.insertBefore=function(e,t){void 0===t&&(t=null);var n=t?this.childNodes.indexOf(t):this.childNodes.length;return-1!==n&&(this.childNodes.splice(n,0,e),e.parentNode=this),e},r.cloneNode=function(e){return void 0===e&&(e=!1),Q.apply(this,[this,e])},r.addListener=function(e,t){},r.removeListener=function(e,t){},r.serialize=function(){return"<"+this.nodeName+this.serializeAttributes()+">"+this.childNodes.map((function(e){return e.serialize()})).join("")+"</"+this.nodeName+">"},r.serializeAttributes=function(){var e=this,t="",n=Object.keys(this.attributes);return n.length&&(t=" "+n.map((function(t){return t+'="'+e.attributes[t]+'"'})).join(" ")),t},s(n,[{key:"children",get:function(){var t,n=[],r=0,i=this.childNodes;for(t=i[r++];t;)t.nodeType===e.RxNodeType.ELEMENT_NODE&&n.push(t),t=i[r++];return n}},{key:"childElementCount",get:function(){var t,n=0,r=0,i=this.childNodes;for(t=i[n++];t;)t.nodeType===e.RxNodeType.ELEMENT_NODE&&r++,t=i[n++];return r}},{key:"firstChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[0]),e}},{key:"firstElementChild",get:function(){for(var e,t=y(this.childNodes);!(e=t()).done;){var n=e.value;if(V(n))return n}return null}},{key:"lastChild",get:function(){var e=null;return this.childNodes.length&&(e=this.childNodes[this.childNodes.length-1]),e}},{key:"lastElementChild",get:function(){for(var e=this.childNodes,t=e.length-1;t>-1;t--){var n=e[t];if(V(n))return n}return null}},{key:"previousSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);t>0&&(e=this.parentNode.childNodes[t-1])}return e}},{key:"nextSibling",get:function(){var e=null;if(this.parentNode){var t=this.parentNode.childNodes.indexOf(this);-1!==t&&t<this.parentNode.childNodes.length-1&&(e=this.parentNode.childNodes[t])}return e}},{key:"wholeText",get:function(){if(this.nodeType===e.RxNodeType.TEXT_NODE)return this.nodeValue}},{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"innerText",set:function(e){this.childNodes=[new R(this,e)]},get:function(){return this.childNodes.filter((function(e){return $(e)||V(e)})).map((function(e){return e.innerText})).join("")}},{key:"textContent",set:function(e){this.innerText=String(e)},get:function(){return this.innerText}},{key:"innerHTML",get:function(){return this.childNodes.map((function(e){return e.serialize()})).join("")},set:function(e){var t=this,n=B(e).childNodes.map((function(e){return e.parentNode=t,e}));this.childNodes=n}}]),n}(C),R=function(t){function n(n,r){var i;return void 0===n&&(n=null),(i=t.call(this,n)||this).nodeType=e.RxNodeType.TEXT_NODE,i.nodeValue=String(r),i}return c(n,t),n.prototype.serialize=function(){return this.nodeValue},s(n,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),n}(C),A=function(t){function n(n,r){var i;return void 0===n&&(n=null),(i=t.call(this,n)||this).nodeType=e.RxNodeType.CDATA_SECTION_NODE,i.nodeValue=String(r),i}return c(n,t),n.prototype.serialize=function(){return this.nodeValue},s(n,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),n}(C),F=function(t){function n(n,r){var i;return void 0===n&&(n=null),(i=t.call(this,n)||this).nodeType=e.RxNodeType.COMMENT_NODE,i.nodeValue=String(r),i}return c(n,t),n.prototype.serialize=function(){return"\x3c!--"+this.nodeValue+"--\x3e"},s(n,[{key:"outerHTML",get:function(){var e=null;return this.parentNode&&(e=this.parentNode.serialize()),e}},{key:"wholeText",get:function(){return this.nodeValue}},{key:"innerText",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}},{key:"textContent",set:function(e){this.nodeValue=String(e)},get:function(){return this.nodeValue}}]),n}(C),j=function(t){function n(n,r){var i;return void 0===n&&(n=null),(i=t.call(this,n)||this).nodeType=e.RxNodeType.PROCESSING_INSTRUCTION_NODE,i.nodeValue=String(r),i}return c(n,t),n.prototype.serialize=function(){return"<"+this.nodeValue+">"},n}(C),P=function(t){function n(n,r){var i;return void 0===n&&(n=null),(i=t.call(this,n)||this).nodeType=e.RxNodeType.DOCUMENT_TYPE_NODE,i.nodeValue=String(r),i}return c(n,t),n.prototype.serialize=function(){return"<"+this.nodeValue+">"},n}(C),I=function(t){function n(){var n;return(n=t.call(this,null,"#document-fragment")||this).nodeType=e.RxNodeType.DOCUMENT_FRAGMENT_NODE,n.childNodes=[],n}return c(n,t),n}(D),z=function(t){function n(){var n;return(n=t.call(this,null,"#document")||this).location_=O.location,n.nodeType=e.RxNodeType.DOCUMENT_NODE,n.childNodes=[],n}c(n,t);var r=n.prototype;return r.createAttribute=function(){},r.createAttributeNS=function(){},r.createCDATASection=function(){},r.createComment=function(e){return new F(null,e)},r.createDocumentFragment=function(){return new I},r.createElement=function(e){return new D(null,e)},r.createElementNS=function(e){return new D(null,e)},r.createEvent=function(){},r.createNodeIterator=function(){},r.createProcessingInstruction=function(e){return new j(null,e)},r.createRange=function(){},r.createTextNode=function(e){return new R(null,e)},r.createTouchList=function(){},r.createTreeWalker=function(){},r.serialize=function(){return""+this.childNodes.map((function(e){return e.serialize()})).join("")},s(n,[{key:"location",get:function(){return this.location_}},{key:"URL",get:function(){return this.location_.href}},{key:"hidden",get:function(){return!0}},{key:"visibilityState",get:function(){return"prerender"}},{key:"doctype",get:function(){return this.childNodes.find((function(e){return H(e)}))}},{key:"head",get:function(){var e=this.documentElement.childNodes.find((function(e){return V(e)&&"head"===e.nodeName}));return e||(e=new D(this.documentElement,"head"),this.documentElement.append(e)),e}},{key:"body",get:function(){var e=this.childNodes.find((function(e){return V(e)&&"body"===e.nodeName}));return e||(e=new D(this.documentElement,"body"),this.documentElement.append(e)),e}},{key:"title",get:function(){var e=this.head.childNodes.find((function(e){return V(e)&&"title"===e.nodeName}));return e?e.innerText:null},set:function(e){var t=this.head.childNodes.find((function(e){return V(e)&&"title"===e.nodeName}));t||(t=new D(this.head,"title")),t.innerText=e}},{key:"documentElement",get:function(){var e=this.firstElementChild;return e||(e=new D(this,"html")),e}}]),n}(D),L=function(){function e(e){e&&Object.assign(this,e)}var t=e.prototype;return t.alert=function(e){},t.blur=function(){},t.close=function(){},t.confirm=function(e){return!1},t.departFocus=function(e,t){},t.focus=function(){},t.getComputedStyle=function(e,t){},t.getMatchedCSSRules=function(e,t){},t.getSelection=function(){return null},t.matchMedia=function(e){},t.moveBy=function(e,t){},t.moveTo=function(e,t){},t.msWriteProfilerMark=function(e){},t.open=function(e,t,n,r){return null},t.postMessage=function(e,t,n){},t.print=function(){},t.prompt=function(e,t){return null},t.resizeBy=function(e,t){},t.resizeTo=function(e,t){},t.scroll=function(){},t.scrollBy=function(){},t.scrollTo=function(){},t.stop=function(){},t.webkitCancelAnimationFrame=function(e){},t.webkitConvertPointFromNodeToPage=function(e,t){},t.webkitConvertPointFromPageToNode=function(e,t){},t.webkitRequestAnimationFrame=function(e){return 0},t.addEventListener=function(e,t,n){},t.removeEventListener=function(e,t,n){},t.oncompassneedscalibration=function(e){return null},t.ondevicelight=function(e){return null},t.ondevicemotion=function(e){},t.ondeviceorientation=function(e){},t.ondeviceorientationabsolute=function(e){},t.onmousewheel=function(e){},t.onmsgesturechange=function(e){},t.onmsgesturedoubletap=function(e){},t.onmsgestureend=function(e){},t.onmsgesturehold=function(e){},t.onmsgesturestart=function(e){},t.onmsgesturetap=function(e){},t.onmsinertiastart=function(e){},t.onmspointercancel=function(e){},t.onmspointerdown=function(e){},t.onmspointerenter=function(e){},t.onmspointerleave=function(e){},t.onmspointermove=function(e){},t.onmspointerout=function(e){},t.onmspointerover=function(e){},t.onmspointerup=function(e){},t.onreadystatechange=function(e){},t.onvrdisplayactivate=function(e){},t.onvrdisplayblur=function(e){},t.onvrdisplayconnect=function(e){},t.onvrdisplaydeactivate=function(e){},t.onvrdisplaydisconnect=function(e){},t.onvrdisplayfocus=function(e){},t.onvrdisplaypointerrestricted=function(e){},t.onvrdisplaypointerunrestricted=function(e){},t.onvrdisplaypresentchange=function(e){},e}();function V(t){return t.nodeType===e.RxNodeType.ELEMENT_NODE}function $(t){return t.nodeType===e.RxNodeType.TEXT_NODE}function U(t){return t.nodeType===e.RxNodeType.COMMENT_NODE}function q(t){return t.nodeType===e.RxNodeType.DOCUMENT_NODE}function G(t){return t.nodeType===e.RxNodeType.DOCUMENT_FRAGMENT_NODE}function H(t){return t.nodeType===e.RxNodeType.DOCUMENT_TYPE_NODE}function B(e){var t,n=new z,r=n,o=new i.Parser({onopentag:function(e,n){t=new D(r,e,n),r.childNodes.push(t),r=t},onclosetag:function(e){r.parentNode&&(r=r.parentNode)},ontext:function(e){var t=new R(r,e);r.childNodes.push(t)},onprocessinginstruction:function(e,n){t="!doctype"===e?new P(r,n):new j(r,n),r.childNodes.push(t)},oncomment:function(e){t=new F(r,e),r.childNodes.push(t)},oncommentend:function(){}},{decodeEntities:!1,lowerCaseTags:!0});return o.write(e),o.end(),n}function X(t){var n=[];return t.trim().split(" ").forEach((function(t){t.trim().split(">").forEach((function(t,r){for(var i,o=[],s=y(t.matchAll(/\:not\(\#([^\.[#:]+)\)|\:not\(\.([^\.[#:]+)\)|\:not\(\[([^\.\[#:]+)\]\)|\:not\(([^\.\[#:\]]+)\)|\#([^\.[#:]+)|\.([^\.[#:]+)|\[([^\.\[#:]+)\]|([^\.\[#:\]]+)/g));!(i=s()).done;){var c=i.value;c[1]?o.push({selector:c[1],type:e.SelectorType.Id,negate:!0}):c[2]?o.push({selector:c[2],type:e.SelectorType.Class,negate:!0}):c[3]?o.push({selector:c[3],type:e.SelectorType.Attribute,negate:!0}):c[4]?o.push({selector:c[4],type:e.SelectorType.TagName,negate:!0}):c[5]?o.push({selector:c[5],type:e.SelectorType.Id,negate:!1}):c[6]?o.push({selector:c[6],type:e.SelectorType.Class,negate:!1}):c[7]?o.push({selector:c[7],type:e.SelectorType.Attribute,negate:!1}):c[8]&&o.push({selector:c[8],type:e.SelectorType.TagName,negate:!1})}var u=r>0?{selector:t,selectors:o,inner:!0}:{selector:t,selectors:o,inner:!1};n.push.call(n,u)}))})),n}function Y(t,n){switch(n.type){case e.SelectorType.Id:return(""!==n.selector&&t.attributes.id===n.selector)!==n.negate;case e.SelectorType.Class:return-1!==t.classList.indexOf(n.selector)!==n.negate;case e.SelectorType.Attribute:return-1!==Object.keys(t.attributes).indexOf(n.selector)!==n.negate;case e.SelectorType.TagName:return t.nodeName===n.selector!==n.negate;default:return!1}}function J(e,t){return t.reduce((function(t,n){return t&&Y(e,n)}),!0)}function K(e,t,n,r){if(void 0===n&&(n=null),void 0===r&&(r=[]),n||e.length){n=n||e.shift();for(var i,o=y(t);!(i=o()).done;){var s=i.value;if(s instanceof D)if(J(s,n.selectors))if(e.length){var c=K(e,s.childNodes);c&&Array.prototype.push.apply(r,c)}else r.push(s);else if(!n.inner){var u=K(e,s.childNodes,n);u&&Array.prototype.push.apply(r,u)}}}return r.length?r:null}function W(e,t,n){void 0===n&&(n=null);var r=null;if(n||e.length){n=n||e.shift();for(var i,o=y(t);!(i=o()).done;){var s=i.value;if(s instanceof D){if(J(s,n.selectors))return e.length?W(e,s.childNodes):s;n.inner||(r=W(e,s.childNodes,n))}}}return r}function Q(e,t,n){var r;if(void 0===t&&(t=!1),void 0===n&&(n=null),V(e)){var i=new D(n,e.nodeName,Object.assign({},e.attributes));t&&(i.childNodes=e.childNodes.map((function(e){return Q.apply(e,[e,t,i])}))),r=i}else if(G(e)){var o=new I;t&&(o.childNodes=e.childNodes.map((function(e){return Q.apply(e,[e,t,o])}))),r=o}else if($(e))r=new R(n,e.nodeValue);else if(U(e))r=new F(n,e.nodeValue);else{if(!q(e))throw new Error("Invalid node type");var s=new z;t&&(s.childNodes=e.childNodes.map((function(e){return Q.apply(e,[e,t,s])}))),r=s}return r}var Z=function(e){e&&Object.assign(this,e),this.vars=Object.assign({host:"http://localhost:5000",port:5e3,charset:"utf8",template:"./index.html",cacheMode:m.Memory,cache:"./cache/",root:"./dist/browser/"},this.vars||{})},ee=function(t){this.maxAge=3600,this.cacheControl=e.CacheControlType.Public,t&&Object.assign(this,t)},te=function(e){e&&Object.assign(this,e)},ne=function(e){function n(){return e.apply(this,arguments)||this}return c(n,e),n.bootstrap=function(e,n){if(!t.isPlatformServer)throw new t.ModuleError("missing platform server, node process not found");if(!e)throw new t.ModuleError("missing moduleFactory");if(!e.meta)throw new t.ModuleError("missing moduleFactory meta");if(!e.meta.bootstrap)throw new t.ModuleError("missing bootstrap");if(!e.meta.bootstrap.meta)throw new t.ModuleError("missing bootstrap meta");if(!e.meta.bootstrap.meta.selector)throw new t.ModuleError("missing bootstrap meta selector");if(!(null==n?void 0:n.template))throw new t.ModuleError("missing template");var r=this.resolveGlobals(n),i=this.resolveMeta(e);if(i.node instanceof D){var o,s=i.node,c=i.nodeInnerHTML,u={selector:e.meta.bootstrap.meta.selector,innerHTML:c},a=new D(null,"script"),l=new R(null,"var rxcomp_hydrate_ = "+JSON.stringify(u)+";");a.append(l),null==(o=s.parentNode)||o.insertBefore(a,s)}var h=new e;h.meta=i,i.imports.forEach((function(e){e.prototype.constructor.call(h)}));var f=h.compile(i.node,{document:r});return h.instances=f,f[0].pushChanges(),h},n.serialize=function(){if(this.document instanceof z)return this.document.serialize();throw new t.ModuleError("document is not an instance of RxDocument")},n.resolveGlobals=function(e){var t=e.url,n=O.location;n.assign(t),global.location=n;var r=S.history;r.replaceState(null,"",n.origin),global.history=r;var i=e.template,o="string"==typeof i?B(i):i;return this.document=o,global.document=this.document,r.replaceState(null,o.title||"",n.origin),global.window=global.self=new L({document:o,history:r,location:n,devicePixelRatio:1}),this.document},n}(t.Platform);function re(e,t){var i;return n.Observable.create((function(t){i=new Z(e),t.next(i),t.complete()})).pipe(r.switchMap((function(e){return ie(e)})),r.switchMap((function(e){return console.log("Server.render$.fromCache","route",i.url,!!e),e?n.of(e):oe(i,t)})))}function ie(e){return e.vars.cacheMode&&(x.mode=e.vars.cacheMode),e.vars.cache&&(x.folder=e.vars.cache),x.get$("render",e.url)}function oe(e,t){return se(e).pipe(r.switchMap((function(n){return e.template=n,t(e)})),r.switchMap((function(t){return x.set$("render",e.url,t,t.maxAge,t.cacheControl).pipe(r.switchMap((function(){return n.of(t)})))})))}function se(e){return n.Observable.create((function(t){var n=e.vars.template;n?(t.next(n),t.complete()):t.error(new Error("ServerError: you must provide a template path"))})).pipe(r.switchMap((function(e){return T.readFile$(e)})),r.switchMap((function(t){return t?n.of(t):n.throwError(new Error("ServerError: missing template at path "+e.vars.template))})))}function ce(e,t){return n.Observable.create((function(n){if(!t.template)return n.error(new Error("ServerError: missing template"));try{ne.bootstrap(e,t);n.next(new ee(Object.assign({serialize:function(){return ne.serialize()}},t))),n.complete()}catch(e){n.error(new te(Object.assign({error:e},t)))}}))}ne.render$=re,ne.template$=se,ne.bootstrap$=ce;var ue=[],ae=[],le=function(e){function t(){return e.apply(this,arguments)||this}return c(t,e),t}(t.Module);le.meta={declarations:[].concat(ue,ae),exports:[].concat(ue,ae)},e.CacheItem=_,e.CacheService=x,e.FileService=T,e.RxCData=A,e.RxComment=F,e.RxDOMStringList=w,e.RxDocument=z,e.RxDocumentType=P,e.RxElement=D,e.RxHistory=S,e.RxLocation=O,e.RxNode=C,e.RxProcessingInstruction=j,e.RxQuery=function(e){this.selector="",this.selectors=[],this.inner=!1,e&&Object.assign(this,e)},e.RxSelector=function(t){this.selector="",this.type=e.SelectorType.None,this.negate=!1,t&&Object.assign(this,t)},e.RxText=R,e.Server=ne,e.ServerModule=le,e.ServerRequest=Z,e.ServerResponse=ee,e.bootstrap$=ce,e.cloneNode=Q,e.fromCache$=ie,e.fromRenderRequest$=oe,e.getQueries=X,e.isRxComment=U,e.isRxDocument=q,e.isRxDocumentType=H,e.isRxElement=V,e.isRxProcessingInstruction=function(t){return t.nodeType===e.RxNodeType.PROCESSING_INSTRUCTION_NODE},e.isRxText=$,e.matchSelector=Y,e.matchSelectors=J,e.parse=B,e.querySelector=W,e.querySelectorAll=K,e.render$=re,e.template$=se,Object.defineProperty(e,"__esModule",{value:!0})}));
//# sourceMappingURL=rxcomp-server.min.js.map